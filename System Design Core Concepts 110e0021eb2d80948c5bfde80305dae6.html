<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>System Design Core Concepts</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
	margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-default_background {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-default_background {
	color: inherit;
	fill: inherit;
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-uiBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-transparentGray { background-color: rgba(227, 226, 224, 0); }
.select-value-color-translucentGray { background-color: rgba(0, 0, 0, 0.06); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="110e0021-eb2d-8094-8c5b-fde80305dae6" class="page sans"><header><img class="page-cover-image" src="https://www.notion.so/images/page-cover/met_silk_kashan_carpet.jpg" style="object-position:center 50%"/><div class="page-header-icon page-header-icon-with-cover"><span class="icon">💻</span></div><h1 class="page-title">System Design Core Concepts</h1><p class="page-description"></p></header><div class="page-body"><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">OSI Model and Network Protocols</summary><div class="indented"><figure id="17ee0021-eb2d-8088-a394-d76926969587" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/OSI.drawio.png"><img style="width:679.984375px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/OSI.drawio.png"/></a></figure><p id="17ee0021-eb2d-8037-bbac-da06fb193058" class="">Network protocols defines a set of rule to transmit and receive data between devices on the network.</p><h2 id="17ee0021-eb2d-8016-9f23-ef95628e9cd3" class="">Application Layer →</h2><div id="17ee0021-eb2d-809e-b4c7-f545aa940957" class="column-list"><div id="17ee0021-eb2d-80f8-9c88-c2fe1fb20380" style="width:100%" class="column"><p id="17ee0021-eb2d-80f8-a7de-f8dca3168b00" class=""><strong><span style="border-bottom:0.05em solid">Client Server Protocols</span></strong></p><ul id="17ee0021-eb2d-80ea-bdb6-d227fd9cf70a" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">HTTP/HTTPS → Secured transfer</span></strong></li></ul><ul id="17ee0021-eb2d-8058-abc4-c70445c8522e" class="bulleted-list"><li style="list-style-type:disc">FTP → unsecured</li></ul><ul id="17ee0021-eb2d-8038-b4b1-fa91f8f4479e" class="bulleted-list"><li style="list-style-type:disc">SMTP → Sending email</li></ul><ul id="17ee0021-eb2d-808c-b178-d815cfaad305" class="bulleted-list"><li style="list-style-type:disc">IMAP → Read/ Receiving email</li></ul><ul id="17ee0021-eb2d-80e3-83d9-e8a6fc2b1c9f" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Web-Sockets (TCP)</span></strong></li></ul></div><div id="17ee0021-eb2d-8093-8a3f-d898d32cd4b1" style="width:100%" class="column"><p id="17ee0021-eb2d-8037-8503-f0ed33460450" class=""><strong><span style="border-bottom:0.05em solid">Peer-to-Peer Protocols</span></strong></p><ul id="17ee0021-eb2d-80bf-be1d-ffc463bf1a97" class="bulleted-list"><li style="list-style-type:disc">Web RTC (UDP)</li></ul><p id="17ee0021-eb2d-8001-a856-f1a73f3e9627" class="">
</p></div></div><h3 id="17ee0021-eb2d-80d5-8795-fbe1c3a2165b" class="">Client server </h3><div id="17ee0021-eb2d-8039-953a-de8265e3da24" class="column-list"><div id="17ee0021-eb2d-80e1-acd6-ef1e5256ed86" style="width:100%" class="column"><figure id="17ee0021-eb2d-8071-b9fe-cca951503cf8" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image.png"><img style="width:624px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image.png"/></a></figure></div><div id="17ee0021-eb2d-80cd-9534-dd2ebd3a5cae" style="width:100%" class="column"><p id="17ee0021-eb2d-80aa-a43a-d7cf5b1dd2ca" class="">Client → web browser/ Phone</p><p id="17ee0021-eb2d-8021-a233-c21c93a5ed5e" class="">Server → Web Server</p><ul id="17ee0021-eb2d-8027-a163-da788e86e77a" class="bulleted-list"><li style="list-style-type:disc">Only client will initiate the request and server will respond.</li></ul><ul id="17ee0021-eb2d-8042-8abe-c67168cf4a3c" class="bulleted-list"><li style="list-style-type:disc">HTTP/HTTPS, FTP and SMTP follows this pattern.</li></ul></div></div><h3 id="17ee0021-eb2d-80e6-ac6c-e3b4ad5069b1" class="">Web Socket</h3><div id="17ee0021-eb2d-805a-bcff-f45464aef885" class="column-list"><div id="17ee0021-eb2d-802a-bb25-ebd00affa14b" style="width:100%" class="column"><figure id="17ee0021-eb2d-80fb-93d8-ff70a1ba2d0e" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%201.png"><img style="width:316.984375px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%201.png"/></a></figure></div><div id="17ee0021-eb2d-8026-8ac3-d1da38d75c93" style="width:100%" class="column"><ul id="17ee0021-eb2d-8003-81cf-cf3840514090" class="bulleted-list"><li style="list-style-type:disc">Bi-directional.</li></ul><ul id="17ee0021-eb2d-80b2-b6ce-eee13f7de812" class="bulleted-list"><li style="list-style-type:disc">Client can talk with Server and Server can talk with Client.</li></ul><ul id="17ee0021-eb2d-8002-bc45-e561e9bbf236" class="bulleted-list"><li style="list-style-type:disc">WebSocket keeps a single connection open for as long as the application is running.</li></ul><ul id="17ee0021-eb2d-80c6-9210-d6e4f63b42cc" class="bulleted-list"><li style="list-style-type:disc">It is not peer-to-peer, because there are not two clients talking to each other.</li></ul></div></div><ul id="17ee0021-eb2d-802e-9c10-f091520f40e2" class="bulleted-list"><li style="list-style-type:disc">WebSocket provides full-duplex (i.e., bidirectional) communication channels to enable client-server interaction over a single, persistent <strong>Transmission Control Protocol (TCP)</strong> connection.</li></ul><ul id="17ee0021-eb2d-8016-a1e2-d6e25e4a44cb" class="bulleted-list"><li style="list-style-type:disc">Used for<strong><span style="border-bottom:0.05em solid"> Instant Messaging app like Whats app, Telegram</span></strong></li></ul><h3 id="17ee0021-eb2d-80dd-9b9b-ee7943412f55" class="">HTTP</h3><ul id="17ee0021-eb2d-8086-8b7e-d0bec8dd1f04" class="bulleted-list"><li style="list-style-type:disc">Has a unidirectional request-response model (client requests, server responds.). Connection Oriented.</li></ul><ul id="17ee0021-eb2d-8001-a8b8-cbe27e6cd546" class="bulleted-list"><li style="list-style-type:disc">Provides a <strong><span style="border-bottom:0.05em solid">stateless</span></strong> connection that requires establishing a new connection for each request. </li></ul><ul id="17ee0021-eb2d-8058-b2e8-cdad751628c1" class="bulleted-list"><li style="list-style-type:disc">Uses long polling, a mechanism designed to help keep HTTP client-server connections alive until a request or response is fetched.</li></ul><ul id="17ee0021-eb2d-80f5-8d61-f6ecd31a8351" class="bulleted-list"><li style="list-style-type:disc">Requires new handshakes and header negotiation for each request, meaning higher latency and overhead.</li></ul><table id="17ee0021-eb2d-80d9-a78f-c0004ef0c526" class="simple-table"><thead class="simple-table-header"><tr id="17ee0021-eb2d-80c2-b312-d6bbb0c3edcf"><th id="zLH;" class="simple-table-header-color simple-table-header" style="width:220.66666666666666px"><strong>Feature</strong></th><th id="_JLK" class="simple-table-header-color simple-table-header" style="width:220.66666666666666px"><strong>WebSocket</strong></th><th id="=FUr" class="simple-table-header-color simple-table-header" style="width:228.65625px"><strong>HTTP</strong></th><th id="GlPe" class="simple-table-header-color simple-table-header"></th></tr></thead><tbody><tr id="17ee0021-eb2d-8074-be86-c744cd75a928"><td id="zLH;" class="" style="width:220.66666666666666px"><strong>Communication model</strong></td><td id="_JLK" class="" style="width:220.66666666666666px">Has a full-duplex/bidirectional model. Once the connection is established, either party can send updates without being prompted.</td><td id="=FUr" class="" style="width:228.65625px">Has a unidirectional request-response model (client requests, server responds.)</td><td id="GlPe" class=""></td></tr><tr id="17ee0021-eb2d-8000-9d8f-c7271b77537a"><td id="zLH;" class="" style="width:220.66666666666666px"><strong>Lifespan</strong></td><td id="_JLK" class="" style="width:220.66666666666666px">Offers a stateful, persistent connection that is ideal for instant data transmission without the overhead of constant request and response cycles.</td><td id="=FUr" class="" style="width:228.65625px">Provides a stateless connection that requires establishing a new connection for each request. Uses long polling, a mechanism designed to help keep HTTP client-server connections alive until a request or response is fetched.</td><td id="GlPe" class=""></td></tr><tr id="17ee0021-eb2d-8016-8511-c58cbc8c971a"><td id="zLH;" class="" style="width:220.66666666666666px"><strong>Latency/overhead</strong></td><td id="_JLK" class="" style="width:220.66666666666666px">Eliminates the need for frequent handshakes, header negotiation, and long polling, thus offering lower latency and limiting overhead. Messages are sent in frames without the need for redundant header information, since connection is persistent.</td><td id="=FUr" class="" style="width:228.65625px">Requires new handshakes and header negotiation for each request, meaning higher latency and overhead.</td><td id="GlPe" class=""></td></tr><tr id="17ee0021-eb2d-8060-b93c-d39634139a41"><td id="zLH;" class="" style="width:220.66666666666666px"><strong>TCP</strong></td><td id="_JLK" class="" style="width:220.66666666666666px">Natively supports TCP only. TCP provides data packet delivery in order, with mechanisms for error detection, retransmission and congestion control, leading to high reliability.</td><td id="=FUr" class="" style="width:228.65625px">Runs on TCP, but <a href="https://gcore.com/learning/what-is-http-3/">HTTP3</a> uses User Datagram Protocol (UDP) to boost network speed.</td><td id="GlPe" class=""></td></tr><tr id="17ee0021-eb2d-8038-b502-f93359c45b59"><td id="zLH;" class="" style="width:220.66666666666666px"><strong>Event ordering</strong></td><td id="_JLK" class="" style="width:220.66666666666666px">Does not follow request-response order once connection is established; either client or server can send updates.</td><td id="=FUr" class="" style="width:228.65625px">Uses a request-response pattern that is ideal for websites or apps that require packet synchronization in query-result order.</td><td id="GlPe" class=""></td></tr><tr id="17ee0021-eb2d-8062-b4e2-eff8d39428b7"><td id="zLH;" class="" style="width:220.66666666666666px"><strong>Caching</strong></td><td id="_JLK" class="" style="width:220.66666666666666px">Does not support caching since it is mostly suited for dynamic data transmission. Supports real-time updates only.</td><td id="=FUr" class="" style="width:228.65625px">Caches static data to speed up response delivery.</td><td id="GlPe" class=""></td></tr><tr id="17ee0021-eb2d-80a0-9611-fbc400ff3bbe"><td id="zLH;" class="" style="width:220.66666666666666px"><strong>Binary data support</strong></td><td id="_JLK" class="" style="width:220.66666666666666px">Handles binary data transmission natively, allowing the efficient transfer of multimedia content like images and videos.</td><td id="=FUr" class="" style="width:228.65625px">Natively text-based. Requires additional protocols or encoding (e.g., Base64) to handle binary data.</td><td id="GlPe" class=""></td></tr><tr id="17ee0021-eb2d-8042-93fe-e0834728ec13"><td id="zLH;" class="" style="width:220.66666666666666px"><strong>Encryption and address</strong></td><td id="_JLK" class="" style="width:220.66666666666666px">Offers a <a href="https://gcore.com/learning/what-is-encryption/">secure (encrypted) version</a>. The address of the unencrypted version starts with ws:// and the encrypted version with wss://.</td><td id="=FUr" class="" style="width:228.65625px">Offers similar functionalities to WebSocket via http:// and https://.</td><td id="GlPe" class=""></td></tr></tbody></table><h2 id="17ee0021-eb2d-8007-a07c-e885bcd7647b" class="">Peer-to-Peer Protocol</h2><figure id="17ee0021-eb2d-80ac-8bcb-d5d25272e5a5" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/a430d96f-0705-49f6-abe0-a04395bed9a8.png"><img style="width:455.5665024630542px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/a430d96f-0705-49f6-abe0-a04395bed9a8.png"/></a></figure><h2 id="17ee0021-eb2d-80ca-8262-fa085e0c7607" class="">Transport Layer →</h2><div id="17ee0021-eb2d-80fa-b85b-e3e3cb93d976" class="column-list"><div id="17ee0021-eb2d-8009-97b2-da8a82fc9ca8" style="width:100%" class="column"><p id="17ee0021-eb2d-804a-9a07-f6e1f294f88b" class=""><strong><span style="border-bottom:0.05em solid">TCP</span></strong></p><ul id="17ee0021-eb2d-8078-96f9-c893597f158a" class="bulleted-list"><li style="list-style-type:disc">Stateful.</li></ul><ul id="17ee0021-eb2d-8099-ad21-ff231b3c0633" class="bulleted-list"><li style="list-style-type:disc">Single virtual connection</li></ul><ul id="17ee0021-eb2d-8041-8527-e8f4e5f96196" class="bulleted-list"><li style="list-style-type:disc">Data is sent through single virtual connection</li></ul><ul id="17ee0021-eb2d-8018-ad25-e6156105c664" class="bulleted-list"><li style="list-style-type:disc">Ordering of packet is maintained.</li></ul><ul id="17ee0021-eb2d-80cd-82d2-e44128cb1fa2" class="bulleted-list"><li style="list-style-type:disc">If server receives the packet, it sends acknowledgment to the client</li></ul><ul id="17ee0021-eb2d-8044-b782-ecf2f1192096" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Web Socket uses TCP</span></strong></li></ul><p id="17ee0021-eb2d-80a9-a386-f41763d895e7" class="">
</p></div><div id="17ee0021-eb2d-80cf-a2f9-ece61d46cb31" style="width:100%" class="column"><p id="17ee0021-eb2d-8050-97f6-c97662c15d6f" class=""><strong><span style="border-bottom:0.05em solid">UDP</span></strong></p><ul id="17ee0021-eb2d-800f-869f-e909a2e2ac3f" class="bulleted-list"><li style="list-style-type:disc">Stateless</li></ul><ul id="17ee0021-eb2d-8060-9d82-d10c7a536249" class="bulleted-list"><li style="list-style-type:disc">Multiple virtual connection</li></ul><ul id="17ee0021-eb2d-80eb-8424-f4080994221d" class="bulleted-list"><li style="list-style-type:disc">No ordering of data packets</li></ul><ul id="17ee0021-eb2d-808e-a87f-db2fbd0513d9" class="bulleted-list"><li style="list-style-type:disc">All packets are sent in parallel, over multiple virtual connections.</li></ul><ul id="17ee0021-eb2d-8091-9251-f7320d13fabf" class="bulleted-list"><li style="list-style-type:disc">No single connection.</li></ul><ul id="17ee0021-eb2d-8025-87fb-ef5ee049a8dd" class="bulleted-list"><li style="list-style-type:disc">There is no acknowledgement sent to client.</li></ul><ul id="17ee0021-eb2d-8027-98e0-c1a52feb0ef9" class="bulleted-list"><li style="list-style-type:disc">Faster than TCP why ?<ul id="17ee0021-eb2d-8029-aec5-d345dcb97a4e" class="bulleted-list"><li style="list-style-type:circle">No ACK</li></ul><ul id="17ee0021-eb2d-808e-bf00-d02b407aa931" class="bulleted-list"><li style="list-style-type:circle">No ordering</li></ul><ul id="17ee0021-eb2d-80ee-af02-c7beef376e6b" class="bulleted-list"><li style="list-style-type:circle">No single connection is maintained</li></ul></li></ul><ul id="17ee0021-eb2d-8092-9600-c8c65d565d17" class="bulleted-list"><li style="list-style-type:disc">Considered best-effort mode of communication, as it does not guarantee data delivery.</li></ul><ul id="17ee0021-eb2d-8074-97d8-d6c0d4875ded" class="bulleted-list"><li style="list-style-type:disc">Used for Live Streaming, Video Calling</li></ul><ul id="17ee0021-eb2d-8042-be2a-f05435669bb9" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Web RTC Protocol uses UDP</span></strong></li></ul></div></div></div></details><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">DNS Resolution</summary><div class="indented"><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="184e0021-eb2d-803e-afc1-e1f859c797ad"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="184e0021-eb2d-807f-aade-d2417e525072" class="">Phonebook of the internet</p></div></figure><ul id="184e0021-eb2d-8043-a39a-c797e1488bbe" class="bulleted-list"><li style="list-style-type:disc">The Domain Name System (DNS) serves as a fundamental component of the internet infrastructure, <strong><span style="border-bottom:0.05em solid">translating user-friendly domain names into their corresponding IP addresses</span></strong>. </li></ul><ul id="184e0021-eb2d-804a-bef6-f60e010a91cb" class="bulleted-list"><li style="list-style-type:disc">It acts as a phonebook for the internet, enabling users to access websites and services by entering easily memorable domain names, such as <a href="https://archive.is/o/6VRzb/www.designgurus.io/">www.designgurus.io</a>, rather than the numerical IP addresses like &quot;192.0.2.1&quot; that computers utilize to identify each other.</li></ul><ul id="184e0021-eb2d-80fd-93c3-d41f5deef9a6" class="bulleted-list"><li style="list-style-type:disc">DNS Resolution →<ul id="184e0021-eb2d-804e-8598-ef6a7960bb8e" class="bulleted-list"><li style="list-style-type:circle">When you input a domain name into your web browser, the DNS is responsible for finding the associated IP address and directing your request to the appropriate server. </li></ul><ul id="184e0021-eb2d-80b1-bebc-c3de4ed52529" class="bulleted-list"><li style="list-style-type:circle">This process commences with your computer sending a query to a recursive resolver, which then searches a series of DNS servers, beginning with the root server, followed by the Top-Level Domain (TLD) server, and ultimately the authoritative name server. </li></ul><ul id="184e0021-eb2d-80fd-a298-f0bc531fdb9c" class="bulleted-list"><li style="list-style-type:circle">Once the IP address is located, the recursive resolver returns it to your computer, allowing your browser to establish a connection with the target server and access the desired content.</li></ul></li></ul><ul id="117e0021-eb2d-8093-be1d-f4a397b9c9cf" class="bulleted-list"><li style="list-style-type:disc">Single Server Setup where everything is running on one server: web app, database, cache etc.<figure id="117e0021-eb2d-8079-88c3-dbedcb2d2a0b" class="image" style="text-align:center"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%202.png"><img style="width:384px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%202.png"/></a></figure></li></ul><h2 id="117e0021-eb2d-8089-9fa4-e0706e2cd4b2" class="">Request flow - DNS Resolution</h2><div id="117e0021-eb2d-8076-99dc-fa3a1c043b38" class="column-list"><div id="117e0021-eb2d-804a-8e1f-dca0d004bddd" style="width:100%" class="column"><ol type="1" id="117e0021-eb2d-80e3-939c-eb3e1ce6d9f9" class="numbered-list" start="1"><li>User access websites through domain name, in this case <em>api.mysite.com</em>. Usually, the Domain Name System (DNS) is a paid service provided by third-parties and not hosted by our servers.</li></ol><ol type="1" id="117e0021-eb2d-80fb-8680-c98fa39ad5ae" class="numbered-list" start="2"><li>Internet Protocol (IP) address is returned to the browser by DNS.</li></ol></div><div id="117e0021-eb2d-8049-ab55-f9ec74f51e0f" style="width:100%" class="column"><figure id="117e0021-eb2d-8003-86f2-ea3fb423e8be" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%203.png"><img style="width:679.984375px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%203.png"/></a></figure></div></div><ol type="1" id="117e0021-eb2d-80cd-95d2-e4de01d87dd2" class="numbered-list" start="3"><li>Once the IPS address is obtained, HTTP (Hypertext Transfer Protocol) requests are sent directly to the web server.</li></ol><ol type="1" id="117e0021-eb2d-80c7-8705-c7e78ba37b01" class="numbered-list" start="4"><li>The web server returns HTML pages or JSON response for rendering.</li></ol></div></details><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">APIs</summary><div class="indented"><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="110e0021-eb2d-8087-999c-da80c7189b9d"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="110e0021-eb2d-8002-ba6a-f3438161b4e6" class="">The formal definition of an API (Application Programming Interface) is the set of rules or contracts through which two or more software entities communicate.</p></div></figure><p id="110e0021-eb2d-809f-b906-c2f247e40b95" class="">When we design the communication mechanism of our software, we will need to make choices that best suit our use case. Here we will explore the common architectural styles, review their strengths, and explain when they are more suitable.</p><h3 id="110e0021-eb2d-80cc-93ba-fd93f55deb48" class="">REST or Representational State Transfer</h3><ul id="110e0021-eb2d-804e-87d7-ce825687e4f4" class="bulleted-list"><li style="list-style-type:disc">APIs must be modeled based on the resources in the system.</li></ul><ul id="110e0021-eb2d-80f8-be9f-c2585b3f766f" class="bulleted-list"><li style="list-style-type:disc">A single URI to access that resource is used, and various actions based on HTTP verbs (GET/PUT/POST/PATCH/DELETE) can be performed on the resources whenever possible.<ul id="110e0021-eb2d-80cb-8921-c42ff6c6c5a0" class="bulleted-list"><li style="list-style-type:circle"><strong>GET</strong>: Used to retrieve data from a server.</li></ul><ul id="110e0021-eb2d-808f-a9ee-f1fde35bda42" class="bulleted-list"><li style="list-style-type:circle"><strong>PUT</strong>: Used to update or replace an existing resource.</li></ul><ul id="110e0021-eb2d-8039-ba4a-cb8038cfaaff" class="bulleted-list"><li style="list-style-type:circle"><strong>POST</strong>: Used to send data to the server to create a new resource.</li></ul><ul id="110e0021-eb2d-802b-a43a-efbd145b2f35" class="bulleted-list"><li style="list-style-type:circle"><strong>PATCH</strong> : Partially update a resource. This means you only need to send the data that you want to change, without affecting the rest of the resource.</li></ul><ul id="110e0021-eb2d-8050-b31a-c1acfaa3f2f8" class="bulleted-list"><li style="list-style-type:circle"><strong>DELETE</strong>: Used to remove a resource from the server.</li></ul></li></ul><ul id="110e0021-eb2d-80bd-9bea-d19a22e2e20e" class="bulleted-list"><li style="list-style-type:disc"><strong>Strength</strong> :<ul id="110e0021-eb2d-8029-8095-dff3fda339eb" class="bulleted-list"><li style="list-style-type:circle">This approach <strong><span style="border-bottom:0.05em solid">creates structured ways of getting and modifying information from your database. </span></strong></li></ul><ul id="110e0021-eb2d-802c-9a20-ed8402b3c870" class="bulleted-list"><li style="list-style-type:circle">It is the <strong><span style="border-bottom:0.05em solid">most universally used and works for most circumstances</span></strong>. </li></ul><ul id="110e0021-eb2d-8098-85ac-c65bb3c8b21c" class="bulleted-list"><li style="list-style-type:circle">This method also tends to have tooling that supports generation of documentation that can make it easier for developers to understand, especially for external services accessing the API through network calls.</li></ul></li></ul><ul id="110e0021-eb2d-80e5-98e5-f5ad276f2454" class="bulleted-list"><li style="list-style-type:disc"><strong>Weakness</strong> :<ul id="110e0021-eb2d-80bd-b5d7-d5f4d9b6c91c" class="bulleted-list"><li style="list-style-type:circle">It requires you <strong><span style="border-bottom:0.05em solid">to write the requests for each type of entity in your database</span></strong>, in contrast to GraphQL where no separate inquiries are required to grab all the data the caller needs. </li></ul><ul id="110e0021-eb2d-804d-b5cc-fe9a03f6e77f" class="bulleted-list"><li style="list-style-type:circle">It also isn&#x27;t as space efficient as RPC.</li></ul></li></ul><h3 id="110e0021-eb2d-802e-9539-f07da6a95b9a" class="">RPC or Remote Procedure Call</h3><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="110e0021-eb2d-80ac-8b63-e061f5efa0f2"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="110e0021-eb2d-806e-bf74-cf558232479f" class=""><strong>RPC allows the execution of a procedure or command in a remote machine. </strong></p></div></figure><ul id="110e0021-eb2d-8049-9b39-e73416623ac3" class="bulleted-list"><li style="list-style-type:disc">In other words, you can write code that executes on another computer internally in the same way you write code that runs on the current machine. </li></ul><ul id="110e0021-eb2d-800f-a087-f50cc302c2b7" class="bulleted-list"><li style="list-style-type:disc">In this approach, <strong><span style="border-bottom:0.05em solid">the API is more thought of as an action or command</span></strong>. And it is easier to add these functions to extend the functionality.</li></ul><ul id="110e0021-eb2d-808e-9a70-cfc48d1e5b69" class="bulleted-list"><li style="list-style-type:disc">RPC APIs allow developers <strong><span style="border-bottom:0.05em solid">to call remote functions in external servers as if they were local to their software</span></strong>. For example, you can add chat functionality to your application by remotely calling messaging functions on another chat application.</li></ul><ul id="110e0021-eb2d-808d-90f7-cde74a8d38b3" class="bulleted-list"><li style="list-style-type:disc"><strong>Strengths:</strong> It is more space efficient than REST, and it makes development easier since the code you write that requires communication to other computers does not require much special syntax.</li></ul><h3 id="110e0021-eb2d-804e-9ca0-d6e8a3174c70" class="">GraphQL</h3><ul id="110e0021-eb2d-809c-95a6-fdcbe0220f34" class="bulleted-list"><li style="list-style-type:disc">In GraphQL you <strong><span style="border-bottom:0.05em solid">structure the data in graph relationships and then leave it for those using your service to define what they need.</span></strong></li></ul><ul id="110e0021-eb2d-809a-abfb-d99a99031053" class="bulleted-list"><li style="list-style-type:disc">This modeling technique enables building a perfect request to fetch all the data that is needed by the client without making multiple calls. </li></ul><ul id="110e0021-eb2d-80cf-bebf-c7445b7e4d19" class="bulleted-list"><li style="list-style-type:disc">A very important step in this is building the right schema, which encompasses all the queries you can make using the APIs and the data types that can be returned. It is more widely used in mobile applications and other systems where graph-like data fits in.</li></ul><ul id="110e0021-eb2d-8038-9f92-c5b74ebeadfd" class="bulleted-list"><li style="list-style-type:disc"><strong>Strengths:</strong> <ul id="110e0021-eb2d-80ae-b6da-c44720cb2967" class="bulleted-list"><li style="list-style-type:circle">GraphQL works particularly well for customer-facing web and mobile applications, because once you set up the system, frontend developers can craft their own requests to get and modify information without requiring backend work to build more routes.</li></ul></li></ul></div></details><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">REST vs RPC</summary><div class="indented"><h3 id="110e0021-eb2d-80d2-b318-e70829f5403f" class="">Similarities</h3><ul id="110e0021-eb2d-8096-b7ca-c72169f07f14" class="bulleted-list"><li style="list-style-type:disc">Abstraction → lower-level communications are abstracted away from API dev. Allows devs to focus on function rather than technical implementation</li></ul><ul id="110e0021-eb2d-80f3-92fe-d0bcd7ab5663" class="bulleted-list"><li style="list-style-type:disc">Communication → <ul id="110e0021-eb2d-8070-bd12-e48fb517efa1" class="bulleted-list"><li style="list-style-type:circle">Both uses HTTP as underlying protocol.</li></ul><ul id="110e0021-eb2d-80ac-b463-f18ec114ea2d" class="bulleted-list"><li style="list-style-type:circle">Most popular message formats in RPC and REST are <strong><span style="border-bottom:0.05em solid">JSON and XML</span></strong>.</li></ul><ul id="110e0021-eb2d-80c7-a8b1-d6d92e0a3b1f" class="bulleted-list"><li style="list-style-type:circle"><strong><span style="border-bottom:0.05em solid">JSON is favoured due to its readability and flexibility.</span></strong></li></ul></li></ul><ul id="110e0021-eb2d-80fb-9739-c5eef205f904" class="bulleted-list"><li style="list-style-type:disc">Cross- language compatibility →<ul id="110e0021-eb2d-80c6-bdd7-d27ee0a2d7ad" class="bulleted-list"><li style="list-style-type:circle">Developers can implement a RESTful or RPC API in <strong><span style="border-bottom:0.05em solid">any language they choose</span></strong>. </li></ul><ul id="110e0021-eb2d-8015-b253-f6c9275a0284" class="bulleted-list"><li style="list-style-type:circle">So long as the network communication element of the API conforms with the RESTful or RPC interface standard, you can write the rest of the code in any programming language.</li></ul></li></ul><h3 id="110e0021-eb2d-80ca-a836-c4a0df5c4903" class="">Architecture principles</h3><ul id="110e0021-eb2d-8093-97d4-d37902cade0f" class="bulleted-list"><li style="list-style-type:disc"><strong>RPC</strong> → <strong><span style="border-bottom:0.05em solid">the client makes a remote function (also known as method or procedure) call on a server. Typically</span></strong>, <strong><span style="border-bottom:0.05em solid">one or more data values are passed</span></strong> to the server during the call.</li></ul><ul id="110e0021-eb2d-8043-95cd-f790d2d561ca" class="bulleted-list"><li style="list-style-type:disc"><strong>REST</strong> →<strong><span style="border-bottom:0.05em solid"> client requests the server to perform an action on a specific server resource. </span></strong>Actions are limited to <strong><span style="border-bottom:0.05em solid">create, read, update, and delete (CRUD) only and are conveyed as HTTP verbs or HTTP methods.</span></strong></li></ul><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="110e0021-eb2d-8094-a3cf-c630fcf555bf"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><ul id="110e0021-eb2d-80a6-8a19-f613d17898d8" class="bulleted-list"><li style="list-style-type:disc"><strong>RPC focuses on functions or actions, while REST focuses on resources or objects.</strong></li></ul></div></figure><ul id="110e0021-eb2d-8055-aa75-ce8e0455c3f6" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">RPC Principles</span></strong> →<ul id="110e0021-eb2d-8006-bb9b-d15f0871bc00" class="bulleted-list"><li style="list-style-type:circle">Remote Invocation : An RPC call is made by a client to a function on the remote server as if it were called locally to the client.</li></ul><ul id="110e0021-eb2d-80c4-8c0e-fb076a30386c" class="bulleted-list"><li style="list-style-type:circle">Passing Parameters : The client typically sends parameters to a server function, much the same as a local function.</li></ul><ul id="110e0021-eb2d-80ab-8d53-e8acc6878bed" class="bulleted-list"><li style="list-style-type:circle">Stubs : Function stubs exist on both the client and the server. On the client side, it makes the function call. On the server, it invokes the actual function.</li></ul></li></ul><ul id="110e0021-eb2d-801e-a39a-c08e63181d58" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">REST principles</span></strong> →<ul id="110e0021-eb2d-80b0-99a7-c0fe1960433a" class="bulleted-list"><li style="list-style-type:circle">Client-Server Architecture : The client-server architecture of REST decouples clients and servers. It treats them each as independent systems.</li></ul><ul id="110e0021-eb2d-8031-bc2c-db7a5404a1c2" class="bulleted-list"><li style="list-style-type:circle">Stateless : The server keeps no record of the state of the client between client requests.</li></ul><ul id="110e0021-eb2d-8028-9793-e839db982185" class="bulleted-list"><li style="list-style-type:circle">Cacheable : The client or intermediary systems may cache server responses based on whether a client specifies that the response may be cached.</li></ul><ul id="110e0021-eb2d-805b-b7c8-cfad37c539b6" class="bulleted-list"><li style="list-style-type:circle">Layered System : Intermediaries can exist between the client and the server. Both client and server have no knowledge of them and operate as if they were directly connected.</li></ul><ul id="110e0021-eb2d-8004-ad4b-f982f3533d39" class="bulleted-list"><li style="list-style-type:circle">Uniform Interface : The client and server communicate via a standardized set of instructions and messaging formats with the REST API. Resources are identified by their URL, and this URL is known as a REST API endpoint.</li></ul></li></ul><h3 id="110e0021-eb2d-80ce-ae1c-ecc49b0c7305" class="">When to use REST vs RPC</h3><ul id="110e0021-eb2d-807c-ae61-ee1f91853cbb" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Remote Procedure Call (RPC)</span></strong> is typically used to call remote functions on a server that require an action result. You can use it when you require complex calculations or want to trigger a remote procedure on the server, with the process hidden from the client.</li></ul><ul id="110e0021-eb2d-8059-8515-e97f1bc9904f" class="bulleted-list"><li style="list-style-type:disc">Here are actions where RPC is a good option:<ul id="110e0021-eb2d-8080-a886-d5b3600012dc" class="bulleted-list"><li style="list-style-type:circle">Take a picture with a remote device’s camera</li></ul><ul id="110e0021-eb2d-806a-bf7e-eef2b14f6cdc" class="bulleted-list"><li style="list-style-type:circle">Use a machine learning algorithm on the server to identify fraud</li></ul><ul id="110e0021-eb2d-8085-b29b-e625e01847c5" class="bulleted-list"><li style="list-style-type:circle">Transfer money from one account to another on a remote banking system</li></ul><ul id="110e0021-eb2d-80f1-8a08-c29e23ce63b4" class="bulleted-list"><li style="list-style-type:circle">Restart a server remotely</li></ul></li></ul><ul id="110e0021-eb2d-80b2-89b4-dc395b5581b3" class="bulleted-list"><li style="list-style-type:disc">A <strong><span style="border-bottom:0.05em solid">REST API</span></strong> is typically used to perform create, read, update, and delete (CRUD) operations on a data object on a server. This makes REST APIs a good fit for cases when server data and data structures need to be exposed uniformly.</li></ul><ul id="110e0021-eb2d-8059-98c2-d6fc8d11ada3" class="bulleted-list"><li style="list-style-type:disc">Here are actions where a REST API is a good option:<ul id="110e0021-eb2d-800c-8093-f188379b423d" class="bulleted-list"><li style="list-style-type:circle">Add a product to a database</li></ul><ul id="110e0021-eb2d-80da-ba9a-f06f74c8f4d3" class="bulleted-list"><li style="list-style-type:circle">Retrieve the contents of a music playlist</li></ul><ul id="110e0021-eb2d-8055-8e5c-cd2a31da5963" class="bulleted-list"><li style="list-style-type:circle">Update a person’s address</li></ul><ul id="110e0021-eb2d-806d-9df9-c4a30deaab59" class="bulleted-list"><li style="list-style-type:circle">Delete a blog post</li></ul><h3 id="110e0021-eb2d-808a-a27c-c03bc8bea967" class="">Summary of differences</h3></li></ul><table id="110e0021-eb2d-806c-a78b-f70d2b7cdb03" class="simple-table"><tbody><tr id="a7d75a4b-8ce1-4eec-b975-6851c332491c"><td id="kgze" class=""></td><td id="JG=\" class="" style="width:257px"><strong>RPC</strong></td><td id="g]{`" class="" style="width:276.75px"><strong>REST</strong></td></tr><tr id="001334f5-2aff-4ed2-81e6-2d5bca07d230"><td id="kgze" class=""><strong>What is it ?</strong></td><td id="JG=\" class="" style="width:257px">A system allows a remote client to call a procedure on a server as if it were local. </td><td id="g]{`" class="" style="width:276.75px">A set of rules that defines structured data exchange between a client and a server.</td></tr><tr id="79280cb6-7908-4774-a714-925845c69038"><td id="kgze" class=""><strong>Used for</strong></td><td id="JG=\" class="" style="width:257px">Performing actions on a remote server.</td><td id="g]{`" class="" style="width:276.75px">Create, read, update, and delete (CRUD) operations on remote objects.</td></tr><tr id="110e0021-eb2d-803f-beda-d4c5140aaa65"><td id="kgze" class=""><strong>Best fit</strong></td><td id="JG=\" class="" style="width:257px">When requiring complex calculations or triggering a remote process on the server.</td><td id="g]{`" class="" style="width:276.75px">When server data and data structures need to be exposed uniformly.</td></tr><tr id="110e0021-eb2d-805a-9ba0-ea83d7a750a2"><td id="kgze" class=""><strong>Statefulness</strong></td><td id="JG=\" class="" style="width:257px">Stateless or stateful.</td><td id="g]{`" class="" style="width:276.75px">Stateless.</td></tr><tr id="110e0021-eb2d-800e-8775-fe4cd0a95f7d"><td id="kgze" class=""><strong>Data passing format</strong></td><td id="JG=\" class="" style="width:257px">In a consistent structure defined by the server and enforced on the client.</td><td id="g]{`" class="" style="width:276.75px">In a structure determined independently by the server. Multiple different formats can be passed within the same API.</td></tr></tbody></table></div></details><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">Databases (SQL vs NoSQL)</summary><div class="indented"><p id="117e0021-eb2d-805e-83e7-d1cf900ddb0e" class="">With the growth of the user base, one server is not enough, and we need multiple servers: one for web/mobile traffic, the other for the database. Separating web/mobile traffic<br/>(web tier) and database (data tier) servers allows them to be scaled independently.<br/></p><figure id="117e0021-eb2d-80d8-b378-f2ac577b0c77" class="image" style="text-align:center"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%204.png"><img style="width:480px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%204.png"/></a></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="110e0021-eb2d-80d4-95ce-f15563cff452"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="110e0021-eb2d-8047-bb22-e87494fe870b" class=""><strong>How is this topic used in system design interviews?</strong></p><p id="110e0021-eb2d-802d-9dee-f3f1112f67b6" class="">Since you&#x27;ll be tasked with designing a <strong><span style="border-bottom:0.05em solid">performant, scalable system</span></strong>, it’s important to decide how your system should store its data.</p><p id="110e0021-eb2d-80c1-804e-e17c17141246" class=""><strong>Remember</strong></p><p id="110e0021-eb2d-801a-a770-c68bbfb6f1e7" class="">There is no strictly wrong answer for which database to use, as long as you can justify yourself and demonstrate an understanding of the alternative options.</p></div></figure><details open=""><summary style="font-weight:600;font-size:1.5em;line-height:1.3;margin:0">SQL</summary><div class="indented"><ul id="110e0021-eb2d-8083-b158-fdcaa61c2409" class="bulleted-list"><li style="list-style-type:disc">An SQL database is a <strong><span style="border-bottom:0.05em solid">relational database</span></strong> that is composed of tables where each row reflects a data entity and each column defines specific information about the field.</li></ul><ul id="117e0021-eb2d-8019-a02c-eebeeab4d977" class="bulleted-list"><li style="list-style-type:disc">One can perform Join operations using SQL across different database tables.</li></ul><ul id="110e0021-eb2d-80d1-afaa-f2551769d74e" class="bulleted-list"><li style="list-style-type:disc">✅ For example, in the cat database below, you can see that there are three tables: People Table, PetOwner Table, and Cat Table. Data within an SQL table is stored in these strict relationships.</li></ul><ul id="111e0021-eb2d-809c-946d-e73ddf869eae" class="bulleted-list"><li style="list-style-type:disc">SQL database is composed of separate tables holding bits of information that connect</li></ul><figure id="111e0021-eb2d-809c-8617-d523b9ab3644" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%205.png"><img style="width:679.984375px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%205.png"/></a></figure><h3 id="111e0021-eb2d-80e9-8637-c65c286ff32d" class=""><strong>Advantages</strong> -</h3><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="111e0021-eb2d-80a5-b664-f75f2abf0311"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="111e0021-eb2d-80b1-9dbf-cdc8b16c1361" class=""><strong><span style="border-bottom:0.05em solid">SQL offers more powerful querying out of the box</span></strong></p></div></figure><ul id="111e0021-eb2d-80e2-b7d5-f8c5bbe11049" class="bulleted-list"><li style="list-style-type:disc"><strong>craft a specific query using the language SQL</strong> that searches for the data that you want without having to write custom code. </li></ul><ul id="111e0021-eb2d-805e-ae34-ef1076c74653" class="bulleted-list"><li style="list-style-type:disc">This is an advantage over time because the compiler that transforms your SQL query into machine code can be optimized over time independent of business logic.</li></ul><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="111e0021-eb2d-8003-a87a-ce1aa9f59ece"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="111e0021-eb2d-8034-b8c3-dcc9227fca10" class=""><strong><span style="border-bottom:0.05em solid">SQL has stronger ACID guarantees out-of-the-box</span></strong></p></div></figure><p id="111e0021-eb2d-8022-8e30-d11f31627982" class=""><strong>When to use SQL ?</strong></p><p id="111e0021-eb2d-80b8-8e99-f8dc519c2b78" class="">Important that customers using service always see up-to-date information, even if sometimes there is a slight delay → <strong><span style="border-bottom:0.05em solid">STRONG CONSISTENCY</span></strong></p><p id="111e0021-eb2d-80c1-9409-f7aeafa38632" class=""><span style="border-bottom:0.05em solid">Good use-case</span> → Build a service to manage payments.</p><p id="111e0021-eb2d-8029-82d1-cb208fac8909" class="">In such a service it is important to always show the right values and for the system to reliably handle situations of failure to avoid issues like overcharging a customer.</p><p id="111e0021-eb2d-80e9-b9d7-e8f8d75b3045" class=""><span style="border-bottom:0.05em solid">Use-case where SQL is not required</span> → Whatsapp where it is completely acceptable to be out of sync for a couple of seconds</p><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="111e0021-eb2d-801c-8c91-ca3ded0794f0"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="111e0021-eb2d-8066-9d8c-e25dbb7dd874" class=""><strong><span style="border-bottom:0.05em solid">SQL ensures ACID out of the box which makes it a good choice for cases where high consistency</span></strong></p></div></figure><ul id="111e0021-eb2d-8029-8b90-e3ab32caad3b" class="bulleted-list"><li style="list-style-type:disc"><strong>Atomicity</strong>: the transaction (changes) completes in its entirety without failures or the transaction is reverted. There is no case where only half the writes are changed leading to inconsistency. <em><strong><span style="border-bottom:0.05em solid">“All or nothing” rule</span></strong></em></li></ul><ul id="111e0021-eb2d-805e-94b0-d92399d2e641" class="bulleted-list"><li style="list-style-type:disc"><strong>Consistency</strong>: <ul id="111e0021-eb2d-800c-b608-e2f1f1e98782" class="bulleted-list"><li style="list-style-type:circle">By default, <strong><span style="border-bottom:0.05em solid">SQL has strong consistency</span></strong>. Put another way, you are guaranteed to be <strong><span style="border-bottom:0.05em solid">internally consistent</span></strong>. This is done by <strong><span style="border-bottom:0.05em solid">locking certain parts of the database when it is being written, forcing other requests to wait. </span></strong></li></ul><ul id="111e0021-eb2d-80cc-89a8-d69373a74c94" class="bulleted-list"><li style="list-style-type:circle">This is in contrast with <strong><span style="border-bottom:0.05em solid">NoSQL databases that by default have eventual consistency</span></strong>. This means that when you query the database the data might be stale for a couple of seconds before it becomes consistent.</li></ul></li></ul><ul id="111e0021-eb2d-80c8-98bd-fcb88607876c" class="bulleted-list"><li style="list-style-type:disc"><strong>Isolation</strong>: All read and write requests within a transaction are not impacted by other transactions. This ensures that the changes being made in one transaction are not available in other transactions.</li></ul><ul id="111e0021-eb2d-8089-9ecc-d09c77bda24f" class="bulleted-list"><li style="list-style-type:disc"><strong>Durability</strong>: In case of failure for a given transaction the data is not lost and can be recovered.</li></ul><h3 id="111e0021-eb2d-80a7-8520-d609a25a3b72" class="">Disadvantages -</h3><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="111e0021-eb2d-80b1-bdde-d0fd32ffe219"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="111e0021-eb2d-80d4-8058-fc6038ea9c17" class=""><strong>SQL DBs are slower for writing and faster for reading.</strong></p></div></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="111e0021-eb2d-80f4-a0a3-cc0d887af0eb"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="111e0021-eb2d-808d-acf9-c8181c227027" class="">🔴 <strong>NoSQL databases typically have slower reads and faster writes.</strong></p></div></figure><ul id="111e0021-eb2d-806f-be01-c420564fa823" class="bulleted-list"><li style="list-style-type:disc">Balanced tress using in SQL DB are slower to write into.</li></ul><ul id="111e0021-eb2d-80fc-b540-d24aaa5f3252" class="bulleted-list"><li style="list-style-type:disc">SQL DBs are stored in a Balanced tree structure that divides the available space into fixed-size blocks called <em>pages (fundamental unit of data storage in SQL server).</em></li></ul><ul id="111e0021-eb2d-8057-bca6-e2c8ad47ddb6" class="bulleted-list"><li style="list-style-type:disc">Each page is traditionally 4 KB in size and maps onto a specific sector of hard drive space.</li></ul><ul id="111e0021-eb2d-802e-8152-d79bea545e80" class="bulleted-list"><li style="list-style-type:disc">Once a page becomes too large, this page is repartitioned to point to a new children pages and the values get sorted into them.</li></ul><ul id="111e0021-eb2d-8005-a4e7-fff1d6c8a589" class="bulleted-list"><li style="list-style-type:disc">When a write operation occurs, it needs to overwrite existing values. This becomes an issue with SSDs since an SSD must erase and rewrite fairly large blocks of storage chip at a time. </li></ul><ul id="111e0021-eb2d-807e-a917-dd95f52de6f8" class="bulleted-list"><li style="list-style-type:disc">When new pages are created and data is moved, this causes the operation to perform poorly when compared to 🔴 <strong><span style="border-bottom:0.05em solid">NoSQL databases</span></strong> that use a log structure that only appends existing data.</li></ul><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="111e0021-eb2d-806c-9ded-d9b92317a5e3"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="111e0021-eb2d-80c7-8c5a-e2c07a21dbc8" class=""><strong><span style="border-bottom:0.05em solid">Strong Consistency is expensive to reduce latency for.</span></strong></p></div></figure><ul id="111e0021-eb2d-80a4-b566-eafc5932e43a" class="bulleted-list"><li style="list-style-type:disc">For customer experiences that do not require strong consistency, 🔴 <strong><span style="border-bottom:0.05em solid">SQL databases will have much higher latency compared with NoSQL databases</span></strong>. This is because strong consistency requires that the database lock particular fields when it is being modified.</li></ul><figure id="111e0021-eb2d-8026-9ab3-d66041240529" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%206.png"><img style="width:651.96875px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%206.png"/></a></figure><ul id="111e0021-eb2d-80a9-b651-d9dc9434017c" class="bulleted-list"><li style="list-style-type:disc">In the example above an update query locks the field so that any user requesting that data has to wait. In the example of a messaging app, this will degrade the experience for the user when it would have been perfectly acceptable to have the new message become eventually consistent.</li></ul><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="111e0021-eb2d-8053-9579-f0efed0fe04e"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="111e0021-eb2d-8058-b37b-df6595eb4946" class=""><strong><span style="border-bottom:0.05em solid">SQL does *not* work well for mixed schema data</span></strong></p></div></figure><ul id="111e0021-eb2d-8009-ab65-fb496eca056a" class="bulleted-list"><li style="list-style-type:disc">Since data in SQL has a fixed schema, each time a new value is to be introduced to a row a migration is needed to transform and migrate data across all nodes. This process is expensive and time-consuming.</li></ul><ul id="111e0021-eb2d-801b-9c8f-f05de7e4a83c" class="bulleted-list"><li style="list-style-type:disc">🔴 In contrast, <strong><span style="border-bottom:0.05em solid">NoSQL databases</span></strong> do not have to have a fixed schema, so different versions of data can exist without extra work.</li></ul><h3 id="11ee0021-eb2d-8001-a5e5-f41b6fbd762f" class="">Overheads due to Relational DB</h3><p id="11ee0021-eb2d-8067-a2ca-e1616f2bc18d" class="">In relational databases (RDBs), <strong>overhead</strong> refers to the additional resources or processes that are required to maintain and operate the database efficiently, which don&#x27;t directly contribute to executing queries but are necessary for performance, consistency, or other guarantees. Here are common sources of overhead in relational databases:</p><h3 id="11ee0021-eb2d-807a-aea7-e4fe2c3ac363" class="">1. <strong>Indexing Overhead</strong></h3><ul id="11ee0021-eb2d-80ec-9bc8-dabbdd7a9f9d" class="bulleted-list"><li style="list-style-type:disc"><strong>Description</strong>: Indexes are used to speed up data retrieval operations. However, maintaining indexes requires extra storage space and computational resources.</li></ul><ul id="11ee0021-eb2d-808d-afeb-ef4f7e5ec525" class="bulleted-list"><li style="list-style-type:disc"><strong>Impact</strong>: When data is inserted, updated, or deleted, the database needs to update the indexes as well, which can slow down write operations (insert, update, delete).</li></ul><h3 id="11ee0021-eb2d-800f-a807-e9292330b0df" class="">2. <strong>Transaction Management</strong></h3><ul id="11ee0021-eb2d-808a-9901-e91622c9db19" class="bulleted-list"><li style="list-style-type:disc"><strong>Description</strong>: Relational databases often ensure ACID (Atomicity, Consistency, Isolation, Durability) properties, which add overhead to maintain data integrity and consistency across transactions.</li></ul><ul id="11ee0021-eb2d-8097-a4ae-f1ded5b3a800" class="bulleted-list"><li style="list-style-type:disc"><strong>Impact</strong>: The database needs to maintain transaction logs, lock mechanisms, and sometimes rollback operations, which introduce time and memory overhead.</li></ul><h3 id="11ee0021-eb2d-804c-8b5a-e303919b5f0b" class="">3. <strong>Concurrency Control (Locking and Latching)</strong></h3><ul id="11ee0021-eb2d-80fc-9525-d0d05a07fded" class="bulleted-list"><li style="list-style-type:disc"><strong>Description</strong>: To handle multiple users or processes accessing the database simultaneously, relational databases use locking or latching mechanisms to ensure data consistency and isolation.</li></ul><ul id="11ee0021-eb2d-806d-a634-c713e8711885" class="bulleted-list"><li style="list-style-type:disc"><strong>Impact</strong>: Locking resources (rows, pages, tables) introduces overhead, as it prevents other transactions from accessing or modifying locked data. This can lead to contention, especially in high-traffic environments.</li></ul><h3 id="11ee0021-eb2d-80ad-91a3-ff97ffaa04b5" class="">4. <strong>Normalization Overhead</strong></h3><ul id="11ee0021-eb2d-8022-998e-cd63939fed9c" class="bulleted-list"><li style="list-style-type:disc"><strong>Description</strong>: Data normalization (organizing data to reduce redundancy) is a key concept in relational databases. While it improves data integrity, it also introduces overhead because queries often need to join multiple tables to retrieve information.</li></ul><ul id="11ee0021-eb2d-8098-845e-d177ba6bf768" class="bulleted-list"><li style="list-style-type:disc"><strong>Impact</strong>: Joins can add complexity and require additional processing power and time, especially if the tables involved are large.</li></ul><h3 id="11ee0021-eb2d-8078-9cdb-f9fd6d5f8686" class="">5. <strong>Data Integrity Constraints</strong></h3><ul id="11ee0021-eb2d-809c-83f1-e7b5a35a934c" class="bulleted-list"><li style="list-style-type:disc"><strong>Description</strong>: Constraints such as foreign keys, primary keys, unique constraints, and check constraints help maintain data integrity but add computational overhead.</li></ul><ul id="11ee0021-eb2d-8076-ae69-f4f838a22a69" class="bulleted-list"><li style="list-style-type:disc"><strong>Impact</strong>: When data is inserted or updated, the database must check these constraints, which adds to the processing time, especially in highly constrained schemas.</li></ul><h3 id="11ee0021-eb2d-801c-8b76-ece70c0aad48" class="">6. <strong>Replication Overhead</strong></h3><ul id="11ee0021-eb2d-80f3-83ea-de861b129321" class="bulleted-list"><li style="list-style-type:disc"><strong>Description</strong>: Relational databases often use replication to ensure high availability and fault tolerance by copying data across multiple servers or nodes.</li></ul><ul id="11ee0021-eb2d-80a7-a6d4-fc1c5b161a6c" class="bulleted-list"><li style="list-style-type:disc"><strong>Impact</strong>: This involves overhead in terms of bandwidth and storage, and it can slow down write operations, as data needs to be synchronized across replicas.</li></ul><h3 id="11ee0021-eb2d-8066-8d4a-dfa6b7541879" class="">7. <strong>Backup and Recovery</strong></h3><ul id="11ee0021-eb2d-80e1-8566-d8e798ace9cb" class="bulleted-list"><li style="list-style-type:disc"><strong>Description</strong>: Relational databases require regular backups to ensure that data can be restored in case of failure.</li></ul><ul id="11ee0021-eb2d-80b8-9575-f5d4e3c4ef6a" class="bulleted-list"><li style="list-style-type:disc"><strong>Impact</strong>: Performing backups, managing recovery logs, and ensuring durability through techniques like write-ahead logging (WAL) introduce storage and processing overhead.</li></ul><h3 id="11ee0021-eb2d-8059-bdf7-f6ce0821a403" class="">8. <strong>Caching Overhead</strong></h3><ul id="11ee0021-eb2d-8015-bc67-ff70a61fe195" class="bulleted-list"><li style="list-style-type:disc"><strong>Description</strong>: Relational databases often use caching mechanisms to speed up query execution. While caching improves read performance, maintaining the cache involves overhead.</li></ul><ul id="11ee0021-eb2d-8065-a98d-d093d1e6c997" class="bulleted-list"><li style="list-style-type:disc"><strong>Impact</strong>: Managing cache invalidation, ensuring consistency between cache and the main database, and storing cached data introduce additional memory and computational overhead.</li></ul><h3 id="11ee0021-eb2d-801e-b35d-c8036ad29ff6" class="">9. <strong>Query Optimization</strong></h3><ul id="11ee0021-eb2d-803d-bea9-c107acbc6765" class="bulleted-list"><li style="list-style-type:disc"><strong>Description</strong>: Modern relational databases come with built-in query optimizers that determine the most efficient execution plan for each query.</li></ul><ul id="11ee0021-eb2d-8002-8632-e7cd6e182cd9" class="bulleted-list"><li style="list-style-type:disc"><strong>Impact</strong>: While optimization improves performance, the optimization process itself consumes computational resources and time, especially for complex queries.</li></ul><h3 id="11ee0021-eb2d-80e9-8618-f16a04e6b508" class="">10. <strong>Logging</strong></h3><ul id="11ee0021-eb2d-8084-a30e-cec9c9d75808" class="bulleted-list"><li style="list-style-type:disc"><strong>Description</strong>: Relational databases maintain logs for various operations like transactions, queries, or error handling.</li></ul><ul id="11ee0021-eb2d-8006-8379-c31caaa87c9b" class="bulleted-list"><li style="list-style-type:disc"><strong>Impact</strong>: Logging consumes disk space and processing time. It can also slow down operations if extensive logging is enabled for auditing or monitoring purposes.</li></ul><h3 id="11ee0021-eb2d-80e4-873a-c818db62d4cf" class="">11. <strong>Sharding and Partitioning</strong></h3><ul id="11ee0021-eb2d-8008-91b7-eedc32ab439b" class="bulleted-list"><li style="list-style-type:disc"><strong>Description</strong>: In large-scale systems, data is often partitioned or sharded across different servers to improve scalability. However, managing partitions or shards introduces overhead in terms of data distribution and query routing.</li></ul><ul id="11ee0021-eb2d-80a0-86fc-efc477eada7b" class="bulleted-list"><li style="list-style-type:disc"><strong>Impact</strong>: Querying across shards or partitions can increase complexity and add network and processing overhead.</li></ul><p id="11ee0021-eb2d-8093-b4bf-f4541a9dfe7f" class="">In summary, while relational databases offer many powerful features, these features come at the cost of various types of overhead that affect performance, especially in large-scale systems or high-concurrency environments. Proper tuning and optimization can help reduce these overheads, but they can&#x27;t be completely eliminated.</p></div></details><details open=""><summary style="font-weight:600;font-size:1.5em;line-height:1.3;margin:0">NoSQL</summary><div class="indented"><p id="111e0021-eb2d-8077-99e1-d07dcd85d3e7" class="">Types of NoSQL databases -</p><ul id="111e0021-eb2d-8004-bfb0-f67737a20881" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Key Value</span></strong> :<ul id="111e0021-eb2d-80a0-8f08-fc6813e24318" class="bulleted-list"><li style="list-style-type:circle">Most popular.</li></ul><ul id="111e0021-eb2d-80c6-9089-d3744ce3a825" class="bulleted-list"><li style="list-style-type:circle">Stores data with <strong><span style="border-bottom:0.05em solid">unique keys</span></strong> and the system is opaque to the contents of stored data.</li></ul><ul id="111e0021-eb2d-8086-9b3c-fba84a169dd7" class="bulleted-list"><li style="list-style-type:circle">Architecture <strong><span style="border-bottom:0.05em solid">scales through the usage of sharing of data across nodes.</span></strong></li></ul><ul id="111e0021-eb2d-80a9-bdf1-f48096a6619e" class="bulleted-list"><li style="list-style-type:circle">By default is <strong><span style="border-bottom:0.05em solid">eventually consistent.</span></strong></li></ul></li></ul><ul id="111e0021-eb2d-8087-9f8b-d5d7b7825baf" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Document databases </span></strong>:<ul id="111e0021-eb2d-80e3-8336-e9aa54919333" class="bulleted-list"><li style="list-style-type:circle">Similar to key value, except have ability to perform <em>aggregate</em> searches across data.</li></ul><ul id="111e0021-eb2d-80e7-be98-c21df3786df1" class="bulleted-list"><li style="list-style-type:circle">Aggregation is <strong>a way of processing a large number of documents in a collection by means of passing them through different stages</strong>. The stages make up what is known as a pipeline. The stages in a pipeline can filter, sort, group, reshape and modify documents that pass through the pipeline.</li></ul><ul id="111e0021-eb2d-80c0-b8fe-ced6f66c04ce" class="bulleted-list"><li style="list-style-type:circle">Stores in variety of formats like JSON, XML, and YAML</li></ul></li></ul><ul id="111e0021-eb2d-80c6-a1c9-f438ea91e0f4" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Columnar Databases</span></strong> :<ul id="111e0021-eb2d-80d9-ac6c-f75017ace4d5" class="bulleted-list"><li style="list-style-type:circle">Stores information in tables, but allows you to have denormalized data.</li></ul><ul id="111e0021-eb2d-801d-8e40-f9b1757eefbe" class="bulleted-list"><li style="list-style-type:circle">The indexing is based on columns instead of rows.</li></ul><ul id="111e0021-eb2d-80bc-b479-ef1e373373be" class="bulleted-list"><li style="list-style-type:circle">In a <strong>columnar database</strong>, <strong>denormalized data</strong> refers to storing data in a way that reduces the number of tables and joins by <strong>combining related data into a single table</strong>. This is the opposite of the traditional <strong>normalized</strong> approach used in relational databases, where data is split across multiple tables to minimize redundancy and ensure data integrity.</li></ul><ul id="111e0021-eb2d-805e-a112-e3ed4d68a459" class="bulleted-list"><li style="list-style-type:circle">Columnar databases (like <strong><span style="border-bottom:0.05em solid">Amazon Redshift, Google BigQuery, or Apache Cassandra</span></strong>) are typically used for <strong>read-heavy</strong> workloads like analytics. </li></ul><ul id="111e0021-eb2d-80e8-b528-e903e129a84e" class="bulleted-list"><li style="list-style-type:circle">Denormalization is well-suited for these because it speeds up <strong>complex queries</strong> that need to scan large amounts of data by reducing the number of table lookups.</li></ul><figure id="187e0021-eb2d-8034-9c97-ec63f06ff519" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%207.png"><img style="width:625.984375px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%207.png"/></a></figure></li></ul><ul id="111e0021-eb2d-8039-a006-de9f106bae34" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Graph Databases</span></strong> :<ul id="111e0021-eb2d-8030-be71-e32194132ce0" class="bulleted-list"><li style="list-style-type:circle">Store complicated node and edge relationships.</li></ul><ul id="111e0021-eb2d-80c1-b9da-c2b8fd140383" class="bulleted-list"><li style="list-style-type:circle">Allow for easy graph traversal and modification without writing and maintaining your own code.</li></ul></li></ul><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="111e0021-eb2d-803b-9b29-fe1df0d8d060"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="111e0021-eb2d-803d-b974-f41485728f9b" class="">The common aspect of these databases is that they do not require rigid schemas like SQL models.</p></div></figure><h3 id="111e0021-eb2d-8015-9700-f2e64c088dd4" class="">Advantages</h3><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="111e0021-eb2d-802f-b2a3-fd151c7ad340"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="111e0021-eb2d-80d9-9158-f0e89f3b6b4f" class=""> NoSQL is faster for writes but slower to query.</p></div></figure><ul id="111e0021-eb2d-8085-ad3a-fe214c117b64" class="bulleted-list"><li style="list-style-type:disc">Most NoSQL databases operate with the underlying data structure of a Log- structured merge tree (LSMT), in contrast to SQL’s balanced trees.</li></ul><ul id="111e0021-eb2d-8020-abd4-fbe0467c0f19" class="bulleted-list"><li style="list-style-type:disc">✅ Imagine we are an official scorekeeper for a NASCAR race. Our job is to stand at a given position and record down the time each car passes that point. There are a lot of cars and speed is important here. The faster way to note down the time is to just record the driver&#x27;s shorthand in the next blank line.<figure id="111e0021-eb2d-8001-a8f2-c7069bfe08d8" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%208.png"><img style="width:623.984375px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%208.png"/></a></figure></li></ul><ul id="111e0021-eb2d-805d-8c84-fdd3465e1a4e" class="bulleted-list"><li style="list-style-type:disc">As you can see, the log list on the right is much faster for writes since you don&#x27;t do anything to maintain structure when you add to it. It is notably a bit harder to read if you are looking for a particular driver&#x27;s time or for a particular lap, since it requires you to scan down the page for all entries for the driver and count in your head until you find the correct entry.</li></ul><ul id="111e0021-eb2d-805a-ae99-da2f729e292a" class="bulleted-list"><li style="list-style-type:disc">As a heuristic,<strong><span style="border-bottom:0.05em solid"> the left side can be thought of as an SQL database that is more structured and is slower for writes but faster for reads</span></strong>. </li></ul><ul id="111e0021-eb2d-8034-b32e-d7d7772e7777" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">The right side can be thought of as a NoSQL database that is faster for writes but slower for reads.</span></strong></li></ul><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="111e0021-eb2d-80f6-8950-ceff4c97eb34"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="111e0021-eb2d-805a-8f11-e21c6af383f9" class=""><strong>Managed NoSQL services like DynamoDB or Azure MongoDB include sharding (discussed further) and scaling out of the box</strong></p></div></figure><h2 id="117e0021-eb2d-80f3-a176-fab69df4b0cb" class="">Considerations for using Non-Relational or NoSQL DB</h2><p id="117e0021-eb2d-80d1-b10c-d9e179502ee2" class="">Non-relational databases might be the right choice if:</p><ul id="117e0021-eb2d-80cf-9a1a-c5301fb5ffc8" class="bulleted-list"><li style="list-style-type:disc">Your application requires <strong><span style="border-bottom:0.05em solid">super-low latency</span></strong>.</li></ul><ul id="117e0021-eb2d-80a4-a432-ee7ffb116015" class="bulleted-list"><li style="list-style-type:disc">Your data are <strong><span style="border-bottom:0.05em solid">unstructured</span></strong>, or you <strong><span style="border-bottom:0.05em solid">do not have any relational data</span></strong>.</li></ul><ul id="117e0021-eb2d-807d-9a9e-d8db2c63a2df" class="bulleted-list"><li style="list-style-type:disc">You only need to <strong><span style="border-bottom:0.05em solid">serialize and deserialize data</span></strong> (JSON, XML, YAML, etc.).</li></ul><ul id="117e0021-eb2d-80d1-9194-de7338a1e815" class="bulleted-list"><li style="list-style-type:disc">You need to <strong><span style="border-bottom:0.05em solid">store a massive amount of data</span></strong>.</li></ul><h2 id="111e0021-eb2d-80d5-83f4-c72855408f28" class=""><strong>LSM Tree (Log-Structured Merge Tree)</strong></h2><p id="111e0021-eb2d-8093-8b5c-da8e0c56d0e8" class="">An <strong>LSM Tree</strong> is a <strong>write-optimized</strong> data structure used in databases to manage how data is written and stored. It’s commonly used in <strong>NoSQL databases</strong> like <strong>Cassandra</strong>, <strong>LevelDB</strong>, or <strong>HBase</strong> because it handles high-throughput write operations efficiently.</p><h3 id="111e0021-eb2d-80a2-8d57-de739893a928" class="">How LSM Trees Work:</h3><ul id="111e0021-eb2d-80c3-899b-ca8a8515a34c" class="bulleted-list"><li style="list-style-type:disc"><strong>Writes go to memory first</strong>: When new data is written, it’s first stored in an in-memory structure called a <strong>Memtable</strong>.</li></ul><ul id="111e0021-eb2d-8056-af4e-e17ef908b232" class="bulleted-list"><li style="list-style-type:disc"><strong>Memtable flushes to disk</strong>: When the Memtable reaches a certain size, it’s written to disk as a new <strong>SSTable</strong> (Sorted String Table) in the background.</li></ul><ul id="111e0021-eb2d-80de-9e7e-d74c76d3130d" class="bulleted-list"><li style="list-style-type:disc"><strong>Compaction</strong>: Over time, multiple SSTables on disk are merged and compacted to reduce fragmentation and free up space. Compaction helps maintain fast reads by combining overlapping data and discarding old versions of keys.</li></ul><h3 id="111e0021-eb2d-80d3-959d-e403da7dbde7" class="">Example:</h3><ol type="1" id="111e0021-eb2d-80d2-8e56-dbcd7eb3cbb1" class="numbered-list" start="1"><li>Suppose you’re writing key-value pairs, where the key is the user ID and the value is their name (e.g., <code>123 -&gt; &quot;Alice&quot;</code>).</li></ol><ol type="1" id="111e0021-eb2d-800c-bd23-e3b8d2d3f391" class="numbered-list" start="2"><li>When you write this data, it’s first added to the Memtable in memory.</li></ol><ol type="1" id="111e0021-eb2d-80c8-b925-c470e27239a6" class="numbered-list" start="3"><li>Once the Memtable becomes full, it’s flushed to disk as an SSTable (sorted by keys).</li></ol><ol type="1" id="111e0021-eb2d-80b8-8f77-ff0a2063d791" class="numbered-list" start="4"><li>Over time, multiple SSTables are merged together to keep the system efficient.</li></ol><p id="111e0021-eb2d-80e5-a731-cee7396b77be" class=""><strong>Why Use LSM Trees?</strong></p><ul id="111e0021-eb2d-800c-a81a-f9b9d3f64e12" class="bulleted-list"><li style="list-style-type:disc"><strong>Fast Writes</strong>: Data is first written to an in-memory structure, making writes very fast.</li></ul><ul id="111e0021-eb2d-8036-a1c2-f0b31b779066" class="bulleted-list"><li style="list-style-type:disc"><strong>Compaction</strong>: LSM Trees avoid frequent disk writes by batching data in memory before writing it to disk. Compaction helps manage read efficiency by merging data.</li></ul><h2 id="111e0021-eb2d-80e4-a514-d2d88580c2b8" class=""><strong>SSTable (Sorted String Table)</strong></h2><p id="111e0021-eb2d-8011-8a95-c1cc5c7c1452" class="">An <strong>SSTable</strong> is an <strong>immutable, sorted</strong> data file format used in conjunction with LSM Trees. Once data is flushed from memory to disk, it’s stored in the form of SSTables, which are <strong>append-only</strong> and sorted by key.</p><h3 id="111e0021-eb2d-80d4-8767-c39754d1bd9d" class="">Characteristics of SSTables:</h3><ul id="111e0021-eb2d-8030-a085-db9756350813" class="bulleted-list"><li style="list-style-type:disc"><strong>Immutable</strong>: Once an SSTable is written to disk, it cannot be modified. This makes SSTables efficient for reads because you don’t need to worry about concurrency issues or in-place updates.</li></ul><ul id="111e0021-eb2d-8087-9ca5-c848c864514a" class="bulleted-list"><li style="list-style-type:disc"><strong>Sorted</strong>: The data in an SSTable is sorted by keys, which makes searching and merging very efficient.</li></ul><ul id="111e0021-eb2d-80dc-9bec-db16b897a110" class="bulleted-list"><li style="list-style-type:disc"><strong>Compaction</strong>: Multiple SSTables are periodically merged (compacted) to reduce the number of files that need to be checked during reads and to remove obsolete or deleted data.</li></ul><h3 id="111e0021-eb2d-80ce-84de-f929489d819c" class="">Example:</h3><p id="111e0021-eb2d-809f-b35c-cbe37633f2df" class="">Imagine an SSTable storing user IDs and names:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="111e0021-eb2d-805a-93ad-e2af3047ca57" class="code"><code class="language-Rust" style="white-space:pre-wrap;word-break:break-all">SSTable 1:
100 -&gt; &quot;John&quot;
123 -&gt; &quot;Alice&quot;
150 -&gt; &quot;Eve&quot;

SSTable 2:
101 -&gt; &quot;Bob&quot;
120 -&gt; &quot;Carol&quot;
151 -&gt; &quot;Dave&quot;</code></pre><p id="111e0021-eb2d-80c3-acba-cf6cd9cb46b5" class="">These files are immutable and stored on disk. During compaction, overlapping data (e.g., keys that may be present in multiple SSTables) is merged, and older data is discarded.</p><p id="111e0021-eb2d-8035-a2d4-d3c2d9a05739" class=""><strong>Why Use SSTables?</strong></p><ul id="111e0021-eb2d-8079-b8d6-d37977341d4b" class="bulleted-list"><li style="list-style-type:disc"><strong>Efficient Reads</strong>: Since SSTables are sorted, searching for keys within them is fast (e.g., using binary search).</li></ul><ul id="111e0021-eb2d-80d6-ba35-f92bc327b4ad" class="bulleted-list"><li style="list-style-type:disc"><strong>Efficient Merging</strong>: Multiple SSTables can be merged efficiently during compaction, reducing the overall size and making reads faster.</li></ul><ul id="111e0021-eb2d-8094-8b5d-cad4399326c2" class="bulleted-list"><li style="list-style-type:disc"><strong>Append-Only</strong>: By being immutable and append-only, SSTables avoid the overhead of managing in-place updates or locks for concurrency.</li></ul><h3 id="111e0021-eb2d-805e-9e0d-ec0d4bbb0fc9" class="">Simple Example of LSM Tree and SSTables in Action</h3><p id="111e0021-eb2d-80f3-9667-d73eda07b4e1" class="">Let’s say you have a key-value store for customer orders:</p><ol type="1" id="111e0021-eb2d-80dd-bf34-ca16f4c283ec" class="numbered-list" start="1"><li><strong>Initial Write</strong>:<ul id="111e0021-eb2d-801d-815f-e6670a3610bf" class="bulleted-list"><li style="list-style-type:disc">You write two customer orders to the system:<code>OrderID 1 -&gt; &quot;Item A&quot; OrderID 2 -&gt; &quot;Item B&quot;</code></li></ul><ul id="111e0021-eb2d-8036-ad18-e8b435cd60dc" class="bulleted-list"><li style="list-style-type:disc">These orders are written to the <strong>Memtable</strong> in memory.</li></ul></li></ol><ol type="1" id="111e0021-eb2d-8012-a7e2-def616373e07" class="numbered-list" start="2"><li><strong>Memtable Flush</strong>:<ul id="111e0021-eb2d-8059-aa5e-f522c6310675" class="bulleted-list"><li style="list-style-type:disc">When the Memtable reaches capacity, it’s written to disk as <strong>SSTable 1</strong>:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="111e0021-eb2d-8014-a7cb-ede778605f74" class="code"><code class="language-Rust" style="white-space:pre-wrap;word-break:break-all">SSTable 1:
1 -&gt; &quot;Item A&quot;
2 -&gt; &quot;Item B&quot;</code></pre></li></ul></li></ol><ol type="1" id="111e0021-eb2d-80b8-94b8-cb6a027c2fcd" class="numbered-list" start="3"><li><strong>More Writes</strong>:<ul id="111e0021-eb2d-807b-92c2-f9aee7dc71d3" class="bulleted-list"><li style="list-style-type:disc">Later, more orders are added to the system:<code>OrderID 3 -&gt; &quot;Item C&quot;OrderID 2 -&gt; &quot;Item B Updated&quot;</code></li></ul><ul id="111e0021-eb2d-8004-8a84-e569a4740376" class="bulleted-list"><li style="list-style-type:disc">This data is stored in the Memtable and later flushed to disk as <strong>SSTable 2</strong>:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="111e0021-eb2d-80dc-a425-e5bc6a1803b9" class="code"><code class="language-Rust" style="white-space:pre-wrap;word-break:break-all">SSTable 2:
2 -&gt; &quot;Item B Updated&quot;
3 -&gt; &quot;Item C&quot;</code></pre></li></ul></li></ol><ol type="1" id="111e0021-eb2d-8011-8b6c-cae8822a00b0" class="numbered-list" start="4"><li><strong>Compaction</strong>:<ul id="111e0021-eb2d-80aa-a10e-ce5087641d73" class="bulleted-list"><li style="list-style-type:disc">During compaction, overlapping data is merged:<code>OrderID 2 -&gt; &quot;Item B Updated&quot;</code> overwrites <code>OrderID 2 -&gt; &quot;Item B&quot;</code>, and SSTables are combined into a new SSTable:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="111e0021-eb2d-80b3-808c-e60d4754f845" class="code"><code class="language-Rust" style="white-space:pre-wrap;word-break:break-all">Compacted SSTable:
1 -&gt; &quot;Item A&quot;
2 -&gt; &quot;Item B Updated&quot;
3 -&gt; &quot;Item C&quot;</code></pre></li></ul></li></ol><h3 id="111e0021-eb2d-8014-9d55-fdade8f16c47" class="">Disadvantages</h3><p id="111e0021-eb2d-80bf-828f-c3cdee9d6453" class="">NoSQL databases can be faster and more scalable for specific types of operations, but they are generally less suited for complex, multi-faceted queries that relational databases are designed for.</p></div></details><details open=""><summary style="font-weight:600;font-size:1.5em;line-height:1.3;margin:0">Throughput in terms of DB</summary><div class="indented"><p id="111e0021-eb2d-806c-a5db-e1e6864c819b" class=""><strong>High-throughput</strong> refers to the ability of a system to process a <strong>large volume of data</strong> or <strong>requests per unit of time</strong>. It’s a measure of how efficiently a system can handle heavy workloads, especially in environments that deal with frequent and large-scale read/write operations.</p><ul id="111e0021-eb2d-8024-bfd6-cf1a436f29c5" class="bulleted-list"><li style="list-style-type:disc">Breakdown of the Concept:</li></ul><ul id="111e0021-eb2d-800c-adef-f1ac6fdae5c9" class="bulleted-list"><li style="list-style-type:disc"><strong>Throughput</strong>: <strong><span style="border-bottom:0.05em solid">This is the total amount of work (such as data processed or requests handled) the system can complete in a given time frame</span></strong>, often measured in:<ul id="111e0021-eb2d-800b-a4b1-e6e59057182f" class="bulleted-list"><li style="list-style-type:circle"><strong>Requests per second (RPS)</strong></li></ul><ul id="111e0021-eb2d-80c5-b085-f6c6580f6b87" class="bulleted-list"><li style="list-style-type:circle"><strong>Operations per second</strong></li></ul><ul id="111e0021-eb2d-8052-ac9e-dade5d80508d" class="bulleted-list"><li style="list-style-type:circle"><strong>Transactions per second (TPS)</strong></li></ul><ul id="111e0021-eb2d-8083-9aed-fddfae990cdc" class="bulleted-list"><li style="list-style-type:circle"><strong>Megabytes per second (MBps)</strong> (for data transfer)</li></ul></li></ul><ul id="111e0021-eb2d-80ad-b36b-d83223bc6d4a" class="bulleted-list"><li style="list-style-type:disc"><strong>High-throughput</strong>: This means the system can handle a <strong>very large number</strong> of these requests or data processing operations quickly and efficiently, typically at scale. In a <strong>high-throughput</strong> system, more data or operations are processed in less time, meaning <strong><span style="border-bottom:0.05em solid">the system is optimized for handling concurrent workloads</span></strong>.</li></ul><h3 id="111e0021-eb2d-80a5-8909-d6331eae0432" class="">Example:</h3><ul id="111e0021-eb2d-8040-bcbb-c1863cac23cc" class="bulleted-list"><li style="list-style-type:disc"><strong>High-throughput database</strong>: A NoSQL database like <strong>Cassandra</strong> can handle <strong>thousands of writes/reads per second</strong> across distributed nodes. It’s designed for applications that require <strong>constant, rapid data ingestion</strong>, such as logging systems, IoT data collection, or real-time analytics.</li></ul><ul id="111e0021-eb2d-8047-837a-d61cc6c8897e" class="bulleted-list"><li style="list-style-type:disc"><strong>High-throughput web server</strong>: A web server optimized for high throughput might be able to serve millions of requests per day for a website with minimal latency, allowing many users to interact simultaneously.</li></ul><h3 id="111e0021-eb2d-8052-a03f-e0ea31eefd3e" class="">Why High-throughput Matters:</h3><ul id="111e0021-eb2d-805d-8d64-fe69084458df" class="bulleted-list"><li style="list-style-type:disc"><strong>Scaling</strong>: High-throughput systems are essential when handling <strong>large-scale</strong> applications such as social media platforms, e-commerce websites, and real-time analytics, where many users or systems are sending and receiving data simultaneously.</li></ul><ul id="111e0021-eb2d-8046-b23f-d1ec3d21b476" class="bulleted-list"><li style="list-style-type:disc"><strong>Efficiency</strong>: Achieving high-throughput ensures the system is making efficient use of resources (CPU, memory, disk I/O) and can perform more operations in less time.</li></ul><ul id="111e0021-eb2d-8014-a31f-e666bcf0b572" class="bulleted-list"><li style="list-style-type:disc"><strong>Performance</strong>: High-throughput directly affects the system’s ability to provide <strong>low-latency</strong> responses even under heavy loads.</li></ul><p id="111e0021-eb2d-80e2-a9bb-e2011f399a98" class=""><div class="indented"><p id="111e0021-eb2d-80c7-8ed9-ccfddbfedb9a" class="">In summary, <strong>high-throughput</strong> refers to the ability of a system to efficiently process a large number of operations, data, or requests within a given time, making it crucial for performance in large-scale, data-heavy applications.</p></div></p></div></details><details open=""><summary style="font-weight:600;font-size:1.5em;line-height:1.3;margin:0">Conclusion</summary><div class="indented"><ul id="111e0021-eb2d-80de-b871-d49d406094d7" class="bulleted-list"><li style="list-style-type:disc">Amazon RDS SQL DB → out-of-the-box options for sharding and scaling</li></ul><ul id="111e0021-eb2d-8091-ab31-e2ffcf77b456" class="bulleted-list"><li style="list-style-type:disc">AWS Dynamo DB → enables strong consistency (though introduces some latency while reading and writing)</li></ul><ul id="111e0021-eb2d-80d0-bca7-ff940b003c42" class="bulleted-list"><li style="list-style-type:disc">Type of DB to use depends on following - <ul id="111e0021-eb2d-8088-937f-d96a4b85b6b5" class="bulleted-list"><li style="list-style-type:circle">What are you storing ?</li></ul><ul id="111e0021-eb2d-80e6-aada-e3b047426345" class="bulleted-list"><li style="list-style-type:circle">How often are you writing ?</li></ul><ul id="111e0021-eb2d-8086-b626-edb2befba7d3" class="bulleted-list"><li style="list-style-type:circle">What sorts of retrieval you need to make ?</li></ul></li></ul><figure id="111e0021-eb2d-802e-9ff5-f3c06776480b" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%209.png"><img style="width:651.984375px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%209.png"/></a></figure></div></details><details open=""><summary style="font-weight:600;font-size:1.5em;line-height:1.3;margin:0">Database Sharding</summary><div class="indented"><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="111e0021-eb2d-803c-a4df-d86687577a68"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><ul id="111e0021-eb2d-80b0-bdc7-e5949d536581" class="bulleted-list"><li style="list-style-type:disc">Database sharding is <strong><span style="border-bottom:0.05em solid">the process of storing a large database across multiple machines. </span></strong></li></ul><ul id="111e0021-eb2d-80dd-9020-c75f45a1be9c" class="bulleted-list"><li style="list-style-type:disc">A single machine, or database server, can store and process only a limited amount of data. </li></ul><ul id="111e0021-eb2d-80ee-b1c9-c43cc82e61bb" class="bulleted-list"><li style="list-style-type:disc">Database sharding <strong><span style="border-bottom:0.05em solid">overcomes this limitation by splitting data into smaller chunks, called shards, and storing them across several database servers</span></strong>. </li></ul></div></figure><h2 id="111e0021-eb2d-8049-8da1-c51cb8812292" class=""><strong>Why is database sharding important?</strong></h2><ul id="111e0021-eb2d-801a-b993-f9e6331bb119" class="bulleted-list"><li style="list-style-type:disc">As an application grows, the number of application users and the amount of data it stores increase over time. </li></ul><ul id="111e0021-eb2d-80c5-ab56-d3559db23887" class="bulleted-list"><li style="list-style-type:disc">The database becomes a bottleneck if the data volume becomes too large and too many users attempt to use the application to read or save information simultaneously. The application slows down and affects customer experience. </li></ul><ul id="111e0021-eb2d-80d2-95f3-ee609279a11d" class="bulleted-list"><li style="list-style-type:disc">Database sharding is one of the methods to solve this problem <strong><span style="border-bottom:0.05em solid">because it enables parallel processing of smaller datasets across shards.</span></strong></li></ul><h2 id="111e0021-eb2d-80d3-a0fe-eb0a3673c0f6" class="">Benefits of Database Sharding</h2><h3 id="111e0021-eb2d-8048-be8d-df726d2e69e1" class=""><strong>Improve response time</strong></h3><ul id="111e0021-eb2d-8012-bd8b-f59d478094e7" class="bulleted-list"><li style="list-style-type:disc">Data retrieval takes longer on a single large database. The DMS (DB Management System) needs to search through many rows to retrieve the correct data. </li></ul><ul id="111e0021-eb2d-80c9-8aa0-e4f3f722994f" class="bulleted-list"><li style="list-style-type:disc">By contrast, data shards have fewer rows than the entire database. Therefore, it takes less time to retrieve specific information, or run a query, from a sharded database.</li></ul><h3 id="111e0021-eb2d-809f-bb84-c4d4f82d1299" class=""><strong>Avoid total service outage</strong></h3><ul id="111e0021-eb2d-8063-a6d7-f15c96944808" class="bulleted-list"><li style="list-style-type:disc">If the computer hosting the database fails, the application that depends on the database fails too. </li></ul><ul id="111e0021-eb2d-8000-887c-e691a20ec73f" class="bulleted-list"><li style="list-style-type:disc">Database sharding prevents this by distributing parts of the database into different computers. </li></ul><ul id="111e0021-eb2d-80f2-afdd-e099b8c8292b" class="bulleted-list"><li style="list-style-type:disc">Failure of one of the computers does not shut down the application because it can operate with other functional shards. </li></ul><ul id="111e0021-eb2d-805f-a876-d655c9d01fe0" class="bulleted-list"><li style="list-style-type:disc">Sharding is also often done in combination with data replication across shards. So, if one shard becomes unavailable, the data can be accessed and restored from an alternate shard.</li></ul><h3 id="111e0021-eb2d-8017-89c5-ead7e759af98" class=""><strong>Scale efficiently</strong></h3><ul id="111e0021-eb2d-80e4-9854-c6be1b5380a0" class="bulleted-list"><li style="list-style-type:disc">A growing database consumes more computing resources and eventually reaches storage capacity. </li></ul><ul id="111e0021-eb2d-8052-8aca-e9403a3fd609" class="bulleted-list"><li style="list-style-type:disc">Organizations can use database sharding to add more computing resources to support database scaling. They can add new shards at runtime without shutting down the application for maintenance.</li></ul><h2 id="111e0021-eb2d-80fe-979f-cc392cb29112" class=""><strong>How does database sharding work?</strong></h2><p id="111e0021-eb2d-80a0-b9a3-d12ae8bc5736" class="">A database stores information in multiple datasets consisting of columns and rows. </p><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="111e0021-eb2d-8060-8eb8-fa4923a60325"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="111e0021-eb2d-8095-ba84-fa41c8522f32" class=""><strong><span style="border-bottom:0.05em solid">Database sharding splits a single dataset into partitions or shards. Each shard contains unique rows of information that you can store separately across multiple computers, called nodes. All shards run on separate nodes but share the original database’s schema or design.</span></strong></p></div></figure><p id="111e0021-eb2d-80b1-930b-f75c08736b85" class="">For example, an unsharded database containing a dataset for customer records might look like this.</p><table id="111e0021-eb2d-808e-9ed5-d74804bedd12" class="simple-table"><tbody><tr id="111e0021-eb2d-8050-886c-c154d1f78471"><td id="u&lt;xz" class=""><strong>Customer ID</strong></td><td id="@AlS" class=""><strong>Name</strong></td><td id="ygQd" class=""><strong>State</strong></td></tr><tr id="111e0021-eb2d-8092-b84e-d87d315cf6b6"><td id="u&lt;xz" class="">1</td><td id="@AlS" class="">John</td><td id="ygQd" class="">California</td></tr><tr id="111e0021-eb2d-805d-afa1-d002f0ee2844"><td id="u&lt;xz" class="">2</td><td id="@AlS" class="">Jane</td><td id="ygQd" class="">Washington</td></tr><tr id="111e0021-eb2d-804c-82a3-dfbe30501533"><td id="u&lt;xz" class="">3</td><td id="@AlS" class="">Paulo</td><td id="ygQd" class="">Arizona</td></tr><tr id="111e0021-eb2d-80e9-8790-e19731b45543"><td id="u&lt;xz" class="">4</td><td id="@AlS" class="">Wang</td><td id="ygQd" class="">Georgia</td></tr></tbody></table><p id="111e0021-eb2d-803f-9c0f-ea9a39a01e3e" class="">Sharding involves separating different rows of information from the table and storing them on different machines, as the following shows.</p><p id="111e0021-eb2d-80e5-bfac-c5f5cf8db736" class=""><strong>Computer A</strong></p><table id="111e0021-eb2d-80c9-85fb-d07c24732f34" class="simple-table"><tbody><tr id="111e0021-eb2d-80e0-8d67-e7655af977ac"><td id="@JZb" class=""><strong>Customer ID</strong></td><td id="&lt;@mf" class=""><strong>Name</strong></td><td id="~cgU" class=""><strong>State</strong></td></tr><tr id="111e0021-eb2d-8007-aee4-cb4d03bd474f"><td id="@JZb" class="">1</td><td id="&lt;@mf" class="">John</td><td id="~cgU" class="">California</td></tr><tr id="111e0021-eb2d-80c0-aea2-fc8f0b88422d"><td id="@JZb" class="">2</td><td id="&lt;@mf" class="">Jane</td><td id="~cgU" class="">Washington</td></tr></tbody></table><p id="111e0021-eb2d-8073-b9dc-fae4523629c0" class=""><strong>Computer B</strong></p><table id="111e0021-eb2d-80a4-b19c-e607aa98ff96" class="simple-table"><tbody><tr id="111e0021-eb2d-8085-99d3-cee27e7f10f8"><td id="V~&gt;x" class=""><strong>Customer ID</strong></td><td id="S`e&lt;" class=""><strong>Name</strong></td><td id="Mg~}" class=""><strong>State</strong></td></tr><tr id="111e0021-eb2d-80b2-ba85-da42fe152094"><td id="V~&gt;x" class="">3</td><td id="S`e&lt;" class="">Paulo</td><td id="Mg~}" class="">Arizona</td></tr><tr id="111e0021-eb2d-8060-adbb-d47131a1f1f9"><td id="V~&gt;x" class="">4</td><td id="S`e&lt;" class="">Wang</td><td id="Mg~}" class="">Georgia</td></tr></tbody></table><h3 id="111e0021-eb2d-804c-8442-f0daa44a154c" class=""><strong>Shards</strong></h3><ul id="111e0021-eb2d-80d9-b17c-de97f5fa0730" class="bulleted-list"><li style="list-style-type:disc">The partitioned data chunks are called logical shards.</li></ul><ul id="111e0021-eb2d-8082-9403-d9cb1540a1fd" class="bulleted-list"><li style="list-style-type:disc">The machine that stores the logical shard is called a physical shard or database node. </li></ul><ul id="111e0021-eb2d-8093-bb9d-f7c0ea75963a" class="bulleted-list"><li style="list-style-type:disc">A physical shard can contain multiple logical shards.</li></ul><h3 id="111e0021-eb2d-8015-b1df-c4f1a6a17a18" class=""><strong>Shard Key or Partition Key</strong></h3><ul id="111e0021-eb2d-80c7-ad51-f03822a1f82f" class="bulleted-list"><li style="list-style-type:disc">Software developers use a shard key <strong><span style="border-bottom:0.05em solid">to determine how to partition the dataset</span></strong>. </li></ul><ul id="111e0021-eb2d-8005-8693-e759a66a8bee" class="bulleted-list"><li style="list-style-type:disc">A column in the dataset determines which rows of data group together to form a shard.</li></ul><ul id="111e0021-eb2d-801f-9896-cd3f3ff35edd" class="bulleted-list"><li style="list-style-type:disc">Database designers choose a shard key from an existing column or create a new one.</li></ul><ul id="118e0021-eb2d-802b-a6de-e81468f99fc1" class="bulleted-list"><li style="list-style-type:disc">A sharding key <strong><span style="border-bottom:0.05em solid">allows you to retrieve and modify data efficiently by routing database queries to the correct database</span></strong>.</li></ul><ul id="118e0021-eb2d-80a9-ae51-d08a5ad43c25" class="bulleted-list"><li style="list-style-type:disc">When choosing a sharding key, one of the most important criteria is <strong><span style="border-bottom:0.05em solid">to choose a key that can evenly distribute data</span></strong>.</li></ul><h3 id="111e0021-eb2d-80ed-8b04-de26eb831412" class=""><strong>Shared-nothing architecture</strong></h3><ul id="111e0021-eb2d-8020-b50e-dc9c25c07723" class="bulleted-list"><li style="list-style-type:disc">Database sharding operates on a <strong><span style="border-bottom:0.05em solid">shared-nothing architecture.</span></strong> </li></ul><ul id="111e0021-eb2d-8093-89bc-c033596584a9" class="bulleted-list"><li style="list-style-type:disc">Each physical shard operates <strong><span style="border-bottom:0.05em solid">independently</span></strong> and i<strong><span style="border-bottom:0.05em solid">s unaware of other shards</span></strong>. </li></ul><ul id="111e0021-eb2d-80e1-8dfa-db5fde9eb4e3" class="bulleted-list"><li style="list-style-type:disc">Only the physical shards that contain the data that you request will process the data in parallel for you.</li></ul><ul id="111e0021-eb2d-8013-91ef-d8b988e6e724" class="bulleted-list"><li style="list-style-type:disc">A software layer coordinates data storage and access from these multiple shards. </li></ul><ul id="111e0021-eb2d-8088-954f-d853c237b779" class="bulleted-list"><li style="list-style-type:disc">For example, some types of database technology have automatic sharding features built in. Software developers can also write sharding code in their application to store or retrieve information from the correct shard or shards.</li></ul><h2 id="111e0021-eb2d-8077-8a1a-d5fdac64f33d" class=""><strong>Methods of database sharding</strong></h2><p id="111e0021-eb2d-802a-8d71-c677fa12e507" class="">Database sharding methods apply different rules to the shard key to determine the correct node for a particular data row. The following are common sharding architectures.</p><h3 id="111e0021-eb2d-8075-8240-d4651f6ff787" class=""><strong>Range-based sharding</strong></h3><ul id="111e0021-eb2d-80ef-b16a-c1384ff63fb6" class="bulleted-list"><li style="list-style-type:disc">Range-based sharding, or dynamic sharding, splits database rows based on a range of values. </li></ul><ul id="111e0021-eb2d-807b-a84a-f899445ec760" class="bulleted-list"><li style="list-style-type:disc">Then the database designer assigns a shard key to the respective range. </li></ul><ul id="111e0021-eb2d-8086-a32b-c9ccec825083" class="bulleted-list"><li style="list-style-type:disc">For example, the database designer partitions the data according to the first alphabet in the customer&#x27;s name as follows.</li></ul><table id="111e0021-eb2d-803e-9583-ec200fad06fd" class="simple-table"><tbody><tr id="111e0021-eb2d-8076-b09c-c791e826f22a"><td id="NaSf" class=""><strong>Name</strong></td><td id="T;pt" class=""><strong>Shard key</strong></td></tr><tr id="111e0021-eb2d-805e-96cf-f6eb4ba31f05"><td id="NaSf" class="">Starts with A to I</td><td id="T;pt" class="">A</td></tr><tr id="111e0021-eb2d-80f2-91aa-ccdde9cd0e46"><td id="NaSf" class="">Starts with J to S</td><td id="T;pt" class="">B</td></tr><tr id="111e0021-eb2d-8089-9ad1-c907c6824ae1"><td id="NaSf" class="">Starts with T to Z</td><td id="T;pt" class="">C</td></tr></tbody></table><ul id="111e0021-eb2d-804f-9681-e8dd547f7806" class="bulleted-list"><li style="list-style-type:disc">When it is writing a customer record to the database, the application determines the correct shard key by checking the customer&#x27;s name. </li></ul><ul id="111e0021-eb2d-802e-9520-e76f0d002dc2" class="bulleted-list"><li style="list-style-type:disc">Then the application matches the key to its physical node and stores the row on that machine. Similarly, the application performs a reverse match when searching for a particular record.</li></ul><p id="111e0021-eb2d-8061-b565-d607029d1152" class=""><strong><span style="border-bottom:0.05em solid">Pros and cons</span></strong></p><ul id="111e0021-eb2d-8008-9fde-fd1425911831" class="bulleted-list"><li style="list-style-type:disc">Depending on the data values, range-based sharding can result in the<strong><span style="border-bottom:0.05em solid"> overloading of data on a single physical node</span></strong>. </li></ul><ul id="111e0021-eb2d-80e6-97a8-d637b08b21ef" class="bulleted-list"><li style="list-style-type:disc">In our example, shard A (containing names that start with A to I) might contain a much larger number of rows of data than shard C (containing names that start with T to Z). </li></ul><ul id="111e0021-eb2d-80c4-a97b-f14fe4915421" class="bulleted-list"><li style="list-style-type:disc">However, it is easier to implement.</li></ul><h3 id="111e0021-eb2d-8001-b5a6-c1b13a27ffdb" class=""><strong>Hashed sharding</strong></h3><ul id="111e0021-eb2d-80a5-853e-d4fcb0de4a8c" class="bulleted-list"><li style="list-style-type:disc">Hashed sharding assigns the <strong><span style="border-bottom:0.05em solid">shard key to each row of the database by using a mathematical formula called a hash function</span></strong>. </li></ul><ul id="111e0021-eb2d-803d-9fa4-f93342455d18" class="bulleted-list"><li style="list-style-type:disc"><span style="border-bottom:0.05em solid">The hash function takes the information from the row and produces a hash value. </span></li></ul><ul id="111e0021-eb2d-80be-9a9e-f935b0c14cfd" class="bulleted-list"><li style="list-style-type:disc">The application uses the hash value as a shard key and stores the information in the corresponding physical shard.</li></ul><ul id="111e0021-eb2d-80ca-82f6-f367960c2755" class="bulleted-list"><li style="list-style-type:disc">Software developers use hashed sharding to evenly distribute information in a database among multiple shards. </li></ul><ul id="111e0021-eb2d-80ad-ada3-d3896ea57ead" class="bulleted-list"><li style="list-style-type:disc">For example, the software separates customer records into two shards with alternative hash values of 1 and 2.</li></ul><table id="111e0021-eb2d-8082-a0c2-fbfb3e582ebf" class="simple-table"><tbody><tr id="111e0021-eb2d-808b-b5c1-dbf53eb1ce94"><td id=";lwA" class=""><strong>Name</strong></td><td id="|=Kd" class=""><strong>Hash value</strong></td></tr><tr id="111e0021-eb2d-80d4-9069-f720c4aa4bb1"><td id=";lwA" class="">John</td><td id="|=Kd" class="">1</td></tr><tr id="111e0021-eb2d-8074-85e2-ef7ebf710047"><td id=";lwA" class="">Jane</td><td id="|=Kd" class="">2</td></tr><tr id="111e0021-eb2d-8078-a5bc-dd487c47445d"><td id=";lwA" class="">Paulo</td><td id="|=Kd" class="">1</td></tr><tr id="111e0021-eb2d-8090-ac81-ed47b7866da1"><td id=";lwA" class="">Wang</td><td id="|=Kd" class="">2</td></tr></tbody></table><p id="118e0021-eb2d-8082-9b86-c8b8f6c68763" class=""><strong><span style="border-bottom:0.05em solid">Complexity and new challenges to the system :</span></strong></p><ul id="118e0021-eb2d-80e2-907f-d6232bf7eea6" class="bulleted-list"><li style="list-style-type:disc">Resharding data →<ul id="118e0021-eb2d-807d-9236-d57030aa66ed" class="bulleted-list"><li style="list-style-type:circle">Resharding data is needed when -<ul id="118e0021-eb2d-80b0-9396-e943cdcc9339" class="bulleted-list"><li style="list-style-type:square">a single shard could no longer hold more data due to rapid growth. </li></ul><ul id="118e0021-eb2d-8053-bcc3-fc39b774e204" class="bulleted-list"><li style="list-style-type:square">Certain shards might experience shard exhaustion faster than others due to uneven data distribution. </li></ul></li></ul><ul id="118e0021-eb2d-8068-9f3d-c78f82c3ba57" class="bulleted-list"><li style="list-style-type:circle">When shard exhaustion happens, it requires updating the sharding function and moving data around. </li></ul><ul id="118e0021-eb2d-80f5-8bef-e732923d29e0" class="bulleted-list"><li style="list-style-type:circle">Consistent hashing, is a commonly used technique to solve this problem.</li></ul></li></ul><ul id="118e0021-eb2d-8027-b952-d3842b1ffc7b" class="bulleted-list"><li style="list-style-type:disc">Celebrity problem or Hotspot key problem →<ul id="118e0021-eb2d-80ca-8b5e-cf33568f7a50" class="bulleted-list"><li style="list-style-type:circle">Excessive access to a specific shard could cause server overload. </li></ul><ul id="118e0021-eb2d-8015-a946-ccda469cd7f7" class="bulleted-list"><li style="list-style-type:circle">Imagine data for Katy Perry, Justin Bieber, and Lady Gaga all end up on the same shard. </li></ul><ul id="118e0021-eb2d-808e-a5ec-f534bd0c493b" class="bulleted-list"><li style="list-style-type:circle"><strong><span style="border-bottom:0.05em solid">For social applications, that shard will be overwhelmed with read operations. </span></strong></li></ul><ul id="118e0021-eb2d-808d-b4ae-f7460ac63da0" class="bulleted-list"><li style="list-style-type:circle">To solve this problem, we may need to allocate a shard for each celebrity. Each shard might even require further partition.</li></ul></li></ul><ul id="118e0021-eb2d-8033-8e56-f194b0949726" class="bulleted-list"><li style="list-style-type:disc">Join and de-normalization →<ul id="118e0021-eb2d-8093-a92a-f6f0398bd024" class="bulleted-list"><li style="list-style-type:circle">Once a database has been sharded across multiple servers, it is hard <strong><span style="border-bottom:0.05em solid">to perform join operations across database shards</span></strong>. </li></ul><ul id="118e0021-eb2d-802c-a13b-c7d46e17b526" class="bulleted-list"><li style="list-style-type:circle"><strong><span style="border-bottom:0.05em solid">A common workaround is to denormalize the database so that queries can be performed in a single table.</span></strong></li></ul></li></ul><p id="111e0021-eb2d-804c-af61-c382ae2ad1a8" class=""><strong><span style="border-bottom:0.05em solid">Pros and cons</span></strong></p><ul id="111e0021-eb2d-8079-9495-d430b9bf60a6" class="bulleted-list"><li style="list-style-type:disc"><strong>No Meaningful Data Separation</strong><ul id="111e0021-eb2d-8062-9ba3-cca0162cd8ac" class="bulleted-list"><li style="list-style-type:circle"><strong>However, hashed sharding ignores the semantics or meaning of the data.</strong> This means that related data items (like all user records from a specific country) are not guaranteed to be stored together. </li></ul><ul id="111e0021-eb2d-808e-a53b-c8db8e97aab6" class="bulleted-list"><li style="list-style-type:circle">Instead, <strong><span style="border-bottom:0.05em solid">the hash function only cares about balancing the data load, not grouping similar or related records on the same shard.</span></strong></li></ul><ul id="111e0021-eb2d-80da-af4a-d6c72ea1265b" class="bulleted-list"><li style="list-style-type:circle">This lack of meaningful grouping can make certain types of queries or operations inefficient. For example, if a query needs to retrieve all users from a specific country, the system might need to check multiple shards, leading to increased overhead.</li></ul></li></ul><ul id="111e0021-eb2d-8011-a238-d0a477688d4b" class="bulleted-list"><li style="list-style-type:disc"><strong>Difficulty with Scaling</strong><ul id="111e0021-eb2d-80fe-b694-e0d05907df8d" class="bulleted-list"><li style="list-style-type:circle"><strong>Reassigning the hash values</strong> when adding new physical shards is a challenge. </li></ul><ul id="111e0021-eb2d-80ce-ab0b-ef5d31f5bc06" class="bulleted-list"><li style="list-style-type:circle">When the number of shards increases (because of scaling or adding new hardware), the hash function needs to be adjusted to distribute data across the new set of shards.</li></ul><ul id="111e0021-eb2d-80f3-a6e5-c7fb47ed6fa8" class="bulleted-list"><li style="list-style-type:circle">The problem is that this change might require <strong>recomputing hash values for existing data</strong> and moving data around to different shards. This process, known as <strong>re-sharding</strong>, can be complex and resource-intensive, especially in large-scale systems.</li></ul><ul id="111e0021-eb2d-8030-989e-c3ba63b9c336" class="bulleted-list"><li style="list-style-type:circle"><strong>Consistent hashing</strong> can mitigate this issue by minimizing the number of keys that need to be reassigned when the number of shards changes. However, it still doesn’t fully eliminate the complexity involved in rebalancing data across the shards.</li></ul></li></ul><h3 id="111e0021-eb2d-80de-9f18-eaf576a10573" class=""><strong>Directory sharding</strong></h3><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="111e0021-eb2d-8071-8ddc-f912f60d35b3"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><ul id="111e0021-eb2d-8027-8331-db8d747c6bdb" class="bulleted-list"><li style="list-style-type:disc"><strong>Directory sharding uses a lookup table to match database information to the corresponding physical shard. </strong></li></ul><ul id="111e0021-eb2d-8013-9675-e0fd66d994cc" class="bulleted-list"><li style="list-style-type:disc"><strong>A lookup table is like a table on a spreadsheet that links a database column to a shard key. </strong></li></ul></div></figure><p id="111e0021-eb2d-8072-a2fe-ef3852427209" class="">For example, the following diagram shows a lookup table for clothing colors.</p><table id="111e0021-eb2d-80a0-b4e6-efa94f647995" class="simple-table"><tbody><tr id="111e0021-eb2d-8027-b6f3-c13cf0629ff4"><td id="|INc" class=""><strong>Color</strong></td><td id="aa_;" class=""><strong>Shard key</strong></td></tr><tr id="111e0021-eb2d-80d2-bc17-e8dc86c6424e"><td id="|INc" class="">Blue</td><td id="aa_;" class="">A</td></tr><tr id="111e0021-eb2d-80a9-aec8-dabde29f2275"><td id="|INc" class="">Red</td><td id="aa_;" class="">B</td></tr><tr id="111e0021-eb2d-8055-a622-e47a5ab426cc"><td id="|INc" class="">Yellow</td><td id="aa_;" class="">C</td></tr><tr id="111e0021-eb2d-80f9-921c-f30deda36685"><td id="|INc" class="">Black</td><td id="aa_;" class="">D</td></tr></tbody></table><ul id="111e0021-eb2d-80ee-88e7-ee2f4450551b" class="bulleted-list"><li style="list-style-type:disc">When an application stores clothing information in the database, it refers to the lookup table. If a dress is blue, the application stores the information in the corresponding shard.</li></ul><p id="111e0021-eb2d-80ea-8c69-de9406a5b07d" class=""><strong><span style="border-bottom:0.05em solid">Pros and cons</span></strong></p><ul id="111e0021-eb2d-80a0-8442-ee93256e8246" class="bulleted-list"><li style="list-style-type:disc">Software developers use directory sharding because it is flexible. </li></ul><ul id="111e0021-eb2d-80b7-838f-ff1f67b32d48" class="bulleted-list"><li style="list-style-type:disc">Each shard is a meaningful representation of the database and is not limited by ranges. </li></ul><ul id="111e0021-eb2d-80d3-9389-da3606ce9fa6" class="bulleted-list"><li style="list-style-type:disc">However, directory sharding fails if the lookup table contains the wrong information.</li></ul><h3 id="111e0021-eb2d-8096-b295-dde9ee435abe" class=""><strong>Geo sharding</strong></h3><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="111e0021-eb2d-8092-ac77-f7b14b485432"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="111e0021-eb2d-801f-b4ed-dbf642349183" class=""><strong>Geo sharding splits and stores database information according to geographical location. </strong></p></div></figure><p id="111e0021-eb2d-8025-a0ac-e94f573a41aa" class="">For example, a dating service website uses a database to store customer information from various cities as follows.</p><table id="111e0021-eb2d-80bb-bf10-d9bb0c1727ad" class="simple-table"><tbody><tr id="111e0021-eb2d-80c4-a4dd-f10481251959"><td id="zn{&gt;" class=""><strong>Name</strong></td><td id="TqU&lt;" class=""><strong>Shard key</strong></td></tr><tr id="111e0021-eb2d-804f-951b-e44a3aa4a7fc"><td id="zn{&gt;" class="">John</td><td id="TqU&lt;" class="">California</td></tr><tr id="111e0021-eb2d-80a3-b2f2-f92007b99315"><td id="zn{&gt;" class="">Jane</td><td id="TqU&lt;" class="">Washington</td></tr><tr id="111e0021-eb2d-80e7-a76f-f4b3c4d0e0af"><td id="zn{&gt;" class="">Paulo</td><td id="TqU&lt;" class="">Arizona</td></tr></tbody></table><ul id="111e0021-eb2d-808b-a401-d7e2f7186f04" class="bulleted-list"><li style="list-style-type:disc">Software developers use cities as shard keys. </li></ul><ul id="111e0021-eb2d-8092-9d6c-c78c0e90d8db" class="bulleted-list"><li style="list-style-type:disc">They store each customer&#x27;s information in physical shards that are geographically located in the respective cities.</li></ul><p id="111e0021-eb2d-8095-80ab-e9268181290b" class=""><strong><span style="border-bottom:0.05em solid">Pros and cons</span></strong></p><ul id="111e0021-eb2d-8038-92b5-e178cdca7d30" class="bulleted-list"><li style="list-style-type:disc">Geo sharding allows applications to retrieve information faster due to the shorter distance between the shard and the customer making the request. </li></ul><ul id="111e0021-eb2d-8078-91c8-cdd77991329e" class="bulleted-list"><li style="list-style-type:disc">If data access patterns are predominantly based on geography, then this works well. </li></ul><ul id="111e0021-eb2d-8097-95f4-d9a1abafffe0" class="bulleted-list"><li style="list-style-type:disc">However, geo sharding can also result in uneven data distribution.</li></ul></div></details><details open=""><summary style="font-weight:600;font-size:1.5em;line-height:1.3;margin:0">Alternatives to DB Sharding</summary><div class="indented"><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="111e0021-eb2d-8016-9f7f-ee14c0ef1e1a"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="111e0021-eb2d-800e-887f-fb76ca30a825" class=""><strong><span style="border-bottom:0.05em solid">Database sharding is a horizontal scaling strategy that allocates additional nodes or computers to share the workload of an application. </span></strong></p></div></figure><ul id="111e0021-eb2d-808f-b97a-e29040bae4a4" class="bulleted-list"><li style="list-style-type:disc">Organizations benefit from <strong><span style="border-bottom:0.05em solid">horizontal scaling because of its fault-tolerant</span></strong> architecture. </li></ul><ul id="111e0021-eb2d-80f9-90b6-f8137f3c8386" class="bulleted-list"><li style="list-style-type:disc">When one computer fails, the others continue to operate without disruption. Database designers reduce downtime by spreading logical shards across multiple servers.</li></ul><p id="111e0021-eb2d-80c9-8d9d-cba0cb6d4962" class="">However, sharding is one among several other database scaling strategies. Explore some other techniques and understand how they compare.</p><h3 id="111e0021-eb2d-8055-87e3-d0bc74a74f78" class=""><strong>Vertical scaling</strong></h3><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="111e0021-eb2d-8006-a60e-c1a58c7c8001"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="111e0021-eb2d-80ca-b723-c24261d58867" class=""><strong><span style="border-bottom:0.05em solid">Vertical scaling increases the computing power of a single machine. </span></strong></p></div></figure><p id="111e0021-eb2d-80e9-9b7f-cbdccb12d726" class="">For example, the IT team adds a CPU, RAM, and a hard disk to a database server to handle increasing traffic.</p><p id="111e0021-eb2d-80f3-aaa0-fc44347c20ac" class=""><em><strong>Comparison of database sharding and vertical scaling</strong></em></p><ul id="111e0021-eb2d-80f9-9b53-d96d5d2dbe5c" class="bulleted-list"><li style="list-style-type:disc">Vertical scaling is<strong><span style="border-bottom:0.05em solid"> less costly</span></strong>, but <strong><span style="border-bottom:0.05em solid">there is a limit to the computing resources</span></strong> you can scale vertically. </li></ul><ul id="111e0021-eb2d-8026-96ea-e3e4b1ddbac2" class="bulleted-list"><li style="list-style-type:disc">Meanwhile, <strong><span style="border-bottom:0.05em solid">sharding, a horizontal scaling strategy, is easier to implement</span></strong>. For example, the IT team installs multiple computers instead of upgrading old computer hardware.</li></ul><h3 id="111e0021-eb2d-803a-8f86-f171ae78ded3" class=""><strong>Replication</strong></h3><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="111e0021-eb2d-80d0-88dd-f85708f1bc29"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="111e0021-eb2d-807a-8dea-f915f71848b9" class=""><strong><span style="border-bottom:0.05em solid">Replication is a technique that makes exact copies of the database and stores them across different computers.</span></strong></p></div></figure><ul id="111e0021-eb2d-80c0-881f-c12578d309ac" class="bulleted-list"><li style="list-style-type:disc">Database designers use replication to design a fault-tolerant relational database management system. </li></ul><ul id="111e0021-eb2d-8032-942d-cc0bbe6fac82" class="bulleted-list"><li style="list-style-type:disc">When one of the computers hosting the database fails, other replicas remain operational. </li></ul><ul id="111e0021-eb2d-80c9-a6ad-e5e90711cfaa" class="bulleted-list"><li style="list-style-type:disc">Replication is a common practice in distributed computing systems.</li></ul><p id="111e0021-eb2d-80c7-acfa-d7aa7b7b1c95" class=""><em><strong>Comparison of database sharding and replication</strong></em></p><ul id="111e0021-eb2d-8017-9da2-fd50d948b350" class="bulleted-list"><li style="list-style-type:disc">Database sharding does not create copies of the same information. </li></ul><ul id="111e0021-eb2d-8080-a13c-e67613c54941" class="bulleted-list"><li style="list-style-type:disc">Instead, it splits one database into multiple parts and stores them on different computers. </li></ul><ul id="111e0021-eb2d-80a5-b495-e73f9bbf0dae" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Unlike replication, database sharding does not result in high availability</span></strong>. </li></ul><ul id="111e0021-eb2d-806a-bbb9-e160ad3f63cf" class="bulleted-list"><li style="list-style-type:disc">Sharding can be used in combination with replication to achieve both scale and high availability.</li></ul><ul id="111e0021-eb2d-8058-97fd-fa16ad1b9251" class="bulleted-list"><li style="list-style-type:disc">In some cases, database sharding might consist of replications of specific datasets. </li></ul><ul id="111e0021-eb2d-8090-b8bd-ded9f0668e6c" class="bulleted-list"><li style="list-style-type:disc">For example, a retail store that sells products to both US and European customers might store replicas of size conversion tables on different shards for both regions. </li></ul><ul id="111e0021-eb2d-80dc-96dc-d2d9ab3e24c9" class="bulleted-list"><li style="list-style-type:disc">The application can use the duplicate copies of the conversion table to convert the measurement size without accessing other database servers.</li></ul><h3 id="111e0021-eb2d-8055-8fe3-ec536a0c8b59" class=""><strong>Partitioning</strong></h3><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="111e0021-eb2d-8084-b732-ffc41a9d0989"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="111e0021-eb2d-808c-b306-f79d6bdeaecf" class=""><strong><span style="border-bottom:0.05em solid">Partitioning is the process of splitting a database table into multiple groups. </span></strong></p></div></figure><p id="111e0021-eb2d-8038-92c3-d2a55f8accd5" class="">Partitioning is classified into two types:</p><ul id="111e0021-eb2d-8061-a94a-df873bcad8d7" class="bulleted-list"><li style="list-style-type:disc">Horizontal partitioning splits the database by rows.</li></ul><ul id="111e0021-eb2d-8092-b214-f7ff627af0ab" class="bulleted-list"><li style="list-style-type:disc">Vertical partitioning creates different partitions of the database columns.</li></ul><p id="111e0021-eb2d-8018-99cb-f3ff331c6f1d" class=""><em><strong>Comparison of database sharding and partitioning</strong></em></p><ul id="111e0021-eb2d-8075-871b-c23455cd8e50" class="bulleted-list"><li style="list-style-type:disc">Database sharding is like horizontal partitioning. Both processes split the database into multiple groups of unique rows. </li></ul><ul id="111e0021-eb2d-804f-9000-f238ebe38db0" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Partitioning stores all data groups in the same computer</span></strong>, but database sharding spreads them across different computers.</li></ul></div></details></div></details><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">Scaling</summary><div class="indented"><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="111e0021-eb2d-80fc-8f32-f713f62e28dd"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="111e0021-eb2d-8016-bbc2-ca0b0c45e097" class=""><strong>Vertical Scaling OR Scale up → Make current computer (that is serving customers) more powerful</strong></p><p id="111e0021-eb2d-80f7-a207-e30aaa59b810" class=""><strong>Horizontal Scaling OR Scale out → Buy or rent more servers and distribute the load among servers</strong></p></div></figure><figure id="111e0021-eb2d-80f8-9cdd-eb616e247d33" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2010.png"><img style="width:679.96875px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2010.png"/></a></figure><h2 id="111e0021-eb2d-8034-b8fc-e5ecb6400b8a" class=""><span style="border-bottom:0.05em solid">Vertical Scaling</span></h2><ul id="111e0021-eb2d-8062-8631-d8c2238ddad0" class="bulleted-list"><li style="list-style-type:disc">Vertical scaling alone is the easiest way to scale initially because <strong><span style="border-bottom:0.05em solid">it does not require you to change your software architecture</span></strong>. </li></ul><ul id="111e0021-eb2d-801b-944f-d631da017938" class="bulleted-list"><li style="list-style-type:disc">It also has the <strong><span style="border-bottom:0.05em solid">benefit of reducing latency</span></strong> since the <strong><span style="border-bottom:0.05em solid">communication between different parts of your software architecture is done locally on one computer rather than through a network.</span></strong></li></ul><ul id="117e0021-eb2d-804f-9719-d645e1f2d9e1" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">When traffic is low, vertical scaling is a great option.</span></strong></li></ul><ul id="111e0021-eb2d-8014-ad71-c1840d90b572" class="bulleted-list"><li style="list-style-type:disc">However, there are a <strong><span style="border-bottom:0.05em solid">few disadvantages</span></strong> to relying on vertical scaling alone:<ul id="111e0021-eb2d-80fe-843f-c15d409965fe" class="bulleted-list"><li style="list-style-type:circle">Due to physical hardware limitations, <strong><span style="border-bottom:0.05em solid">upgrading a computer&#x27;s hardware past a certain level becomes very expensive or even impossible beyond a certain point</span></strong>. <ul id="117e0021-eb2d-804c-be75-f24f3fce9244" class="bulleted-list"><li style="list-style-type:square">Meaning: no matter how much money you pay, you&#x27;ll never find a single server beefy enough to run a major web service on its own.</li></ul></li></ul><ul id="117e0021-eb2d-8093-a4d0-c9e3014831a8" class="bulleted-list"><li style="list-style-type:circle"><strong><span style="border-bottom:0.05em solid">Does not have failover and redundancy.</span></strong><ul id="111e0021-eb2d-809a-b2e5-dfdebe80f0b1" class="bulleted-list"><li style="list-style-type:square">There is a risk of the <strong><span style="border-bottom:0.05em solid">single system failing to create a single point of failure</span></strong>.</li></ul></li></ul><ul id="111e0021-eb2d-80f5-b734-c0f061ed18e7" class="bulleted-list"><li style="list-style-type:circle">There is less room for fault-tolerance because if single system failed, the service becomes unreachable.</li></ul></li></ul><h2 id="111e0021-eb2d-8010-88e4-d457056cda17" class=""><span style="border-bottom:0.05em solid">Horizontal Scaling</span></h2><ul id="111e0021-eb2d-80c2-8924-ebc828ee0d79" class="bulleted-list"><li style="list-style-type:disc">Horizontal scaling relies on building systems that communicate between multiple computers to store and process information. </li></ul><ul id="117e0021-eb2d-801f-9e7f-c6997f78a715" class="bulleted-list"><li style="list-style-type:disc">More desirable for large scale applications.</li></ul><ul id="111e0021-eb2d-80aa-ba7b-de1623f153e7" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">The two major forms of horizontal scaling are database scaling and compute scaling</span></strong>. We can also use horizontal scaling with caching.</li></ul><h3 id="111e0021-eb2d-8059-a035-cdce4c3e4b47" class="">Database Scaling → Database Sharding</h3><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="111e0021-eb2d-8023-8dc7-fe6686f7ed4b"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="111e0021-eb2d-807d-a2f6-f5c0f5e2a83f" class="">For a special trick to remember what sharding is, think about how when Voldemort split his soul into seven horcruxes, he was basically sharding his soul.</p></div></figure><ul id="111e0021-eb2d-808c-a1da-d02bf7966538" class="bulleted-list"><li style="list-style-type:disc">With database sharding, each time you need <strong><span style="border-bottom:0.05em solid">to store something you would have a hash function that determines in a consistent manner which database to store the item</span></strong>. </li></ul><ul id="111e0021-eb2d-804c-b959-cd3ca74240ad" class="bulleted-list"><li style="list-style-type:disc">When you need <strong><span style="border-bottom:0.05em solid">to retrieve the data again, you will use the same hash function to determine which database to look for your item</span></strong>.</li></ul><h3 id="111e0021-eb2d-80e5-bbca-f5fb2d067190" class="">Compute scaling</h3><p id="111e0021-eb2d-8002-a7f6-e89be76308b6" class="">Imagine now that you need to process large cat videos, and you notice that it is too slow to be done on a single computer. You can use the concept of compute scaling by dividing the video into pieces and designating each piece as a job in a queue so that multiple computers can work together in parallel.</p><figure id="111e0021-eb2d-80ed-87c6-ede9ee8d147d" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2011.png"><img style="width:680px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2011.png"/></a></figure><h2 id="111e0021-eb2d-80c7-a674-df862ee6f144" class="">How horizontal and vertical scaling are used together</h2><ul id="111e0021-eb2d-8071-b26e-d84d9ec853c3" class="bulleted-list"><li style="list-style-type:disc">As mentioned earlier, <strong><span style="border-bottom:0.05em solid">keeping certain processes and services together within a single machine can reduce the latency between calls. </span></strong></li></ul><ul id="111e0021-eb2d-804e-b0ce-ce6ccf7de42f" class="bulleted-list"><li style="list-style-type:disc">It is important to consider which services and processes would be more efficient within the same computer and adjust the compute and storage of each node accordingly.</li></ul><ul id="111e0021-eb2d-8099-95a5-eafebf8c6a3c" class="bulleted-list"><li style="list-style-type:disc">✅ <strong><span style="border-bottom:0.05em solid">A real-world example is email architecture like Gmail, Yahoo Mail, and Outlook</span></strong>. </li></ul><ul id="111e0021-eb2d-8090-920f-ffd142e77d64" class="bulleted-list"><li style="list-style-type:disc">There are many processes that run in parallel for a given user, all of which are computationally inexpensive. </li></ul><ul id="111e0021-eb2d-8036-a78d-f36e2ec30094" class="bulleted-list"><li style="list-style-type:disc">In addition, systems must be very careful about guaranteeing the customer&#x27;s privacy per each country&#x27;s laws. </li></ul><ul id="111e0021-eb2d-80ae-a4ac-fad2fec307f8" class="bulleted-list"><li style="list-style-type:disc">Rather than distributing the processing across different nodes, a single node contains a set of users based on geographic proximity. </li></ul><ul id="111e0021-eb2d-80b9-8d5d-cbed9db70b4a" class="bulleted-list"><li style="list-style-type:disc">To address problems of reliability and a single point of failure, backup nodes follow and duplicate the primary node in case it goes down.</li></ul><figure id="111e0021-eb2d-8098-8e7b-d9e3e11a711a" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2012.png"><img style="width:707.984375px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2012.png"/></a></figure><ul id="112e0021-eb2d-80d5-b480-fbd7479146d6" class="bulleted-list"><li style="list-style-type:disc">In this case, vertical scaling is used when deciding the computer and storage of a given node. </li></ul><ul id="112e0021-eb2d-80df-b3b8-fb5a8a95fc0e" class="bulleted-list"><li style="list-style-type:disc">We need to ensure that it can handle the jobs for a given set of users. This architecture is also making use of horizontal scaling, where millions of primary and backup nodes are spun up to handle all the users using the email platform. </li></ul><ul id="112e0021-eb2d-80da-ae4e-d6491746c1e0" class="bulleted-list"><li style="list-style-type:disc">When a request is made, a load-balancing service will decide which primary node is responsible for handling the given user.<figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="112e0021-eb2d-8070-b850-d29c2abc7171"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><h3 id="112e0021-eb2d-80de-b098-f333d99b01f3" class="">Another note on consideration of scaling during interviews</h3><p id="112e0021-eb2d-801e-aeca-ffae4f0a69fc" class="">A lot of system design interviews will involve how to scale to a large number of users. Do not assume, however, that a particular scaling strategy is required. Instead,<strong><span style="border-bottom:0.05em solid"> have an understanding of the number of users and the amount of data that is required</span></strong> to inform your decision-making. Make a choice, and then explain your rationale.</p></div></figure></li></ul><h2 id="18ce0021-eb2d-80b6-aee2-c43e1d633b18" class="">How to choose between Vertical and Horizontal Scaling ?</h2><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="18ce0021-eb2d-80a2-a75a-d9a9291c7cce"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="18ce0021-eb2d-8010-98cf-fa4a00ec7543" class=""><strong>More senior interviewers will recognize that </strong><strong><span style="border-bottom:0.05em solid">vertical scaling actually requires significantly less incremental complexity</span></strong><strong>. If you can estimate your workload and determine that you can scale vertically for the foreseeable future, this is often a better solution than horizontal scaling. Many systems can scale vertically to a surprising degree.</strong></p></div></figure><ul id="18ce0021-eb2d-80c0-8a42-fb55480fb714" class="bulleted-list"><li style="list-style-type:disc">Oftentimes by scaling you&#x27;re forced <strong><span style="border-bottom:0.05em solid">to contend with the distribution of work, data, and state</span></strong> across your system.</li></ul><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="18ce0021-eb2d-80ce-a7dc-e765d1d45482"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="18ce0021-eb2d-800d-b5c4-f570faeaa0a9" class=""><strong>Inexperienced candidates tend to make two mistakes: (1) they leap to horizontal scaling to solve any performance problem, even when it&#x27;s not necessary, and (2) they don&#x27;t consider the implications of horizontal scaling on the rest of the system. When you encounter a scaling bottleneck, make sure you&#x27;re not throwing machines at a poor design.</strong></p></div></figure><h3 id="18ce0021-eb2d-8080-b81e-f263e462ad55" class="">Work Distribution → Load Balancer</h3><ul id="18ce0021-eb2d-8075-89c5-dc058144dfb8" class="bulleted-list"><li style="list-style-type:disc">Challenge of horizontal scaling → getting the load to the right machine → done by Load Balancer<ul id="18ce0021-eb2d-805e-ad70-f638ce7f4322" class="bulleted-list"><li style="list-style-type:circle">LB chooses which node from a group to use for an incoming request.</li></ul></li></ul><ul id="18ce0021-eb2d-80bb-8d46-eac7b1f00052" class="bulleted-list"><li style="list-style-type:disc">Simple Round Robin allocation for LB is often sufficient.</li></ul><ul id="18ce0021-eb2d-80a7-88c3-c25ae591504e" class="bulleted-list"><li style="list-style-type:disc">For asynchronous jobs work, use queuing system → Message Queues.</li></ul><ul id="18ce0021-eb2d-80a3-9af0-edd7dae95c0d" class="bulleted-list"><li style="list-style-type:disc">Work distribution needs to try to <strong><span style="border-bottom:0.05em solid">keep load on the system as even as possible</span></strong>. <ul id="18ce0021-eb2d-801b-b815-c19094107414" class="bulleted-list"><li style="list-style-type:circle">For example, if you&#x27;re using a hash map to distribute work across a set of nodes, you might find that one node is getting a disproportionate amount of work because of the distribution of incoming requests. </li></ul><ul id="18ce0021-eb2d-8076-a6ad-e6a54c24b150" class="bulleted-list"><li style="list-style-type:circle">The scalability of your system ultimately depends on how effectively you can remediate this. </li></ul><ul id="18ce0021-eb2d-8015-a1fc-dc0931a42946" class="bulleted-list"><li style="list-style-type:circle">If one node is 90% busy and the remaining are 10% busy, you&#x27;re not getting much out of your horizontal scaling.</li></ul></li></ul><h3 id="18ce0021-eb2d-80bf-8807-e0fd6e9aceba" class="">Data Distribution →</h3><ul id="192e0021-eb2d-8073-ae32-da6f149ada7c" class="bulleted-list"><li style="list-style-type:disc">Think about how to distribute data across the system.</li></ul><ul id="192e0021-eb2d-8070-800a-ec6f4af77c72" class="bulleted-list"><li style="list-style-type:disc">Either it can be →<ul id="192e0021-eb2d-8083-b45b-eb4168480421" class="bulleted-list"><li style="list-style-type:circle">Keeping data in-memory on the node thats processing the request.</li></ul><ul id="192e0021-eb2d-8037-b3b8-c85a9c8ed3c2" class="bulleted-list"><li style="list-style-type:circle">keeping data in a database thats shared across all the nodes</li></ul></li></ul><ul id="192e0021-eb2d-803b-9fd5-fd69216a74ce" class="bulleted-list"><li style="list-style-type:disc">Look for way to partition data such that a single nodes can access the data it needs without needing to talk to another node.</li></ul><ul id="192e0021-eb2d-80b8-82ed-c730f05ec667" class="bulleted-list"><li style="list-style-type:disc">Fan-out → If requirement needs talking to other nodes, then keep the number of nodes small.<ul id="192e0021-eb2d-80ba-8e86-e8784bb8176b" class="bulleted-list"><li style="list-style-type:circle">Anti-pattern → To have requests fan out to many different nodes and then the results are all gathered together.</li></ul><ul id="192e0021-eb2d-8011-a1a1-f1aa393840e0" class="bulleted-list"><li style="list-style-type:circle">This scatter gather pattern can be problematic because -<ul id="192e0021-eb2d-80c0-a6f7-f960f8b291cc" class="bulleted-list"><li style="list-style-type:square">Lead to lot of network traffic</li></ul><ul id="192e0021-eb2d-8078-aa64-dfabe3bf67ef" class="bulleted-list"><li style="list-style-type:square">is sensitive to failures in each connection</li></ul><ul id="192e0021-eb2d-80ec-ae8a-ee364ce2e58e" class="bulleted-list"><li style="list-style-type:square">suffers from tail latency if final result is dependent on every response.</li></ul></li></ul></li></ul><h3 id="192e0021-eb2d-8031-9666-f5e249786d2b" class="">Challenges with Horizontal Scaling →</h3><ul id="192e0021-eb2d-80e6-bb09-ccaeda74d613" class="bulleted-list"><li style="list-style-type:disc"><strong>Horizontal scaling</strong> introduces <strong>synchronization challenges</strong> when handling data.</li></ul><ul id="192e0021-eb2d-80b7-b083-eeab14a99134" class="bulleted-list"><li style="list-style-type:disc">Two common approaches:<ul id="192e0021-eb2d-805a-b76c-f81a43804f5a" class="bulleted-list"><li style="list-style-type:circle"><strong>Shared database</strong> (network latency: ~1-10ms) → reading or writing from a shared DB</li></ul><ul id="192e0021-eb2d-8092-9d67-f436988a0e8f" class="bulleted-list"><li style="list-style-type:circle"><strong>Redundant copies</strong> across multiple servers</li></ul></li></ul><ul id="192e0021-eb2d-808b-b11b-c6e6ef297dfd" class="bulleted-list"><li style="list-style-type:disc">Leads to <strong>race conditions</strong> and <strong>consistency challenges</strong>.<ul id="192e0021-eb2d-8064-b085-c13b06546abe" class="bulleted-list"><li style="list-style-type:circle">A <strong>race condition</strong> occurs when multiple processes or threads access and manipulate shared data concurrently, leading to unpredictable or incorrect results due to the timing of operations. </li></ul><ul id="192e0021-eb2d-804a-a287-c0e54e925d27" class="bulleted-list"><li style="list-style-type:circle">In the context of horizontal scaling, if multiple servers update the same piece of data simultaneously without proper synchronization, one update might overwrite another, causing <strong>data inconsistency</strong>. </li></ul><ul id="192e0021-eb2d-8014-9728-dd5d62dd9a16" class="bulleted-list"><li style="list-style-type:circle">Database systems mitigate this using <strong>transactions, locks, and concurrency control mechanisms</strong> to ensure correctness.</li></ul></li></ul><ul id="192e0021-eb2d-8017-b9a7-f656790d9963" class="bulleted-list"><li style="list-style-type:disc"><strong>Databases</strong> address some issues using <strong>transactions</strong>.</li></ul><ul id="192e0021-eb2d-805c-a52b-e591cd3048c5" class="bulleted-list"><li style="list-style-type:disc"><strong>Distributed locks</strong> may be required in other cases</li></ul></div></details><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">CAP Theorem</summary><div class="indented"><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="115e0021-eb2d-80e6-962f-f0f28b77e23b"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="115e0021-eb2d-804e-a075-ebddd1f7ab4e" class="">Consistency, Availability, Partition tolerance - All about Tradeoff</p></div></figure><p id="115e0021-eb2d-80bf-891d-e1d411cbe8fd" class="">It revolves around the following terms - </p><ul id="115e0021-eb2d-80e8-951c-d2dd2647fcf2" class="bulleted-list"><li style="list-style-type:disc">(C)onsistency → every node in a network will have access to same data</li></ul><ul id="115e0021-eb2d-8021-8458-f9c44df55332" class="bulleted-list"><li style="list-style-type:disc">(A)vailability → system is always available to the users, all nodes in system should respond- either success or failure</li></ul><ul id="116e0021-eb2d-807a-904f-f523601c3b1d" class="bulleted-list"><li style="list-style-type:disc">(P)artition fault tolerance → in case of a fault in the network or communication, system will still work.</li></ul><figure id="17ee0021-eb2d-80f9-bec3-c0de736a0812" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2013.png"><img style="width:680px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2013.png"/></a></figure><ul id="116e0021-eb2d-800d-a3a2-e6be4b514e33" class="bulleted-list"><li style="list-style-type:disc">CAP theorem says that a distributed system needs to make a choice between consistency, availability, and partition fault tolerance. </li></ul><ul id="17ee0021-eb2d-80d8-a15b-f8065e96c79c" class="bulleted-list"><li style="list-style-type:disc">It cannot achieve all three, so systems should be designed to achieve two out of these three.</li></ul><ul id="116e0021-eb2d-8063-9fb0-fc0c22fa44f8" class="bulleted-list"><li style="list-style-type:disc">In most systems, fault tolerance is necessary. So the choice is to be made between availability and consistency.</li></ul><ul id="116e0021-eb2d-800d-ad1f-cd08c3f8db01" class="bulleted-list"><li style="list-style-type:disc">Example - <ul id="116e0021-eb2d-8075-b8fb-e9351647465c" class="bulleted-list"><li style="list-style-type:circle">For some systems like financial systems, consistency is very important. </li></ul><ul id="116e0021-eb2d-8083-99f5-e1ea0bf4ab03" class="bulleted-list"><li style="list-style-type:circle">For others like TikTok, where it is OK if some users get access to certain videos later than the rest, we try to aim for availability over consistency. </li></ul><ul id="116e0021-eb2d-80ce-9b9e-faa96959a11a" class="bulleted-list"><li style="list-style-type:circle">Even in these cases, we want our system to eventually have the same view of the data. And that is called eventual consistency, where systems become consistent eventually, if not immediately.</li></ul></li></ul></div></details><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">Consistency</summary><div class="indented"><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="192e0021-eb2d-80e5-b183-c5c43ccf55f2"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="192e0021-eb2d-8050-be9d-ece908bc8290" class="">At higher level pertains to “<em>pertains to how much your users can tolerate getting stale data</em>”</p></div></figure><ul id="192e0021-eb2d-8061-afaf-e68dfb541496" class="bulleted-list"><li style="list-style-type:disc">Strong Consistency → After data is written, all subsequent reads will reflect that write.</li></ul><ul id="192e0021-eb2d-8052-b5fd-da30fdedfffb" class="bulleted-list"><li style="list-style-type:disc">Eventual Consistency → Allows period of time where the data is stale.</li></ul><ul id="192e0021-eb2d-8046-93f0-e192f7f07198" class="bulleted-list"><li style="list-style-type:disc">Most real-life systems don&#x27;t require strong consistency everywhere. <ul id="192e0021-eb2d-80ff-9a23-d61dcf7da6b6" class="bulleted-list"><li style="list-style-type:circle">For example, a social media feed can be eventually consistent → if you post a tweet, it&#x27;s okay if it takes a few seconds for your followers to see it. </li></ul><ul id="192e0021-eb2d-80cc-8788-cda1ed97e30b" class="bulleted-list"><li style="list-style-type:circle">However, a banking system needs to be strongly consistent → if you transfer money from one account to another, it&#x27;s not okay if the money disappears from one account and doesn&#x27;t appear in the other.</li></ul></li></ul><ul id="192e0021-eb2d-8012-a4f4-f559688044c0" class="bulleted-list"><li style="list-style-type:disc">While you might be using a strongly consistent database, if you <strong><span style="border-bottom:0.05em solid">insert a cache and maintain data to a TTL (time to live) the reads through that cache will be eventually consistent.</span></strong></li></ul><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="192e0021-eb2d-80d2-a908-c589c085cfc5"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="192e0021-eb2d-8049-ba66-d91dfd45f1ca" class=""><strong>Many candidates will try to make a decision on consistency </strong><em><strong>across their entire system</strong></em><strong>, but many systems will actually blend strong and weak consistency in different parts of the system. </strong></p><p id="192e0021-eb2d-8040-8e3c-dc61c47983ef" class=""><strong>For example, on an e-commerce site the item details might be eventually consistent (if you update the description of an item, it&#x27;s okay if it takes a few minutes for the description to update on the product page) but the inventory count needs to be strongly consistent (if you sell an item, it&#x27;s not okay for another customer to buy the same unit).</strong></p></div></figure></div></details><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">Locking</summary><div class="indented"><ul id="192e0021-eb2d-805b-948e-d3527fbe14fb" class="bulleted-list"><li style="list-style-type:disc"><strong>Locking ensures exclusive access</strong> to shared resources (e.g., inventory counters, physical devices).</li></ul><ul id="192e0021-eb2d-80ed-b14b-d314c683f46d" class="bulleted-list"><li style="list-style-type:disc"><strong>Locks exist at all levels</strong>: OS, applications, databases, and distributed systems.</li></ul><ul id="192e0021-eb2d-802e-aca3-e0d950ef949b" class="bulleted-list"><li style="list-style-type:disc"><strong>Locks enforce correctness</strong> but can hurt performance.</li></ul><ul id="192e0021-eb2d-801a-94bc-f6906cb3de09" class="bulleted-list"><li style="list-style-type:disc"><strong>Race conditions</strong> occur when multiple clients access the same resource simultaneously, leading to data corruption.</li></ul><ul id="192e0021-eb2d-8020-bcc4-c7f80da66673" class="bulleted-list"><li style="list-style-type:disc"><strong>Three key considerations for locks:</strong><ul id="192e0021-eb2d-80a2-9e28-df37455eb224" class="bulleted-list"><li style="list-style-type:circle"><strong>Granularity:</strong> Lock only what is necessary (e.g., a single user profile, not the entire table).</li></ul><ul id="192e0021-eb2d-80e7-b85c-e8d2a5111850" class="bulleted-list"><li style="list-style-type:circle"><strong>Duration:</strong> Hold locks for the shortest possible time (only during critical updates).<ul id="192e0021-eb2d-8055-9509-e1d30e2598c3" class="bulleted-list"><li style="list-style-type:square"> For example, if we&#x27;re updating a user&#x27;s profile, we want to lock only for the duration of the update and not for the entire request.</li></ul><ul id="192e0021-eb2d-807d-9a93-ef25b352bd47" class="bulleted-list"><li style="list-style-type:square">Instead of locking the entire request (which may include validation, authentication, or other operations), the system locks <strong>only during the actual profile update</strong> in the database.</li></ul><ul id="192e0021-eb2d-80e1-b0a9-e4c110630225" class="bulleted-list"><li style="list-style-type:square">Once the update is complete, the lock is <strong>released immediately</strong>, allowing other operations to proceed without unnecessary delays.</li></ul></li></ul><ul id="192e0021-eb2d-8069-8c75-cb3bea399c4b" class="bulleted-list"><li style="list-style-type:circle"><strong>Bypassing locks:</strong> Use <strong>optimistic concurrency control</strong> when possible, assuming minimal contention and retrying if conflicts occur.</li></ul></li></ul><ul id="192e0021-eb2d-805f-b598-fb645de3993f" class="bulleted-list"><li style="list-style-type:disc"><strong>Optimistic concurrency works well for many systems</strong>, but critical operations (e.g., bank balance updates) require strict locking.</li></ul><h3 id="192e0021-eb2d-8059-8c83-c5e1c0f9fea6" class="">Optimistic Concurrency</h3><p id="192e0021-eb2d-802e-873e-eb8f1a029dee" class=""><strong>Optimistic Concurrency</strong> assumes that conflicts are rare and allows multiple processes to work on the same data <strong>without locking</strong>. Instead of blocking others, it lets them proceed and checks for conflicts only when saving the changes.</p><ul id="192e0021-eb2d-80cc-bcc4-ff64c203f8c5" class="bulleted-list"><li style="list-style-type:disc">How it Works:<ol type="1" id="192e0021-eb2d-804b-b850-c9fd4f64431f" class="numbered-list" start="1"><li><strong>Read the data</strong> (e.g., a user profile).</li></ol><ol type="1" id="192e0021-eb2d-8012-af69-f97f5b34c743" class="numbered-list" start="2"><li><strong>Modify the data</strong> locally.</li></ol><ol type="1" id="192e0021-eb2d-804b-a843-dc103a756cfc" class="numbered-list" start="3"><li><strong>Before saving, check if the data has changed</strong> since it was read.<ul id="192e0021-eb2d-80d2-b033-e4647f112eef" class="bulleted-list"><li style="list-style-type:disc"><strong>If unchanged</strong>, apply the update.</li></ul><ul id="192e0021-eb2d-80fa-9bb7-cc71ed58f267" class="bulleted-list"><li style="list-style-type:disc"><strong>If changed</strong>, retry the operation with the latest data.</li></ul></li></ol></li></ul><ul id="192e0021-eb2d-8014-a492-ee5119e5ac6a" class="bulleted-list"><li style="list-style-type:disc">Example:<ul id="192e0021-eb2d-8020-86ff-e2de0c1d0b95" class="bulleted-list"><li style="list-style-type:circle">Two users open the same profile page.</li></ul><ul id="192e0021-eb2d-8066-8ea9-c9c2393bd249" class="bulleted-list"><li style="list-style-type:circle">User A updates the name and saves.</li></ul><ul id="192e0021-eb2d-809d-a530-cbbf2acad847" class="bulleted-list"><li style="list-style-type:circle">User B (still seeing the old name) tries to update the email.</li></ul><ul id="192e0021-eb2d-80e6-9e8f-ddd417850661" class="bulleted-list"><li style="list-style-type:circle">The system detects that the profile was changed and <strong>prevents overwriting</strong> User A’s update.</li></ul></li></ul><ul id="192e0021-eb2d-8047-98ed-d13d10b8dff8" class="bulleted-list"><li style="list-style-type:disc">This method <strong>avoids locks</strong> and improves performance but requires <strong>conflict resolution</strong> when multiple updates happen.</li></ul><p id="192e0021-eb2d-8089-97fe-e9ec2e42a447" class="">
</p></div></details><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">Indexing</summary><div class="indented"><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="192e0021-eb2d-80d6-9f21-c043958d679e"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="192e0021-eb2d-80e0-b423-d5a2f843d3dc" class="">Making data faster to query OR Making data reads faster.</p><p id="192e0021-eb2d-80b6-b478-d573f4385e58" class="">The process of creating a data structure that makes reads faster.</p></div></figure><p id="192e0021-eb2d-808d-87d4-dd1aee17be0e" class="">Brute-Force (Basic way) →</p><ul id="192e0021-eb2d-8074-a561-d04137cef51c" class="bulleted-list"><li style="list-style-type:disc">Keeping data in a hash map by specific key. Query hash map in constant time to fetch data by key. No need to scan entire DB</li></ul><ul id="192e0021-eb2d-80a0-9c6d-e98d69a7c75b" class="bulleted-list"><li style="list-style-type:disc">Keeping data in sorted list, so that we can use Binary search to find the data in O(log n) time.</li></ul><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="192e0021-eb2d-8083-bbb1-cdf16b3995ab"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="192e0021-eb2d-8042-8ee0-ebe1f10b63c8" class=""><strong>Common principle → do minimal amount of up-front work so that your reads can be extra fast</strong></p></div></figure><p id="192e0021-eb2d-80c5-9b05-c60bf0c76c7d" class="">
</p><p id="192e0021-eb2d-80b2-b8c8-fc5a23ab1eac" class="">
</p></div></details><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">Web Authentication and basic security</summary><div class="indented"><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="116e0021-eb2d-8080-9779-e35e3c150335"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="116e0021-eb2d-8095-a674-dbc1d3578dad" class=""><strong>The question of security is all about the trade off between total safety (a wall) vs total convenience (a hole in the wall)</strong>. </p><p id="116e0021-eb2d-8083-bda9-c5145152a27e" class="">We want to have the right amount of security that minimizes risks while still providing functionality to users.</p></div></figure><h2 id="116e0021-eb2d-8077-a246-e412786ad3ab" class="">Authentication aka “Figuring out who you’re talking to”</h2><figure id="116e0021-eb2d-805c-97a2-ec204fe13bb0" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2014.png"><img style="width:679.984375px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2014.png"/></a></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="116e0021-eb2d-8048-98e6-fd59ede523a1"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="116e0021-eb2d-80ee-8339-d76dd14ef478" class=""><strong>Authentication</strong> → Verifying the identity of service’s users</p><p id="116e0021-eb2d-803f-8ad9-cf25dcb541f2" class=""><strong>Authorization</strong> → Determining which users have permission to take which action.</p></div></figure><p id="116e0021-eb2d-80c7-8158-d6968d7f1671" class="">For moment, we’ll talk about validating identities.</p><h2 id="116e0021-eb2d-8049-a5f5-f3e62b7334ac" class="">Storing Passwords</h2><ul id="116e0021-eb2d-80f2-b260-dcdb68ea2d70" class="bulleted-list"><li style="list-style-type:disc">The most typical, classic way to do authentication is with a username and password combination. </li></ul><ul id="116e0021-eb2d-8026-83bb-c3a345218620" class="bulleted-list"><li style="list-style-type:disc">The username may be a chosen name, email address, phone number, member ID, or any other unique identifier. </li></ul><ul id="116e0021-eb2d-80f1-a8a2-e3205fe152ea" class="bulleted-list"><li style="list-style-type:disc">The password should be a text string known only to the user. To authenticate themselves, the user provides their username and password. As long as only the actual user knows the password, this verifies that they are who they say they are. </li></ul><ul id="116e0021-eb2d-805c-9448-ed2453ac7b15" class="bulleted-list"><li style="list-style-type:disc">Implementation → <ul id="116e0021-eb2d-80d8-a60d-ec91468b5b5e" class="bulleted-list"><li style="list-style-type:circle">The most simple approach would be to store the password text in a data store alongside the username, and then you could compare it directly to the user&#x27;s password submission. </li></ul><ul id="116e0021-eb2d-8085-bde8-c5c57dc876e8" class="bulleted-list"><li style="list-style-type:circle">The <strong><span style="border-bottom:0.05em solid">critical flaw</span></strong> of this approach is that if your database is ever compromised, the attacker will have access to all of your users&#x27; passwords. Because many users reuse the same passwords across multiple services, this could cause problems for your users even beyond your own service.</li></ul></li></ul><h3 id="116e0021-eb2d-801f-a845-e99a3dcea9d8" class="">Hashing</h3><ul id="116e0021-eb2d-8059-a1c8-ea40b278c111" class="bulleted-list"><li style="list-style-type:disc">The first step we can take toward secure password storage is the use of a <strong><span style="border-bottom:0.05em solid">cryptographic hash</span></strong>. </li></ul><ul id="116e0021-eb2d-80c3-b75f-c99abc431867" class="bulleted-list"><li style="list-style-type:disc"><strong>A hash function</strong> is a function that accepts an input and maps it to a smaller value. </li></ul><ul id="116e0021-eb2d-806a-87a4-d6ae649ecdc9" class="bulleted-list"><li style="list-style-type:disc"><strong>Cryptographic hash functions</strong> in particular are designed to make it as mathematically difficult as possible to derive the input value from the output value. If you use a modern, secure hash function, it would be nearly impossible to reverse the hash for all intents and purposes.</li></ul><ul id="116e0021-eb2d-803f-9abe-de48a671f31b" class="bulleted-list"><li style="list-style-type:disc">We can use this phenomenon to our advantage. When your user first signs up and provides their password, don&#x27;t store the password itself. Instead, run the password through a secure hash function and store the output - a value that we will refer to as the password&#x27;s hash.<figure id="116e0021-eb2d-8091-af4b-f612289220e5" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/c6c1140d-daf9-4d90-8e40-628c4ce0d1d1.png"><img style="width:708px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/c6c1140d-daf9-4d90-8e40-628c4ce0d1d1.png"/></a></figure></li></ul><ul id="116e0021-eb2d-80bd-a4ed-d1c3b2dcab4e" class="bulleted-list"><li style="list-style-type:disc">Now if we want to authenticate a user, we can apply the same hash function to the password they provide. If the hash matches the one stored in your database, then the password was correct and we can sign the user in.<figure id="116e0021-eb2d-807b-817a-f433d5fbda05" class="image"><a href="https://interviewing.io/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fpassword-username-hashing.08d9dba0.png&amp;w=3840&amp;q=75"><img style="width:700px" src="https://interviewing.io/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fpassword-username-hashing.08d9dba0.png&amp;w=3840&amp;q=75"/></a></figure></li></ul><h3 id="116e0021-eb2d-80fe-9415-d024e37fec41" class="">Salting</h3><ul id="116e0021-eb2d-800c-9c38-c0b7d695febd" class="bulleted-list"><li style="list-style-type:disc">Another issue you encounter is that sometimes the passwords your group sets are easily guessable. One way to solve this is to salt the password by adding in some random words that aren&#x27;t obvious.</li></ul><ul id="116e0021-eb2d-802a-8d88-c4c421306c29" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">But there&#x27;s another vulnerability we need to address: rainbow tables</span></strong>. <ul id="116e0021-eb2d-80ce-83ec-c428463db705" class="bulleted-list"><li style="list-style-type:circle"><strong><span style="border-bottom:0.05em solid">A rainbow table is an enormous lookup table containing millions of common passwords and their variations, along with their hashes for a common hash algorithm. </span></strong></li></ul><ul id="116e0021-eb2d-8042-918a-d39bdbfcbdc7" class="bulleted-list"><li style="list-style-type:circle">An attacker with a rainbow table who gets their hands on a credential database could rapidly search the database for users whose hashes are in their rainbow table and then quickly compromise those passwords.</li></ul></li></ul><ul id="116e0021-eb2d-80e5-957b-c262d66e1843" class="bulleted-list"><li style="list-style-type:disc">In software security, salting our passwords makes them much harder for an attacker to uncover.</li></ul><ul id="116e0021-eb2d-806c-b82e-fb300e6fdce7" class="bulleted-list"><li style="list-style-type:disc">Unfortunately, users frequently use common passwords (that is, after all, what makes them common), so we should defend against this attack. </li></ul><ul id="116e0021-eb2d-80eb-9a80-daf5d5d0e81a" class="bulleted-list"><li style="list-style-type:disc">We can do that with a technique called &quot;salting.&quot; </li></ul><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="116e0021-eb2d-80ab-bd83-d3644a746351"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><ul id="116e0021-eb2d-80bf-86f5-ea86ff7fb226" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">The basic idea behind salting is that rather than hashing the password itself, we hash the password concatenated to a random value, which we can store in plain text along with the hash. Then we apply the same salt when hashing user-provided passwords for login attempts.</span></strong></li></ul></div></figure><figure id="116e0021-eb2d-800e-9c8e-f86dd5e4495f" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2015.png"><img style="width:680px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2015.png"/></a></figure><ul id="116e0021-eb2d-802b-8bd6-e3b5fa65ca4c" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">The salt is not a secret. Its purpose is simply to render rainbow tables unusable</span></strong>.</li></ul><ul id="116e0021-eb2d-808d-8a64-dcacc0753ebc" class="bulleted-list"><li style="list-style-type:disc">Example → <ul id="116e0021-eb2d-80f7-af89-eb034196a81d" class="bulleted-list"><li style="list-style-type:circle">Say we use ten random characters as our salt, and user A&#x27;s password salt is &quot;a8h2rmd1tb&quot;. User A&#x27;s password is &quot;password123&quot;. </li></ul><ul id="116e0021-eb2d-809c-9ffd-e5d5e796459e" class="bulleted-list"><li style="list-style-type:circle">If an attacker obtains the credential database, they will certainly have the hash of &quot;password123&quot; in their rainbow table. </li></ul><ul id="116e0021-eb2d-80e4-9164-cb4627ee4e9a" class="bulleted-list"><li style="list-style-type:circle">But they almost definitely will not have the hash of &quot;password123:a8h2rmd1tb&quot; in their rainbow table, which means they won&#x27;t be able to derive user A&#x27;s password from the table.</li></ul></li></ul><ul id="116e0021-eb2d-807a-93ae-c0fe0fed6b7e" class="bulleted-list"><li style="list-style-type:disc">The attacker still has the salt, and it doesn&#x27;t stop them from using brute force attacks in which they simply try random combinations of words and characters until they find the correct password. </li></ul><ul id="116e0021-eb2d-80d5-9502-dd1ff276e8f7" class="bulleted-list"><li style="list-style-type:disc">But the salt forces them to do this work for every user rather than simply looking them up in a table. </li></ul><ul id="116e0021-eb2d-8069-ae56-c8150bd17808" class="bulleted-list"><li style="list-style-type:disc">Using a slower hash function will further frustrate brute force attacks by increasing the amount of computer time the attacker needs in order to compromise each password.</li></ul><h3 id="116e0021-eb2d-8096-88ab-fa5d2a118209" class="">Real World Password Hashing</h3><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="116e0021-eb2d-8063-8182-ec9b4d9c5c22"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="116e0021-eb2d-804c-8a9b-f9957f0cdbe8" class="">In actual practice, <strong><span style="border-bottom:0.05em solid">avoid writing your own code to salt, hash, and store passwords</span></strong>. The principles are simple, but the i<strong><span style="border-bottom:0.05em solid">mplementation details are tricky</span></strong>, and a subtle mistake could severely compromise your password security. Instead, <strong><span style="border-bottom:0.05em solid">look for modern, vetted, secure libraries that can do hash generation and password comparison for you.</span></strong></p></div></figure><h2 id="116e0021-eb2d-8027-916d-d6839e655fef" class="">Web Sign-in</h2><ul id="116e0021-eb2d-8080-a655-c2a405cd4359" class="bulleted-list"><li style="list-style-type:disc">Using Web UI Form submission, but can be done using async request.</li></ul><ul id="116e0021-eb2d-8054-b02b-fd2c3bd84d12" class="bulleted-list"><li style="list-style-type:disc">Login handlers should <strong><span style="border-bottom:0.05em solid">always use HTTPS to ensure that credentials don&#x27;t pass in plain text over the network</span></strong> where they could be intercepted. </li></ul><ul id="116e0021-eb2d-8067-ab1f-f3791f833730" class="bulleted-list"><li style="list-style-type:disc">Of course <strong><span style="border-bottom:0.05em solid">it&#x27;s a good practice to encrypt all web traffic with HTTPS</span></strong>, but password submissions in particular must be protected.</li></ul><ul id="116e0021-eb2d-8086-b7f2-c9a3196b6bb9" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">AVOID LOGGING CODE</span></strong>.<ul id="116e0021-eb2d-803a-8aa1-dc77bea3f55a" class="bulleted-list"><li style="list-style-type:circle">A good rule of thumb is to <strong><span style="border-bottom:0.05em solid">avoid automatically logging POST bodies and GET parameters</span></strong>. </li></ul><ul id="116e0021-eb2d-8016-8b35-f4a4a1780cf0" class="bulleted-list"><li style="list-style-type:circle">Instead, <strong><span style="border-bottom:0.05em solid">keep automatic logging to things like URL paths and response codes</span></strong>, and log parameters manually when necessary after verifying that they don&#x27;t include sensitive credentials.</li></ul></li></ul><ul id="116e0021-eb2d-8063-bede-ed2125341e48" class="bulleted-list"><li style="list-style-type:disc">After your user has submitted their password to log in, assuming they pass verification, you need to give them a way to prove their authentication on subsequent requests. </li></ul><ul id="116e0021-eb2d-80dc-8369-ec12459f0b36" class="bulleted-list"><li style="list-style-type:disc">We don&#x27;t want the user to have to submit their password with every single page request, of course.</li></ul><h2 id="116e0021-eb2d-80fa-8488-c1cea1cd4fd1" class="">Session Tokens</h2><ul id="116e0021-eb2d-8028-99d7-dfe80af31a15" class="bulleted-list"><li style="list-style-type:disc">A classic, simple way to track authentication is <strong><span style="border-bottom:0.05em solid">to generate a token the user can submit with subsequent requests</span></strong> to track that they are, in fact, signed in. </li></ul><ul id="116e0021-eb2d-8011-998d-fb7c5bf323e5" class="bulleted-list"><li style="list-style-type:disc">This token should be <strong><span style="border-bottom:0.05em solid">randomly generated</span></strong>—be sure to use a secure random number generator—and long enough to be infeasible to brute force. This token will represent this particular sign-in session for this user. </li></ul><ul id="116e0021-eb2d-8009-a436-e37498bf5151" class="bulleted-list"><li style="list-style-type:disc">Now you can <strong><span style="border-bottom:0.05em solid">check for this session token in a cookie on subsequent requests to verify that you&#x27;re still dealing with the same logged-in user</span></strong>.</li></ul><ul id="116e0021-eb2d-80eb-a57b-c0dd768a920b" class="bulleted-list"><li style="list-style-type:disc">Crucially, <strong><span style="border-bottom:0.05em solid">the session token is equivalent to a password</span></strong><span style="border-bottom:0.05em solid"> </span>and should be treated accordingly. <ul id="116e0021-eb2d-8038-9834-ffc119fb5747" class="bulleted-list"><li style="list-style-type:circle">Don&#x27;t store the token in your database in plain text, but rather salt and hash it the same way you would a password. </li></ul></li></ul><ul id="116e0021-eb2d-8072-ba4d-cb12806d3209" class="bulleted-list"><li style="list-style-type:disc">Session tokens should also come with an expiration date, as short as feasible. </li></ul><ul id="116e0021-eb2d-808d-8f8b-d29062894077" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">The expiration of a session token doesn&#x27;t mean that the user has to log in again—you can rotate them silently in the background between one request and the next. It will limit the amount of time the user can remain logged in without visiting your site, so use that as your guiding principle when selecting a token expiration time. </span></strong></li></ul><ul id="116e0021-eb2d-80b6-963a-fc936da51756" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">The shorter the expiration time, the less opportunity an attacker</span></strong> who steals a user&#x27;s session token will have to exploit it.</li></ul><ul id="116e0021-eb2d-80f1-821b-faa857c43f7a" class="bulleted-list"><li style="list-style-type:disc">This is, of course, another fantastic reason to encrypt all of your traffic with HTTPS. </li></ul><ul id="116e0021-eb2d-807e-9b4c-c7c62f98a0b4" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">If you secure only the login endpoint, the user&#x27;s subsequent unencrypted requests will be vulnerable to interception and each of them will include their session token.</span></strong></li></ul><h2 id="116e0021-eb2d-80fc-8183-dd333d9fc3c3" class="">JSON Web Tokens (JWTs)</h2><ul id="116e0021-eb2d-8076-aa16-f83743168a2c" class="bulleted-list"><li style="list-style-type:disc">While a session token is an opaque string that means nothing without access to the session database, <strong><span style="border-bottom:0.05em solid">a JWT explicitly encodes the user&#x27;s access</span></strong>. </li></ul><ul id="116e0021-eb2d-80bf-bfef-c61b5f130961" class="bulleted-list"><li style="list-style-type:disc">It may list the logged in user&#x27;s username or ID, as well as explicit capabilities or permissions that have been authorized for that specific login. </li></ul><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="116e0021-eb2d-8003-bd0b-cec12de5be3d"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><blockquote id="116e0021-eb2d-80b3-90da-e6c39845efd4" class=""><strong><span style="border-bottom:0.05em solid">The JWT standard defines a </span></strong><strong><span style="border-bottom:0.05em solid">canonical way</span></strong><strong><span style="border-bottom:0.05em solid"> to encode this data along with expiration and other metadata, although you can use the same concept for your own custom payloads if needed.</span></strong></blockquote></div></figure><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="116e0021-eb2d-8009-9d73-d2c832c5d596" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all">{
  sub: &#x27;user123&#x27;,
  email: &#x27;user@domain.com&#x27;,
  iat: 1665385660,
}</code></pre><ul id="116e0021-eb2d-80e5-9b20-e777ce50001d" class="bulleted-list"><li style="list-style-type:disc">Of course a JSON payload listing the user&#x27;s ID and permissions would be comically easy to falsify, so we can&#x27;t use the JSON alone to verify a logged-in user. To render the JWT valid, the server must do one of two things →<ul id="116e0021-eb2d-808e-87ca-f33c5bc8dab2" class="bulleted-list"><li style="list-style-type:circle"><strong><span style="border-bottom:0.05em solid">Sign the payload</span></strong><ul id="116e0021-eb2d-8029-93c8-e71930e5c62b" class="bulleted-list"><li style="list-style-type:square"><strong><span style="border-bottom:0.05em solid">Attaching a signature from a private key held only by your service verifies the token&#x27;s legitimacy</span></strong>. This approach has two primary advantages. </li></ul><ul id="116e0021-eb2d-808b-a52e-dab91e969a6f" class="bulleted-list"><li style="list-style-type:square">The first is that the token is<strong><span style="border-bottom:0.05em solid"> fully transparent</span></strong>. You can use it on the client side to tell who&#x27;s logged in and optionally what permissions they have.</li></ul><ul id="116e0021-eb2d-8091-9f17-e9a29131b55b" class="bulleted-list"><li style="list-style-type:square">The other advantage, and perhaps the strongest selling point for JWT as a whole, is that <strong><span style="border-bottom:0.05em solid">you can use the token with other services</span></strong>. <ul id="116e0021-eb2d-80f5-8d8b-d826bfd55f01" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">As long as you publish the corresponding public key (signature) to the private key used to sign tokens, not only your own services but services from entirely different providers can validate the token, allowing your user to authenticate elsewhere on the web.</span></strong></li></ul></li></ul></li></ul><ul id="116e0021-eb2d-80ce-8593-f6f9d3e1438e" class="bulleted-list"><li style="list-style-type:circle"><strong><span style="border-bottom:0.05em solid">Encrypt the payload</span></strong><ul id="116e0021-eb2d-803f-ab9f-d1b7e4cd4392" class="bulleted-list"><li style="list-style-type:square">Alternatively, <strong><span style="border-bottom:0.05em solid">you may encrypt the payload so that only your service can read it</span></strong>. This is a less common approach to JWT, and it turns the token into something closer to a simple session token—neither the client nor third-party services can derive any information from it. This approach may still be useful, however. </li></ul><ul id="116e0021-eb2d-8084-b214-e957cd930efd" class="bulleted-list"><li style="list-style-type:square"><strong><span style="border-bottom:0.05em solid">If you distribute the decryption key to different services within your project, they will be able to validate encrypted tokens without needing access to a centralized session database</span></strong>. </li></ul><ul id="116e0021-eb2d-8023-b6a8-d715adccc5f3" class="bulleted-list"><li style="list-style-type:square">In more niche use cases, you can also use this approach to &quot;store&quot; small amounts of data for the duration of the session without writing them to a database or making them visible to the user. Just insert the data you need into the encrypted token, and you&#x27;ll have access every time the user presents their token to verify the session.</li></ul></li></ul></li></ul><h2 id="116e0021-eb2d-80fa-b825-d9ad3864a9c2" class="">Cookies</h2><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="116e0021-eb2d-80f0-a7ac-f29a1e506f7c"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><ul id="116e0021-eb2d-8061-9f11-c5d660dfcad1" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Whether you use session tokens or JWTs, you&#x27;ll need a mechanism to store the token on the client side and send it back to the server with each request. The standard way to do this in web applications is to use browser cookies.</span></strong></li></ul></div></figure><ul id="116e0021-eb2d-8052-996b-c5ec5d92a90e" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">A cookie is simply a text string that the browser associates with a given key and sends back to the server whenever it makes a request.</span></strong> </li></ul><ul id="116e0021-eb2d-808e-9278-c415efd93b03" class="bulleted-list"><li style="list-style-type:disc">The server may include, in any response, one or more “Set-Cookie” headers. </li></ul><ul id="116e0021-eb2d-8084-8cab-dbaecbb443a4" class="bulleted-list"><li style="list-style-type:disc">The header indicates the key and value to store, along with some metadata regarding expiration and security.<figure id="116e0021-eb2d-80a7-a8a7-f583241d3908" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2016.png"><img style="width:680px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2016.png"/></a></figure></li></ul><ul id="116e0021-eb2d-8078-80f2-d86e9818ce2c" class="bulleted-list"><li style="list-style-type:disc">Subsequently, <strong><span style="border-bottom:0.05em solid">the browser automatically includes those cookie values in every request made to the same domain</span></strong> (potentially limited by path, if one was specified while setting the cookie). </li></ul><ul id="116e0021-eb2d-8087-984f-e2f0c58440a5" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">By storing a session token or JWT in a cookie, we can ensure that all subsequent requests will include it and allow the server to validate the current user session.</span></strong><figure id="116e0021-eb2d-80f7-8171-d0447ed8c1d4" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/1231e8d7-a32a-4d7a-b544-c93a83e2a0f9.png"><img style="width:708px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/1231e8d7-a32a-4d7a-b544-c93a83e2a0f9.png"/></a></figure></li></ul><ul id="116e0021-eb2d-80f1-8a54-e9fd04eeb464" class="bulleted-list"><li style="list-style-type:disc">Since our auth tokens—whether session token or JWT—are equivalent to passwords, we need to be very careful about who can access these cookies and how. Thankfully, browsers have made great strides in recent years toward keeping cookies safe.</li></ul><ul id="116e0021-eb2d-80d6-8ed2-ee484a84878f" class="bulleted-list"><li style="list-style-type:disc">The HTTP protocol specification contains several mechanisms that developers can use to reduce the risk of attackers accessing, reusing, or forging the contents of the cookies with sensitive data. </li></ul><ul id="116e0021-eb2d-800f-a68e-d5eb2a90cdac" class="bulleted-list"><li style="list-style-type:disc">To use these protections, a developer configures specific parameters along with cookie values when creating new cookies using the <em>Set-Cookie</em> HTTP response header. The parameters affect when cookies are sent back to the server by the browser using the <em>Cookie</em> HTTP request header.<ul id="116e0021-eb2d-80c5-a198-f70d7949ba55" class="bulleted-list"><li style="list-style-type:circle"><strong><span style="border-bottom:0.05em solid">Secure flag</span></strong> →  tells the browser <strong><span style="border-bottom:0.05em solid">only to include it in HTTPS requests</span></strong>, keeping it out of unencrypted traffic that could be intercepted.</li></ul><ul id="116e0021-eb2d-800b-93ba-d6b5451c0444" class="bulleted-list"><li style="list-style-type:circle"><strong><span style="border-bottom:0.05em solid">HttpOnly flag</span></strong> → tells the browser <strong><span style="border-bottom:0.05em solid">not to allow access to the cookie through JavaScript</span></strong>. The cookie will still be sent in request headers,<strong><span style="border-bottom:0.05em solid"> but snooping frontend code won&#x27;t have direct access to it.</span></strong></li></ul><ul id="116e0021-eb2d-80ef-b6cb-d3306e125178" class="bulleted-list"><li style="list-style-type:circle"><strong><span style="border-bottom:0.05em solid">SameSite flag</span></strong> → allows you to<strong><span style="border-bottom:0.05em solid"> specify the degree of caution the browser should take when sending requests that originate from a different site</span></strong>, to help prevent cross-site request forgery (CSRF) attacks.</li></ul></li></ul></div></details><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">Load Balancer</summary><div class="indented"><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="116e0021-eb2d-801c-98aa-e147cd51af82"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="116e0021-eb2d-801a-9574-c8f234ac022c" class=""><strong><span style="border-bottom:0.05em solid">Load balancers are an important component of any distributed system that helps evenly distribute traffic across the machines. </span></strong></p></div></figure><ul id="116e0021-eb2d-8062-bc11-ceb4c6de63ae" class="bulleted-list"><li style="list-style-type:disc">As distributed systems are designed to scale, t<strong><span style="border-bottom:0.05em solid">he basic requirement is to add or remove machines in case of increased load or in case of failures</span></strong>. Load balancers also help manage this.</li></ul><p id="117e0021-eb2d-80c6-9624-c8928c835fc9" class="">
</p><figure id="117e0021-eb2d-804c-9930-f1d07a663b3d" class="image" style="text-align:center"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2017.png"><img style="width:528px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2017.png"/></a></figure><ul id="117e0021-eb2d-800e-bd79-f47d644975f6" class="bulleted-list"><li style="list-style-type:disc">Users connect to the public IP of the load balancer directly.</li></ul><ul id="117e0021-eb2d-80fa-8e86-ca70bb58e25f" class="bulleted-list"><li style="list-style-type:disc">With this setup, web servers are unreachable directly by the clients.</li></ul><ul id="117e0021-eb2d-80de-b2fc-ddad9cb7df0c" class="bulleted-list"><li style="list-style-type:disc">For better security, private IPs are used for communication between servers.<ul id="117e0021-eb2d-8057-9100-f2bde1947d60" class="bulleted-list"><li style="list-style-type:circle">A private IP is an IP address reachable only between servers in the same network and it is unreachable over the internet.</li></ul></li></ul><ul id="117e0021-eb2d-801c-8944-f7e6f20b3e86" class="bulleted-list"><li style="list-style-type:disc">The load balancer communicates with the web servers through private IPs.</li></ul><ul id="117e0021-eb2d-8022-a717-e4a55db221ca" class="bulleted-list"><li style="list-style-type:disc">Adding a load balancer and a second web server solved the “no failover issue and improved the availability of web tier”.<ul id="117e0021-eb2d-80f6-92d7-e8cec09fabc4" class="bulleted-list"><li style="list-style-type:circle">If server 1 goes offline, <span style="border-bottom:0.05em solid">all the traffic will be routed to server 2</span>. This prevents the website from going offline. We will also add a new healthy web server to the server pool to balance the load.</li></ul><ul id="117e0021-eb2d-8036-912a-e843bcf9c9f4" class="bulleted-list"><li style="list-style-type:circle">If the website traffic grows rapidly, and two servers are not enough to handle the traffic, <span style="border-bottom:0.05em solid">the load balancer can handle this problem gracefully. You only need to add more servers to the web server pool</span>, and the load balancer automatically starts to send requests to them.</li></ul></li></ul><h2 id="116e0021-eb2d-8017-9c14-c23dda513bd6" class="">Round Robin</h2><ul id="116e0021-eb2d-806b-bf1d-fdaf91a5089a" class="bulleted-list"><li style="list-style-type:disc">In this technique,<strong><span style="border-bottom:0.05em solid"> if there are “N” machines, then the load balancer will send requests to each of them one by one.</span></strong> </li></ul><ul id="116e0021-eb2d-8041-92a2-d1bc2098a99b" class="bulleted-list"><li style="list-style-type:disc">Although this should mostly work, in the case where a machine is loaded (not able to process requests in a timely fashion), the load balancer keeps bombarding the machine.</li></ul><h2 id="116e0021-eb2d-8097-af0b-f2982dd8b8bc" class="">Least connections/ response time</h2><ul id="116e0021-eb2d-80fe-ad49-e20385d4f3bf" class="bulleted-list"><li style="list-style-type:disc">We <strong><span style="border-bottom:0.05em solid">send the requests to the machine with the least connections or the minimum response time</span></strong>. </li></ul><ul id="116e0021-eb2d-80d2-949c-c1bde443eaea" class="bulleted-list"><li style="list-style-type:disc">This option is useful for incoming requests that have <strong><span style="border-bottom:0.05em solid">varying connection times</span></strong> and a set of <strong><span style="border-bottom:0.05em solid">servers that are relatively similar in terms of available compute and other resources</span></strong>.</li></ul><h2 id="116e0021-eb2d-80f6-ab40-c161fb2b01f0" class="">Hashing</h2><ul id="116e0021-eb2d-8045-9dce-f401e775f658" class="bulleted-list"><li style="list-style-type:disc">Hashing is based on an <strong><span style="border-bottom:0.05em solid">arbitrarily chosen key</span></strong>. </li></ul><ul id="116e0021-eb2d-809d-9d5e-fff7a6a51a40" class="bulleted-list"><li style="list-style-type:disc">The key for hashing can be a request id for a given user or an IP address. </li></ul><ul id="116e0021-eb2d-80ff-9e34-cf8e1c93d367" class="bulleted-list"><li style="list-style-type:disc">The hash function returns a numeric result for each key.</li></ul><ul id="116e0021-eb2d-808f-8a77-ffdab66b4214" class="bulleted-list"><li style="list-style-type:disc"> Using the hashing result, this is how we can obtain the server id to which the request should be sent:</li></ul><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="116e0021-eb2d-803c-bef8-c95177596cec" class="code"><code class="language-JavaScript">machine_id = H(request_id) % n

where H() is the hash function, &#x27;%&#x27; is the modulo operator, 
and “n” is the number of machines present in the system.</code></pre><ul id="116e0021-eb2d-8067-b8ee-cef2ddd9f243" class="bulleted-list"><li style="list-style-type:disc">With hashing, <strong><span style="border-bottom:0.05em solid">the addition and subtraction of machines leads to the same request being sent to multiple machines.</span></strong></li></ul></div></details><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">Caching</summary><div class="indented"><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="116e0021-eb2d-8070-bce3-cece9999c2ed"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="116e0021-eb2d-806c-bd99-d57a248bcc74" class="">Caching is <strong><span style="border-bottom:0.05em solid">storing an expensive computation so you don&#x27;t have to compute it again; to improve the load/response time.</span></strong></p></div></figure><h2 id="116e0021-eb2d-80ef-b13e-ec0002831e16" class="">Why use caching ?</h2><ul id="117e0021-eb2d-806a-8157-d369cb8c8b40" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Reduce latency of an expensive network computation or network calls or database queries or asset fetching.</span></strong></li></ul><ul id="117e0021-eb2d-8032-8113-e657b111253e" class="bulleted-list"><li style="list-style-type:disc">Generally, <strong><span style="border-bottom:0.05em solid">caching is used at the expense of more storage (or more memory)</span></strong>. Generally we store it in memory (RAM), but it can be stored on disk too.</li></ul><p id="117e0021-eb2d-80d6-94a2-d32b1bd0e3b3" class="">
</p><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="117e0021-eb2d-80a0-8306-c1cd10849ee1"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><h3 id="117e0021-eb2d-801d-ac38-ea9287c8a1ba" class=""><strong>Rule of thumb</strong></h3><p id="117e0021-eb2d-8041-9b02-f38197f68cab" class="">Caching is used for <strong><span style="border-bottom:0.05em solid">read-heavy systems</span></strong>. Popular read heavy systems - Twitter and Youtube. Are most of their millions of users tweeting and posting videos? No, their most common users are reading tweets and watching videos.</p></div></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="117e0021-eb2d-80c8-b493-fff91dfe1253"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><h3 id="117e0021-eb2d-80a8-8816-f14d8716b268" class="">Rule of thumb</h3><p id="117e0021-eb2d-800f-8b95-d0d7a17d65f2" class="">The 80/20 rule: <strong><span style="border-bottom:0.05em solid">You want to store 80% of read requests in 20% of storage (or memory). Generally, these are the most popular requests.</span></strong></p><p id="117e0021-eb2d-801a-a82f-edd75eba1b0e" class="">For example, if there is a tweet from a very popular person on twitter you would cache it everywhere (on a device, on a CDN, on the application) so that whenever that tweet is finished you can fetch it very quickly and serve it up to your users.</p><p id="117e0021-eb2d-803b-b16a-d29a99ceb331" class="">A CDN (content delivery network) is something that&#x27;s commonly used to deliver cached data.</p></div></figure><h3 id="117e0021-eb2d-80f0-9f37-fe5260441233" class="">Benefits of having a separate cache tier</h3><ul id="117e0021-eb2d-80f2-af40-d311750f2446" class="bulleted-list"><li style="list-style-type:disc">Better system performance</li></ul><ul id="117e0021-eb2d-805e-a517-d7c525a01768" class="bulleted-list"><li style="list-style-type:disc">Ability to reduce database workloads</li></ul><ul id="117e0021-eb2d-801c-bb78-dd8146f8eacf" class="bulleted-list"><li style="list-style-type:disc">Ability to scale the cache tier independently</li></ul><h2 id="117e0021-eb2d-808a-b167-f04e33c3f033" class="">Caching Patterns</h2><h3 id="117e0021-eb2d-8052-aa64-e333de831e12" class="">Cache aside pattern or Read-through cache</h3><ul id="117e0021-eb2d-80a1-b133-f1b171748655" class="bulleted-list"><li style="list-style-type:disc">Application will try to fetch data from the cache.</li></ul><ul id="117e0021-eb2d-80cd-bdc8-eb68c5c77331" class="bulleted-list"><li style="list-style-type:disc">If data is not available in the cache, known as “cache miss” it will fetch data from database or will do some expensive computation and put the data in the cache before returning the response to the user.</li></ul><ul id="117e0021-eb2d-804d-9537-dbbc24265fa2" class="bulleted-list"><li style="list-style-type:disc">We only cache data we need.<figure id="117e0021-eb2d-80a2-848d-cd34ee614567" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/Blank_board.png"><img style="width:2889px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/Blank_board.png"/></a></figure></li></ul><ul id="117e0021-eb2d-806d-9844-c26f6425d813" class="bulleted-list"><li style="list-style-type:disc">Disadvantages →<ul id="117e0021-eb2d-8016-a19e-d62489aa4cd9" class="bulleted-list"><li style="list-style-type:circle">Data can become stale in the cache, if there are lots of DB updates. This disadvantage can be mitigated by having “Time To Live” expiry pattern (<em>the amount of time or “hops” that a packet is set to exist inside a network before being discarded by a router</em><strong>)</strong>.</li></ul><ul id="117e0021-eb2d-8082-9b09-db5a36f3c64b" class="bulleted-list"><li style="list-style-type:circle">If there are a lot of cache misses in the application, then the application has to do a lot more work than in the regular flow of just fetching solely from DB.<ul id="117e0021-eb2d-80cb-8fdf-d27c7b388f60" class="bulleted-list"><li style="list-style-type:square">In this case, application will first go to the cache, then it will go back to DB and then write the data back to cache before going back to the user.</li></ul><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="117e0021-eb2d-80e0-9e3b-f741a8483e5a"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><h3 id="117e0021-eb2d-80b2-8c40-e0c23b0fad28" class="">Remember</h3><p id="117e0021-eb2d-80a9-b87f-ff7cee8d9d6d" class="">We use <strong><span style="border-bottom:0.05em solid">caches to reduce latency, but in this case (of many cache misses) we&#x27;re making latency worse because of all the extra work the application has to do.</span></strong></p></div></figure></li></ul></li></ul><h3 id="117e0021-eb2d-804b-b845-cc105db72318" class="">Write-through and Write-back patterns</h3><ul id="117e0021-eb2d-8001-b274-f8f943a4a0ef" class="bulleted-list"><li style="list-style-type:disc">Application directly write data to cache and then cache writes data to DB.</li></ul><ul id="117e0021-eb2d-80cd-bcbc-cc0959bb36bd" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Write-through</span></strong> → application writes to cache <strong><span style="border-bottom:0.05em solid">synchronously</span></strong>.</li></ul><ul id="117e0021-eb2d-8081-ba81-ce414b76e0f3" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Write-back or Write-behind</span></strong> → application writes to cache <strong><span style="border-bottom:0.05em solid">asynchronously</span></strong>.<ul id="117e0021-eb2d-803f-b115-cae8ad05b5b1" class="bulleted-list"><li style="list-style-type:circle">We put data in a queue, which writes data back to DB and improves latency of write application. <strong><span style="border-bottom:0.05em solid">This can be a quick fix for slow writes.</span></strong></li></ul></li></ul><h3 id="117e0021-eb2d-8086-83bc-e710a2b1d5a8" class="">Disadvantages for both patterns → Cache overloading</h3><ul id="117e0021-eb2d-8001-8771-c879d79ebe09" class="bulleted-list"><li style="list-style-type:disc">For both patterns, we are writing data to the cache, which might not even be read.</li></ul><ul id="117e0021-eb2d-80f1-a0b5-f060eff3df83" class="bulleted-list"><li style="list-style-type:disc">This can cause cache overloading ( or cache memory overloading) with expensive calls that might not even be required.</li></ul><ul id="117e0021-eb2d-8068-8220-fbdc1a9718a5" class="bulleted-list"><li style="list-style-type:disc">Examples →<ul id="117e0021-eb2d-8013-837f-cb5daa78e7db" class="bulleted-list"><li style="list-style-type:circle">There are some accounts on Twitter that are not followed by many people. If we put every tweet in the cache from these unpopular accounts, it will take up expensive memory. Also, if the database goes down before the data is written to the database, this causes inconsistency.</li></ul></li></ul><h2 id="117e0021-eb2d-80d7-a271-ffd063d40387" class="">Using caching on the client side</h2><ul id="117e0021-eb2d-80ba-82c8-dab10c891903" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Caching can happen anywhere—it can be for database queries, expensive computations, or to save network costs.</span></strong></li></ul><ul id="117e0021-eb2d-8005-8f65-c0ba999019eb" class="bulleted-list"><li style="list-style-type:disc">Caching is also very popular on <strong><span style="border-bottom:0.05em solid">the client side</span></strong>.</li></ul><ul id="117e0021-eb2d-80f6-8a87-d862e4afc7fe" class="bulleted-list"><li style="list-style-type:disc">Example →<ul id="117e0021-eb2d-8087-b522-e581686f8c53" class="bulleted-list"><li style="list-style-type:circle">Netflix browser or mobile app. Some recommended movies will remain recommended over a period of time. </li></ul><ul id="117e0021-eb2d-80a6-b19c-c173d1bed2bc" class="bulleted-list"><li style="list-style-type:circle">For these movies, it makes sense to cache the thumbnails of these movies in the device or browser. </li></ul><ul id="117e0021-eb2d-8052-aecf-d6e87d893263" class="bulleted-list"><li style="list-style-type:circle">That way when the user visits Netflix again, these thumbnails will be quickly served from the cache (or local memory) instead of fetching it from the network.</li></ul></li></ul><h2 id="117e0021-eb2d-8058-8af0-e024b3e7abff" class="">Cache Invalidation</h2><ul id="117e0021-eb2d-80a7-a0d8-ee2d68752332" class="bulleted-list"><li style="list-style-type:disc">Problem → data can becomes stale if there are a lot of DB updates.</li></ul><ul id="117e0021-eb2d-808d-a090-f57d4ac9a22b" class="bulleted-list"><li style="list-style-type:disc">Therefore, it is important to expire or invalidate data from the cache, so your data does not get stale.</li></ul><ul id="117e0021-eb2d-80df-8caf-e9f4a4ae38e0" class="bulleted-list"><li style="list-style-type:disc">LRU → Cache Replacement Algorithm<ul id="117e0021-eb2d-8040-928b-dfb919850bc3" class="bulleted-list"><li style="list-style-type:circle">The Least Recently Used (LRU) Cache <strong>operates on the principle that the data most recently accessed is likely to be accessed again in the near future</strong>.<strong> By evicting the least recently accessed items first, LRU Cache ensures that the most relevant data remains available in the cache.</strong></li></ul></li></ul><ul id="117e0021-eb2d-8018-8a06-e3f759b6385a" class="bulleted-list"><li style="list-style-type:disc">Example →<ul id="117e0021-eb2d-805e-8577-cbff455be21c" class="bulleted-list"><li style="list-style-type:circle">Let’s say you have some memory that can only store 4 items, and you want to cache these items in the memory. The first item you have is “A” and you cache it at timestamp “1”, the next item is “B” and you cache it at timestamp “2”, the next item is “C” and you cache it at timestamp “3”.</li></ul><figure id="117e0021-eb2d-80e5-9c27-e4cc1ccc2851" class="image"><a href="https://interviewing.io/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Flru-1.2f2f247b.png&amp;w=3840&amp;q=75"><img style="width:700px" src="https://interviewing.io/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Flru-1.2f2f247b.png&amp;w=3840&amp;q=75"/></a></figure><ul id="117e0021-eb2d-80e9-86bf-f0786b922040" class="bulleted-list"><li style="list-style-type:circle">If the next item is “B” again, you’ll have to update the timestamp for “B”: it’s now “4” instead of “2”.</li></ul><figure id="117e0021-eb2d-8004-8fb7-dcfedddecb55" class="image"><a href="https://interviewing.io/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Flru-2.14c80db0.png&amp;w=3840&amp;q=75"><img style="width:700px" src="https://interviewing.io/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Flru-2.14c80db0.png&amp;w=3840&amp;q=75"/></a></figure><ul id="117e0021-eb2d-8040-b6ff-cefaee0251b2" class="bulleted-list"><li style="list-style-type:circle">If the next item is “D”, then the timestamp for “D” would be “5”.</li></ul><figure id="117e0021-eb2d-8046-8a0e-f354915f0c94" class="image"><a href="https://interviewing.io/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Flru-3.6abc7597.png&amp;w=3840&amp;q=75"><img style="width:700px" src="https://interviewing.io/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Flru-3.6abc7597.png&amp;w=3840&amp;q=75"/></a></figure><ul id="117e0021-eb2d-80aa-9298-e57fe768d23c" class="bulleted-list"><li style="list-style-type:circle">If the next item is “E” (with a timestamp of 6), then we have to make some room in our memory! </li></ul><ul id="117e0021-eb2d-80da-a113-c724d6170588" class="bulleted-list"><li style="list-style-type:circle">We get rid of “A”, because it was the lowest timestamp of “1”. So we replace “A” with “E”, and with “E” comes the new timestamp of 6.</li></ul><figure id="117e0021-eb2d-8048-b67c-d485070a948f" class="image"><a href="https://interviewing.io/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Flru-4.3e4203f5.png&amp;w=3840&amp;q=75"><img style="width:700px" src="https://interviewing.io/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Flru-4.3e4203f5.png&amp;w=3840&amp;q=75"/></a></figure><ul id="117e0021-eb2d-80bf-ae48-c2a4b3a0a345" class="bulleted-list"><li style="list-style-type:circle">What if the 7th item is C? We don’t need to replace “C” with “C”, we simply need to update the timestamp for “C” to “7” because the latest value when “C” was accessed was 7.</li></ul><figure id="117e0021-eb2d-809f-989e-fe7092f2aca0" class="image"><a href="https://interviewing.io/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Flru-5.f58f8082.png&amp;w=3840&amp;q=75"><img style="width:700px" src="https://interviewing.io/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Flru-5.f58f8082.png&amp;w=3840&amp;q=75"/></a></figure><ul id="117e0021-eb2d-8016-a455-f0b808e53dbd" class="bulleted-list"><li style="list-style-type:circle">What if the 8th item is “F”? Who do we get rid of now? That’s right, “B”! Because unfortunately for “B” they are the least recently used; their timestamp of 2 is currently the oldest one on the board. </li></ul><ul id="117e0021-eb2d-8068-aa48-ced582b52653" class="bulleted-list"><li style="list-style-type:circle">So we replace “B” with “F” and with “F” comes the timestamp “8”. And this pattern would continue as we bring new items into this memory store.</li></ul><p id="117e0021-eb2d-8078-bc09-d79e184ac692" class="">
</p><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="117e0021-eb2d-80db-80b8-cdb85c028f2b"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><h2 id="117e0021-eb2d-80af-8bd8-d049f9f38258" class="">Remember</h2><p id="117e0021-eb2d-8004-9e20-c768e275cf03" class="">For most systems 20% of the data accounts for 80% of the reads. <strong><span style="border-bottom:0.05em solid">So using LRU will result in fewer cache misses. Because of the 80/20 rule, we want to give special treatment to the most popular data!</span></strong> That’s why we use LRU. As a result, we can throw stuff in the cache (and not miss), which reduces latency for 80% of your requests.</p></div></figure><h2 id="117e0021-eb2d-80f8-87f0-df885a8cdd0e" class="">Considerations for using Cache</h2><ul id="117e0021-eb2d-80dc-8c8b-d64f8cfa8741" class="bulleted-list"><li style="list-style-type:circle"><strong>When to use Cache ?</strong><ul id="117e0021-eb2d-80f6-bb2e-c365754c2cec" class="bulleted-list"><li style="list-style-type:square">When data is read frequently but modified infrequently.</li></ul><ul id="117e0021-eb2d-8097-a654-eecfbeb77431" class="bulleted-list"><li style="list-style-type:square">Since cached data is stored in volatile memory, a cache server is not ideal for persisting data.</li></ul><ul id="117e0021-eb2d-8012-ada5-ccc58f8af1ca" class="bulleted-list"><li style="list-style-type:square">For example → if cache server restarts, all the data in memory is lost. Thus, important data should be saved in persistent data stores.</li></ul></li></ul><ul id="117e0021-eb2d-8068-9487-d312fc9c8155" class="bulleted-list"><li style="list-style-type:circle"><strong>Expiration Policy →</strong><ul id="117e0021-eb2d-80fc-9317-c14b8ab92195" class="bulleted-list"><li style="list-style-type:square">Once cached data is expired, it is removed from cache.</li></ul><ul id="117e0021-eb2d-8049-b6fb-e160c8af7133" class="bulleted-list"><li style="list-style-type:square">When there is no expiration policy, cached data will be stored in the memory permanently.</li></ul><ul id="117e0021-eb2d-80f8-996d-c74e741acd52" class="bulleted-list"><li style="list-style-type:square">If expiration duration is too short → cause system to reload data from the database too frequently.</li></ul><ul id="117e0021-eb2d-80b9-b287-dca8d5da50af" class="bulleted-list"><li style="list-style-type:square">If expiration duration is too long → cached data can become stale.</li></ul></li></ul><ul id="117e0021-eb2d-80ba-b09a-f0733afbc197" class="bulleted-list"><li style="list-style-type:circle"><strong>Consistency →</strong><ul id="117e0021-eb2d-803b-b5d5-fef506136dcd" class="bulleted-list"><li style="list-style-type:square">Keeping data store and cache in sync.</li></ul><ul id="117e0021-eb2d-8022-a71b-f998989beca0" class="bulleted-list"><li style="list-style-type:square">Inconsistency can happen because data modifying operations on the data store and cache are not in a single transaction.</li></ul></li></ul><ul id="117e0021-eb2d-80c5-b7c6-cbd532aa10d9" class="bulleted-list"><li style="list-style-type:circle"><strong>Mitigating Failures →</strong><ul id="117e0021-eb2d-805f-aa6a-c06c1b732671" class="bulleted-list"><li style="list-style-type:square">A single cache server represents a potential <em>single point of failure (SPOF)</em>, because if it fails it will stop the entire system from working.</li></ul><ul id="117e0021-eb2d-80f5-b568-ecf5de1ca8ea" class="bulleted-list"><li style="list-style-type:square">Recommendations → <ul id="117e0021-eb2d-80ef-8d64-ccdb52b95d24" class="bulleted-list"><li style="list-style-type:disc">Multiple cache servers across different data centres.</li></ul><ul id="117e0021-eb2d-80f2-9457-f7dafdce25d0" class="bulleted-list"><li style="list-style-type:disc">Over-provision required memory by certain percentages, this provides a buffer as the memory usage increases.</li></ul></li></ul></li></ul><ul id="117e0021-eb2d-80a6-924f-c44a59d095d3" class="bulleted-list"><li style="list-style-type:circle"><strong>Eviction Policy →</strong><ul id="117e0021-eb2d-80b8-add6-c34950ff9cbd" class="bulleted-list"><li style="list-style-type:square">Once cache is full, any request to add items to the cache might cause existing items to be removed → <em>Cache Eviction</em></li></ul><ul id="117e0021-eb2d-802e-8709-c5c3575fe2c4" class="bulleted-list"><li style="list-style-type:square">Most popular cache eviction policy → <em>LRU</em> <ul id="117e0021-eb2d-8015-bcb3-dd5ca2171380" class="bulleted-list"><li style="list-style-type:disc">Others include LFU ( Least Frequently Used) or FIFO (First In First Out)</li></ul></li></ul></li></ul></li></ul></div></details><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">Content Delivery Network (CDN)</summary><div class="indented"><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="117e0021-eb2d-8003-b89d-d5ce734f5f7f"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="117e0021-eb2d-80cf-b2ce-f1b0dce4bce5" class="">A network of <strong><span style="border-bottom:0.05em solid">geographically dispersed servers used to deliver STATIC content</span></strong>. CDN servers cache static content like images, videos, CSS, javascript files, etc </p></div></figure><p id="117e0021-eb2d-8046-a890-e2622d7e37e4" class="">Dynamic Content Caching → Enables caching of HTML pages that are based on request path, query strings, cookies and request headers.</p><h2 id="117e0021-eb2d-8024-b50c-fbc7f24aa86b" class="">High Level CDN Mechanism </h2><ul id="117e0021-eb2d-8013-9edd-fd86222bf135" class="bulleted-list"><li style="list-style-type:disc">When a user visits a website, a CDN server closest to the user will deliver static content.</li></ul><ul id="117e0021-eb2d-8095-9651-f3af2191ee6a" class="bulleted-list"><li style="list-style-type:disc">Intuitively, the further users are from CDN server, the slower the website loads.</li></ul><ul id="117e0021-eb2d-8017-b869-cc8b5c243b0c" class="bulleted-list"><li style="list-style-type:disc">Example → if CDN servers are in San Francisco, users in LA will get content faster than users in Europe.</li></ul><figure id="117e0021-eb2d-8014-99a2-de7274f2cece" class="image" style="text-align:center"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/01416fe9-d28b-4b78-bdc5-bb531d8e42c3.png"><img style="width:528px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/01416fe9-d28b-4b78-bdc5-bb531d8e42c3.png"/></a></figure><h3 id="117e0021-eb2d-8017-a5b7-c18245d4873c" class="">Workflow → Read-through cache pattern</h3><figure id="117e0021-eb2d-80fc-b2a9-fccf9ed0d1ab" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2018.png"><img style="width:679.96875px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2018.png"/></a></figure><ol type="1" id="117e0021-eb2d-80e5-8629-d34cb09296de" class="numbered-list" start="1"><li>User A tried to get image by using an image URL. The URL’s domain is provided by the CDN provided, example following samples demonstrate what image URL looks like on Amazon and Akamai CDN -<blockquote id="117e0021-eb2d-8028-a85c-de6583e80348" class="">https://mysite.cloudfront.net/logo.jpg</blockquote><blockquote id="117e0021-eb2d-80b7-bbd4-e10e5841441a" class="">https://mysite.akamai.com/image-manager/img/logo.jpg</blockquote></li></ol><ol type="1" id="117e0021-eb2d-8061-8df4-c5574ac248a2" class="numbered-list" start="2"><li>If CDN server does not have image in the cache, CDN server requests the file from origin, which can be a web server or online storage like Amazon S3.</li></ol><ol type="1" id="117e0021-eb2d-800c-b62c-f4c320abd99f" class="numbered-list" start="3"><li>The origin returns the image to CDN server, which includes optional HTTP header TTL (Time To Live) (how long the image is cached).</li></ol><ol type="1" id="117e0021-eb2d-80c4-82df-c3da437bca4b" class="numbered-list" start="4"><li>CDN caches the images and returns it to User A. Image remains caches in CDN until TTL expires.</li></ol><ol type="1" id="117e0021-eb2d-8031-a9cb-c131d072c906" class="numbered-list" start="5"><li>User B sends request to get same image, which is returned from the CDN caches as long as TTL has not expired.</li></ol><h2 id="117e0021-eb2d-8036-a4b6-e4357a41d76e" class="">Design after adding CDN and Cache</h2><figure id="117e0021-eb2d-80f8-83c1-e3dcd62c25ed" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2019.png"><img style="width:679.984375px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2019.png"/></a></figure><ul id="117e0021-eb2d-8083-8ac6-c15ca7cae86a" class="bulleted-list"><li style="list-style-type:disc">Static assets (JS, CSS, images, etc.,) are no longer served by web servers. They are<br/>fetched from the CDN for better performance.<br/></li></ul><ul id="117e0021-eb2d-8057-8223-d08355de06cc" class="bulleted-list"><li style="list-style-type:disc">The database load is lightened by caching data.</li></ul><h2 id="117e0021-eb2d-8015-99b5-edbc60e94e01" class="">Considerations of using CDN</h2><ul id="117e0021-eb2d-8044-9f9d-d6235628debb" class="bulleted-list"><li style="list-style-type:disc"><strong>Cost →</strong><ul id="117e0021-eb2d-8000-990f-d97ee154503a" class="bulleted-list"><li style="list-style-type:circle">CDNs are run by third party providers, and you are charged for data transfers in and out of CDN.</li></ul><ul id="117e0021-eb2d-8050-8175-ef04126615cc" class="bulleted-list"><li style="list-style-type:circle">Caching infrequently used assets provides no significant benefits so one should consider moving them out of CDN.</li></ul></li></ul><ul id="117e0021-eb2d-801d-ad5a-d3d240de75e4" class="bulleted-list"><li style="list-style-type:disc"><strong>Setting an appropriate cache expiry →</strong><ul id="117e0021-eb2d-800f-a516-c6cd8f4730f9" class="bulleted-list"><li style="list-style-type:circle">For time-sensitive content, setting a cache expiry time is important.</li></ul><ul id="117e0021-eb2d-80a8-b1e8-d9cdf7bccf30" class="bulleted-list"><li style="list-style-type:circle">Should neither be too long nor too short.</li></ul><ul id="117e0021-eb2d-80db-a195-efc06f8a05c4" class="bulleted-list"><li style="list-style-type:circle">Too long → Content might no longer be fresh.</li></ul><ul id="117e0021-eb2d-80a2-b47d-c4883cad6f10" class="bulleted-list"><li style="list-style-type:circle">Too short → Cause repeat reloading of content from origin servers to the CDN.</li></ul></li></ul><ul id="117e0021-eb2d-8018-942f-f560e5cbb993" class="bulleted-list"><li style="list-style-type:disc"><strong>CDN Fallback →</strong><ul id="117e0021-eb2d-80c7-93ce-e4a3d88280c6" class="bulleted-list"><li style="list-style-type:circle">One should consider how the application copes with CDN failure.</li></ul><ul id="117e0021-eb2d-802e-b584-ecfca0275018" class="bulleted-list"><li style="list-style-type:circle">If there is a temporary CDN outage, clients should be able to detect the problem and request resources from the origin.</li></ul></li></ul><ul id="117e0021-eb2d-801f-95e1-f32001ec91ae" class="bulleted-list"><li style="list-style-type:disc"><strong>Invalidating files →</strong><ul id="117e0021-eb2d-803b-9aaf-f27ed5a7e497" class="bulleted-list"><li style="list-style-type:circle">You can remove a file from the CDN before it expires by performing<br/>one of the following operations:<br/><ul id="117e0021-eb2d-80d4-8ba1-ff36a7352853" class="bulleted-list"><li style="list-style-type:square">Invalidate the CDN object using APIs provided by CDN vendors.</li></ul><ul id="117e0021-eb2d-8060-bcd3-d9e0ee5c7f57" class="bulleted-list"><li style="list-style-type:square">Use object versioning to serve a different version of the object. To version an object, you can add a parameter to the URL, such as a version number. For example, version number 2 is added to the query string: image.png?v=2.</li></ul></li></ul></li></ul></div></details><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">Stateless Web Tier</summary><div class="indented"><ul id="118e0021-eb2d-800b-ac8d-c17d210bcd6f" class="bulleted-list"><li style="list-style-type:disc">Move state (user session data) out of the web tier, to scale the web tier horizontally.</li></ul><ul id="118e0021-eb2d-803d-966e-fe138ecdda78" class="bulleted-list"><li style="list-style-type:disc">Good practise is <strong><span style="border-bottom:0.05em solid">to store session data in the persistent storage</span></strong> such as relational database or NoSQL.</li></ul><ul id="118e0021-eb2d-80a9-a6fa-ea3982c3810c" class="bulleted-list"><li style="list-style-type:disc">Each web server in the cluster can access state data from databases.</li></ul><h2 id="118e0021-eb2d-80a7-8882-cd6ae65124e3" class="">Stateful architecture</h2><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="118e0021-eb2d-807e-a8be-c4bb504e9f4d"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="118e0021-eb2d-802a-8772-fa544d065000" class=""><strong>Remembers client data (state) from one request to the next.</strong></p></div></figure><ul id="118e0021-eb2d-80f6-a29d-ccdbd550dd05" class="bulleted-list"><li style="list-style-type:disc">The issue is that every request from the same client must be routed to the same server. </li></ul><ul id="118e0021-eb2d-8014-b6d0-c5776b7c2221" class="bulleted-list"><li style="list-style-type:disc">This can be done with sticky sessions in most load balancers; however, this adds the<br/>overhead. <br/></li></ul><ul id="118e0021-eb2d-8011-8c06-d1f8fb8b4252" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Adding or removing servers is much more difficult with this approach. It is also<br/>challenging to handle server failures.<br/></span></strong></li></ul><h2 id="118e0021-eb2d-80ab-bd92-c7e0fb604a2a" class="">Stateless architecture</h2><div id="118e0021-eb2d-805d-93f7-dde37d453326" class="column-list"><div id="118e0021-eb2d-80fe-9900-f08ebb1d6a10" style="width:100%" class="column"><ul id="118e0021-eb2d-8030-a2bc-d9b8bbe76a67" class="bulleted-list"><li style="list-style-type:disc">HTTP requests from users can be sent to any web servers, which fetch state data from a shared data store. </li></ul><ul id="118e0021-eb2d-80f1-8993-c2b7e4252918" class="bulleted-list"><li style="list-style-type:disc">State data is stored in a shared data store and kept out of web servers. </li></ul><ul id="118e0021-eb2d-806b-a9fb-cbdbe456b3a7" class="bulleted-list"><li style="list-style-type:disc">A stateless system is simpler, more robust, and scalable.</li></ul></div><div id="118e0021-eb2d-8062-84ed-e0bd8be53bcd" style="width:100%" class="column"><figure id="118e0021-eb2d-80f8-9aac-f0652d7115be" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2020.png"><img style="width:679.984375px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2020.png"/></a></figure></div></div><h2 id="118e0021-eb2d-8042-9878-de85f1ba256a" class="">Design with Stateless Web Tier</h2><figure id="118e0021-eb2d-805a-aa22-cd848c0e0231" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2021.png"><img style="width:679.984375px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2021.png"/></a></figure><ul id="118e0021-eb2d-8094-a2d1-f60fdeae6c80" class="bulleted-list"><li style="list-style-type:disc">We move the session data out of the web tier and store them in the persistent<br/>data store. <br/></li></ul><ul id="118e0021-eb2d-806c-b2ff-e4a810803afb" class="bulleted-list"><li style="list-style-type:disc">The shared data store could be a relational database, Memcached/Redis, NoSQL,<br/>etc. <br/><strong><span style="border-bottom:0.05em solid">The NoSQL data store is chosen as it is easy to scale</span></strong>. <ul id="118e0021-eb2d-8012-b3d2-de94da3e0300" class="bulleted-list"><li style="list-style-type:circle">Autoscaling means adding or removing web servers automatically based on the traffic load. </li></ul></li></ul><ul id="118e0021-eb2d-80ce-b1f9-d74a207d8789" class="bulleted-list"><li style="list-style-type:disc">After the state data is removed out of web servers, auto-scaling of the web tier is easily achieved by adding or removing servers based on traffic load. </li></ul><ul id="118e0021-eb2d-8062-bec3-d1d551fae107" class="bulleted-list"><li style="list-style-type:disc">To <strong><span style="border-bottom:0.05em solid">improve availability and provide a better user experience across wider geographical areas, supporting multiple data centres is crucial</span></strong>.</li></ul></div></details><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">Data Centres</summary><div class="indented"><div id="118e0021-eb2d-80ce-bed6-dc2fe285f9e8" class="column-list"><div id="118e0021-eb2d-80ec-b505-e848bcef9700" style="width:56.25%" class="column"><ul id="118e0021-eb2d-80ce-bd3a-dced4856adea" class="bulleted-list"><li style="list-style-type:disc">In normal operation, users are<br/>geoDNS-routed, also known as <br/><strong><span style="border-bottom:0.05em solid">geo-routed, to the closest data centre</span></strong>, with a split traffic of x% in US-East and (100 – x)% in US-West. </li></ul><ul id="118e0021-eb2d-8016-b28c-d8605584eda5" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">geoDNS is a DNS service that allows domain names to be resolved to IP addresses based on the location of a user.</span></strong></li></ul><p id="118e0021-eb2d-8059-96dc-fdabb1b2b34b" class="">
</p></div><div id="118e0021-eb2d-800f-aefe-dc8767111b88" style="width:87.5%" class="column"><figure id="118e0021-eb2d-804a-bbe3-fd445c97bbbf" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2022.png"><img style="width:528px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2022.png"/></a></figure></div></div><div id="118e0021-eb2d-802d-9ced-fc26c54a2565" class="column-list"><div id="118e0021-eb2d-80c8-a56e-dc86b515e4fe" style="width:56.25%" class="column"><ul id="118e0021-eb2d-80c9-9ba6-ea2128662624" class="bulleted-list"><li style="list-style-type:disc">In the event of any significant data centre outage, all traffic will be directed to the healthy data centre.</li></ul><p id="118e0021-eb2d-80d8-9c52-c1084b82a42a" class="">
</p></div><div id="118e0021-eb2d-80f8-ad04-ddc6662cd4d1" style="width:125%" class="column"><figure id="118e0021-eb2d-809e-a367-f31baa1f9c17" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2023.png"><img style="width:349.765625px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2023.png"/></a></figure></div></div><h3 id="118e0021-eb2d-808c-bff1-f42454ea7347" class="">Technical challenges to resolve to achieve multi-data centre setup</h3><ul id="118e0021-eb2d-80b4-be07-dbb68613730e" class="bulleted-list"><li style="list-style-type:disc"><strong>Traffic Redirection →</strong><ul id="118e0021-eb2d-8071-878d-f4d16cf0fd95" class="bulleted-list"><li style="list-style-type:circle">Effective tools are needed to direct traffic to the correct data centre.</li></ul><ul id="118e0021-eb2d-80ff-a003-f021db11252e" class="bulleted-list"><li style="list-style-type:circle">GeoDNS can be used to direct traffic to the nearest data centre depending on where a user is located.</li></ul></li></ul><ul id="118e0021-eb2d-8050-bf12-d14693ac6a39" class="bulleted-list"><li style="list-style-type:disc"><strong>Data synchronization →</strong><ul id="118e0021-eb2d-803d-b10e-f61428ee3129" class="bulleted-list"><li style="list-style-type:circle">Users from different regions could use different local databases or caches. </li></ul><ul id="118e0021-eb2d-80c4-8499-f035eacba5ee" class="bulleted-list"><li style="list-style-type:circle">In failover cases, traffic might be routed to a data centre where data is unavailable.</li></ul><ul id="118e0021-eb2d-8059-994d-db96adb6d16b" class="bulleted-list"><li style="list-style-type:circle">A common strategy is to replicate data across multiple data centre. Example of how Netflix implements asynchronous multi-data centre replication .</li></ul></li></ul><ul id="118e0021-eb2d-8096-9a41-ed9e83d5b6cf" class="bulleted-list"><li style="list-style-type:disc"><strong>Test and deployment → </strong><ul id="118e0021-eb2d-801f-ac5d-fded925d4467" class="bulleted-list"><li style="list-style-type:circle">With multi-data centre setup, it is important to test your website/application at different locations. </li></ul><ul id="118e0021-eb2d-80ea-b617-e175219695fc" class="bulleted-list"><li style="list-style-type:circle">Automated deployment tools are vital to keep services consistent through all the data centre.</li></ul></li></ul></div></details><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">Message Queues</summary><div class="indented"><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="118e0021-eb2d-8007-810a-e11193bd69e7"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="118e0021-eb2d-80e9-bdf0-c4e4226091e4" class=""><strong><span style="border-bottom:0.05em solid">Used to decouple different components of system so they can be scaled independently.</span></strong></p></div></figure><h2 id="117e0021-eb2d-80e5-a38f-ef27cdbdbc85" class="">Asynchronous Systems and Message Queues</h2><ul id="117e0021-eb2d-80d0-a964-d566059609a0" class="bulleted-list"><li style="list-style-type:disc">One where <strong><span style="border-bottom:0.05em solid">client sends the request and does not wait</span></strong> for the message to be delivered.</li></ul><ul id="117e0021-eb2d-8021-8948-f89f37e5da48" class="bulleted-list"><li style="list-style-type:disc">For the client, sending the message is like any other function or an API call, but in contrast to the APIs, <strong><span style="border-bottom:0.05em solid">the clients do not expect a response</span></strong>. Such functions or API calls are aka “<em><strong><span style="border-bottom:0.05em solid">fire and forget</span></strong></em>” calls.</li></ul><ul id="117e0021-eb2d-80ac-b50b-ea58d5443d5f" class="bulleted-list"><li style="list-style-type:disc"><strong>The client’s message is not immediately sent over to the processing system but instead send to an intermediary which is the </strong><em><strong><span style="border-bottom:0.05em solid">message queue or the broker</span></strong></em>.</li></ul><h2 id="117e0021-eb2d-8024-99c9-e38867a8368e" class="">Few things to understand about Message Queues</h2><ul id="117e0021-eb2d-8066-851e-c1865cc1d837" class="bulleted-list"><li style="list-style-type:disc"><strong>Message</strong> → The data that flows through an asynchronous system. </li></ul><ul id="117e0021-eb2d-802c-82b6-ee02f16ca1e0" class="bulleted-list"><li style="list-style-type:disc"><strong>Producers</strong> → Systems that produce the messages</li></ul><ul id="117e0021-eb2d-8091-a991-d309395577b4" class="bulleted-list"><li style="list-style-type:disc"><strong>Consumers</strong> → Systems that process those messages.</li></ul><ul id="117e0021-eb2d-802c-b482-c28d24c615c9" class="bulleted-list"><li style="list-style-type:disc"><strong>Message Queue or topic</strong> → link between the producers and the consumers.</li></ul><ul id="117e0021-eb2d-80af-9341-cdc768a12acd" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Producers publish the messages to named queue and the queue delivers these messages to the consumer of the queue</span></strong>.</li></ul><h2 id="117e0021-eb2d-80ad-9964-e45889a1ca7c" class="">Advantages</h2><ol type="1" id="117e0021-eb2d-805a-88db-e6414cf2a3a2" class="numbered-list" start="1"><li><strong><span style="border-bottom:0.05em solid">A queue stores messages that need to be stored in a database</span></strong>. <ol type="a" id="117e0021-eb2d-80c8-be5d-d66b77d4310d" class="numbered-list" start="1"><li>This is used if there&#x27;s the possibility that traffic will spike, causing the CPU of the database to go up like crazy and kill the server. </li></ol><ol type="a" id="117e0021-eb2d-80e5-b3f5-db50f4223402" class="numbered-list" start="2"><li>That would cause the database to be down and probably lose data. Instead… throw it in the queue!</li></ol></li></ol><ol type="1" id="117e0021-eb2d-8099-8564-d8c254a43d44" class="numbered-list" start="2"><li>If a <strong><span style="border-bottom:0.05em solid">message has to be processed by some very expensive code, you may also hold them in a queue while previous messages are being processed</span></strong> so you don&#x27;t overload (and potentially kill) servers.</li></ol><ol type="1" id="117e0021-eb2d-80b1-bd4f-faa1dd27484f" class="numbered-list" start="3"><li>Queues can <strong><span style="border-bottom:0.05em solid">deliver messages to multiple systems</span></strong>, instead of the client having to send them to all the required systems.</li></ol><ol type="1" id="117e0021-eb2d-80b0-a9e1-c86485985bfd" class="numbered-list" start="4"><li>Queues <strong><span style="border-bottom:0.05em solid">decouple the client from the server</span></strong> by eliminating the need to know the server address.</li></ol><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="117e0021-eb2d-80c4-9ca9-d2d5f11afb07"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><h2 id="117e0021-eb2d-80b5-bb45-c70eeb4af1a0" class="">Remember</h2><ul id="117e0021-eb2d-80ab-a857-d79639f7376b" class="bulleted-list"><li style="list-style-type:disc">There can be <strong>different message queues for different needs</strong> and consumers subscribe to them based on their requirements. </li></ul><ul id="117e0021-eb2d-80b0-b512-c801f89d0353" class="bulleted-list"><li style="list-style-type:disc">Alternatively, there can be a single message queue delivering all messages to all the consumers and filtering out the messages that they can process. </li></ul><ul id="117e0021-eb2d-8053-8b1f-d9e1d6a2bdcc" class="bulleted-list"><li style="list-style-type:disc">Or a single message queue can be smart enough to selectively deliver messages to the appropriate subscribers.</li></ul></div></figure><p id="117e0021-eb2d-8093-b49e-e9c2c89f588a" class="">Based on the different implementations of message queues, there can be different combinations of the following properties:</p><ul id="117e0021-eb2d-80b3-aa74-ee36e4b3abb1" class="bulleted-list"><li style="list-style-type:disc"><strong>Guaranteed Delivery →</strong><ul id="117e0021-eb2d-80a8-bbc1-e93e530d2fde" class="bulleted-list"><li style="list-style-type:circle">Delivery guarantees define <strong><span style="border-bottom:0.05em solid">how strongly a messaging system enforces the delivery of messages it processes.</span></strong></li></ul><ul id="117e0021-eb2d-809b-a5e0-cd0f9b2765e8" class="bulleted-list"><li style="list-style-type:circle">As you make stronger guarantees about message delivery, <strong>the system needs to perform more checks and acknowledgments to ensure that messages are delivered, or maintain state to ensure a message is only delivered the specified number of times</strong>. </li></ul><ul id="117e0021-eb2d-808d-a68d-ce3379f8bb8b" class="bulleted-list"><li style="list-style-type:circle">This increases the latency of the system and reduces the overall throughput of the system. </li></ul><ul id="117e0021-eb2d-800f-8405-fc96f2b7d2d5" class="bulleted-list"><li style="list-style-type:circle">Each message may require an additional internal acknowledgements, and an equivalent number of additional roundtrips, before it can be considered delivered.<ul id="117e0021-eb2d-80e4-b5c6-da17883312bb" class="bulleted-list"><li style="list-style-type:square"><strong>Queues provides </strong><em><strong><span style="border-bottom:0.05em solid">at least once</span></strong></em><strong><span style="border-bottom:0.05em solid"> delivery by default</span></strong> in order to optimize for reliability.</li></ul><ul id="117e0021-eb2d-80b8-a2ec-e692afd9fa5b" class="bulleted-list"><li style="list-style-type:square">This means that <strong><span style="border-bottom:0.05em solid">messages are guaranteed to be delivered at least once</span></strong>, and in rare occasions, may be delivered more than once.</li></ul><ul id="117e0021-eb2d-8000-b37a-e70ac7f172f2" class="bulleted-list"><li style="list-style-type:square">For the majority of applications, this is the right balance between not losing any messages and minimizing end-to-end latency, as exactly once delivery incurs additional overheads in any messaging system.</li></ul></li></ul><ul id="117e0021-eb2d-805e-a032-d91c928d8af1" class="bulleted-list"><li style="list-style-type:circle">In cases where processing the same message more than once would introduce unintended behaviour, <span style="border-bottom:0.05em solid">generating a unique ID when writing the message to the queue</span> and <span style="border-bottom:0.05em solid">using that as the primary key on database inserts and/or as an </span><em><span style="border-bottom:0.05em solid">idempotency</span></em><span style="border-bottom:0.05em solid"> key to de-duplicate the message after processing</span>. </li></ul><ul id="117e0021-eb2d-8051-89ac-c194009ddc4b" class="bulleted-list"><li style="list-style-type:circle">For example, using this idempotency key as the ID in an upstream email API or payment API will allow those services to reject the duplicate on your behalf, without you having to carry additional state in your application.</li></ul></li></ul><ul id="117e0021-eb2d-8000-b3f9-e6b914f9b214" class="bulleted-list"><li style="list-style-type:disc"><strong>No Duplicate Messages Are Delivered →</strong><ul id="117e0021-eb2d-80ad-88dc-cda7259b3379" class="bulleted-list"><li style="list-style-type:circle">The system makes sure that a message is delivered exactly once to the recipient. </li></ul><ul id="117e0021-eb2d-8044-9077-d800ea9b4d7f" class="bulleted-list"><li style="list-style-type:circle">Even if a message is reprocessed or retried due to an error, it won’t be sent multiple times.</li></ul></li></ul><ul id="117e0021-eb2d-800e-9b29-d6fd9cd02ca8" class="bulleted-list"><li style="list-style-type:disc"><strong>Ensure That the Order of Messages Is Maintained →</strong><ul id="117e0021-eb2d-802e-9e52-c0dfd34ac996" class="bulleted-list"><li style="list-style-type:circle">Messages are delivered in the exact order they were sent. </li></ul><ul id="117e0021-eb2d-8082-b7c5-ccaea7273222" class="bulleted-list"><li style="list-style-type:circle">If you send three messages (A, B, C), they will be received in the same sequence (A, B, C) by the consumer.</li></ul></li></ul><ul id="117e0021-eb2d-80ef-aa6e-d5523b5e4667" class="bulleted-list"><li style="list-style-type:disc"><strong>At Least Once Delivery with Idempotent Consumers →</strong><ul id="117e0021-eb2d-80ee-ac2b-fd3b44e8d375" class="bulleted-list"><li style="list-style-type:circle">The message queue <strong><span style="border-bottom:0.05em solid">will deliver messages at least one time</span></strong>, meaning there&#x27;s a chance it might deliver them more than once in rare cases. </li></ul><ul id="117e0021-eb2d-8076-9114-f6a78071952c" class="bulleted-list"><li style="list-style-type:circle">To handle this, consumers (the systems processing the messages) need to be <strong>idempotent</strong>—they should be able to process a message multiple times without causing issues. </li></ul><ul id="117e0021-eb2d-8088-a0d3-f21bbaf321e4" class="bulleted-list"><li style="list-style-type:circle">For example, if a message to &quot;send email&quot; is received twice, only one email should actually be sent.</li></ul><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="117e0021-eb2d-80cf-aed0-e85248832557"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><h3 id="117e0021-eb2d-803c-bd76-fac54b66c862" class="">Idempotency</h3><ul id="117e0021-eb2d-807b-ac6b-ed7b18340101" class="bulleted-list"><li style="list-style-type:disc">What happens if the SAME event was to trigger again ?</li></ul><ul id="117e0021-eb2d-80ef-9da9-f248e012b43e" class="bulleted-list"><li style="list-style-type:disc">Given the same input we get the same output.</li></ul></div></figure><figure id="117e0021-eb2d-80ca-9b78-c844efcff4d8" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2024.png"><img style="width:651.984375px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2024.png"/></a></figure></li></ul><h2 id="118e0021-eb2d-802c-9eb0-c1a12a019c2b" class="">Example</h2><figure id="118e0021-eb2d-80ba-ac72-d6d2c9fa25b7" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2025.png"><img style="width:679.9375px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2025.png"/></a></figure><ul id="118e0021-eb2d-8081-8cfa-fc28d3c5bc65" class="bulleted-list"><li style="list-style-type:disc">Application supports photo customization, including cropping, sharpening, blurring, etc. Those customization tasks take time to complete.</li></ul><ul id="118e0021-eb2d-80e4-aac9-e32d7647c0c7" class="bulleted-list"><li style="list-style-type:disc">Web servers publish photo processing jobs to the message queue. </li></ul><ul id="118e0021-eb2d-80db-a99b-e3f41946e80f" class="bulleted-list"><li style="list-style-type:disc">Photo processing workers pick up jobs from the message queue and asynchronously perform photo customization tasks. </li></ul><ul id="118e0021-eb2d-80a7-8a3f-e0cf9b0f1d18" class="bulleted-list"><li style="list-style-type:disc">The producer and the consumer can be scaled independently. </li></ul><ul id="118e0021-eb2d-809b-babb-d0d72b18407f" class="bulleted-list"><li style="list-style-type:disc">When the size of the queue becomes large, more workers are added to reduce the processing time. </li></ul><ul id="118e0021-eb2d-80b6-b726-f5b24373db1d" class="bulleted-list"><li style="list-style-type:disc">However, if the queue is empty most of the time, the number of workers can be reduced.</li></ul><h2 id="118e0021-eb2d-8080-a598-dab36480817d" class="">Design with Message Queues</h2><figure id="118e0021-eb2d-80f6-b060-cac35ccb536d" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/f3825285-61d4-490a-8944-2e93a552960f.png"><img style="width:320.44786564030795px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/f3825285-61d4-490a-8944-2e93a552960f.png"/></a></figure><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="118e0021-eb2d-8052-897b-e4cdab50a6b6"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="118e0021-eb2d-8054-801e-cc33c8f571b8" class="">Design with message queues helps to make the system <strong><span style="border-bottom:0.05em solid">more loosely coupled and failure resilient.</span></strong></p></div></figure></div></details><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">Indexing in Database</summary><div class="indented"><p id="117e0021-eb2d-80c0-b990-fd5475bbf507" class=""><strong><span style="border-bottom:0.05em solid">Problem</span></strong> → </p><ul id="117e0021-eb2d-80f7-8f41-d84a4b9db859" class="bulleted-list"><li style="list-style-type:disc">Have you ever experienced a slow website or a customer portal that takes too long to fetch data? </li></ul><ul id="117e0021-eb2d-8044-9704-e3030ae0167c" class="bulleted-list"><li style="list-style-type:disc">A pervasive issue with such systems is the lack of proper indices. </li></ul><ul id="117e0021-eb2d-80ec-bc93-dd664a2777e1" class="bulleted-list"><li style="list-style-type:disc">As a result, the database queries take much longer than expected to find the information you are looking for</li></ul><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="117e0021-eb2d-80f1-ae54-ef494c6a7e78"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="117e0021-eb2d-8017-a33a-e6a4eda1610f" class="">Indexing is <strong><span style="border-bottom:0.05em solid">a mechanism by which the underlying data is mapped for faster retrieval</span></strong>. </p></div></figure><p id="117e0021-eb2d-8064-950b-c9ed8dec4557" class="">For a system to process an instruction involving data access, these are the certain steps involved:</p><ol type="1" id="117e0021-eb2d-806a-9e4b-f525db7375f4" class="numbered-list" start="1"><li>Fetch the block of data from the hard disk (secondary/permanent storage) to the primary memory (e.g. RAM).</li></ol><ol type="1" id="117e0021-eb2d-8029-b16e-de125029a196" class="numbered-list" start="2"><li>Look for the desired data in the RAM.</li></ol><ol type="1" id="117e0021-eb2d-8025-a676-ed7967f94c1c" class="numbered-list" start="3"><li>Repeat 1 and 2 until desired data is fetched.</li></ol><h3 id="117e0021-eb2d-8069-bbc6-ef8ec52ede75" class="">How does indexing achieve faster data access?</h3><ul id="117e0021-eb2d-80a1-a78e-cc0132dd76f5" class="bulleted-list"><li style="list-style-type:disc">In the hard disk, there might be GBs or TBs (or higher orders) of data stored. </li></ul><ul id="117e0021-eb2d-8002-a9fb-ea4fa3e27b90" class="bulleted-list"><li style="list-style-type:disc">If we try to look at each record in the disk to search for a specific record (which is like going through each page of the book to look for the desired chapter) this would take a long time. </li></ul><ul id="117e0021-eb2d-8037-8af4-da821d761ebe" class="bulleted-list"><li style="list-style-type:disc">Instead, if there was a way to keep an index of records on the disk, the process would be much faster. This <strong><span style="border-bottom:0.05em solid">index for records is more like a map or a key-value pair, where the key identifies a record (or a set of records) and the value is the location of the record on the disk.</span></strong></li></ul><ul id="117e0021-eb2d-80d9-b95c-ee4047211e9e" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Dense index</span></strong> → When the index maintains a key-value mapping for each of the records in the database. </li></ul><ul id="117e0021-eb2d-80ce-b793-df81891aea58" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Sparse Index</span></strong> → When the index maintains a mapping for a subset of the records.</li></ul><h3 id="117e0021-eb2d-805b-a08a-d42bb91ebe43" class="">Example </h3><ul id="117e0021-eb2d-8047-8d84-fb8cadea9853" class="bulleted-list"><li style="list-style-type:disc">Assume that → <ul id="117e0021-eb2d-80ca-90ea-c0b0fcb098d8" class="bulleted-list"><li style="list-style-type:circle">a hard disk has 100 data records, each of size 128B.</li></ul><ul id="117e0021-eb2d-801f-b322-e87c35e4fd83" class="bulleted-list"><li style="list-style-type:circle">Size of each block in the disk = 512B</li></ul><ul id="117e0021-eb2d-800f-99a1-e25c79b885c3" class="bulleted-list"><li style="list-style-type:circle">This means each block can hold (512/128) 4 records.</li></ul></li></ul><figure id="117e0021-eb2d-8047-b10d-e9e7cd2c5566" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/Blank_board_(1).png"><img style="width:4208px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/Blank_board_(1).png"/></a></figure><ul id="117e0021-eb2d-80da-aae7-ef2141043b93" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Without Indexing</span></strong> → If our RAM loads one block at a time from the disk, then to search for the desired data in all the records, in the worst case, we would need to fetch 25 blocks (100/4).</li></ul><ul id="117e0021-eb2d-8048-94db-ebd61e8f5930" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">With Indexing</span></strong> →<ul id="117e0021-eb2d-8053-99ec-cb009a5a5643" class="bulleted-list"><li style="list-style-type:circle">Consider that now we maintain a map (a set of key-value pairs) of the record ID (key) to the block address (value). And let&#x27;s say that each key-value pair takes 2B. This map would be 200B.<figure id="117e0021-eb2d-80e5-9143-da0d147331c8" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/6e999ac8-4b78-4798-aa4d-f81789363d99.png"><img style="width:513.28px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/6e999ac8-4b78-4798-aa4d-f81789363d99.png"/></a></figure></li></ul><ul id="117e0021-eb2d-80f6-9e61-cc4dc277a4d5" class="bulleted-list"><li style="list-style-type:circle">This map is nothing but an index. Now, if we search a record in the hard disk, the index would first be loaded in the RAM, and then based on the key, we will retrieve the block address.</li></ul><ul id="117e0021-eb2d-8025-bdb6-f615048e58e5" class="bulleted-list"><li style="list-style-type:circle">Once we have the block address, the specific block from the hard disk would be loaded instead of loading all the blocks. And from the block, we can fetch the desired record.</li></ul><ul id="117e0021-eb2d-8077-94c3-ed162f507cff" class="bulleted-list"><li style="list-style-type:circle">This means that <strong><span style="border-bottom:0.05em solid">by maintaining an index, we could reduce the I/O calls to the disk substantially, from 25 calls before the index to 2 calls</span></strong> (one for the index and the other for the specific block).</li></ul><h3 id="117e0021-eb2d-8076-a4f3-df26ce2c169f" class="">Multilevel Index</h3><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="117e0021-eb2d-8024-8429-fb5c1ea0e8ab"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="117e0021-eb2d-80c4-a6a7-c35662edf07a" class=""><strong><span style="border-bottom:0.05em solid">Multilevel indices maintain an index of indices. This means that to fetch a record, first an index is referenced to get the address for the block storing the correct index, as shown in the following diagram.</span></strong></p></div></figure><p id="117e0021-eb2d-806e-ad05-c85cd54955db" class="">These multiple levels of indices reduce the I/O calls from 40 to 2 (excluding the call to load the record):</p><ol type="1" id="117e0021-eb2d-80cd-a381-f3d56e087b85" class="numbered-list" start="1"><li>One call to load the level 1 index.</li></ol><ol type="1" id="117e0021-eb2d-80ce-b9f2-dccc6beaf2b8" class="numbered-list" start="2"><li>The second call is to load the level 2 index as determined from the level 1 index.</li></ol><p id="117e0021-eb2d-800c-a10c-d27af7046906" class="">The levels of indices can keep on increasing as the data grows to keep the indexing efficient.</p><h3 id="117e0021-eb2d-802b-848c-e324f5b6916f" class="">B-trees</h3><ul id="117e0021-eb2d-80a0-8e93-d30c2c0df50d" class="bulleted-list"><li style="list-style-type:circle">B-trees are <strong><span style="border-bottom:0.05em solid">self-adjusting trees that can achieve multilevel indexing</span></strong>. </li></ul><ul id="117e0021-eb2d-8094-86f2-c7c2c8049bd4" class="bulleted-list"><li style="list-style-type:circle">They are a generalized form of Binary Search Trees. </li></ul><ul id="117e0021-eb2d-803d-8d43-f80bb012d72d" class="bulleted-list"><li style="list-style-type:circle">The data is stored in sorted order in the B-trees. </li></ul><ul id="117e0021-eb2d-8049-a115-f282cecd873c" class="bulleted-list"><li style="list-style-type:circle">B-tree achieves the efficient utilization of space in nodes, along with keeping the height of the tree small.<figure id="117e0021-eb2d-808b-b5c7-fccc106a3f44" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2026.png"><img style="width:432px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2026.png"/></a></figure></li></ul><h3 id="117e0021-eb2d-80db-b9b8-d75d34aa0dcc" class="">B+ Trees</h3><ul id="117e0021-eb2d-80bf-bf44-f2a6d0fafa77" class="bulleted-list"><li style="list-style-type:circle">B+ tree eliminates the drawback B-tree used for indexing by storing data pointers only at the leaf nodes of the tree. Thus, the structure of leaf nodes of a B+ tree is quite different from the structure of internal nodes of the B tree. </li></ul><ul id="117e0021-eb2d-80be-976e-c0e3164d123b" class="bulleted-list"><li style="list-style-type:circle">It may be noted here that, since data pointers are present only at the leaf nodes, the leaf nodes must necessarily store all the key values along with their corresponding data pointers to the disk file block, to access them. </li></ul><ul id="117e0021-eb2d-80b7-8029-d4a6b7292633" class="bulleted-list"><li style="list-style-type:circle"><strong><span style="border-bottom:0.05em solid">All the leaf nodes are connected to form a linked list. This enables sequential access along with direct access.</span></strong></li></ul><ul id="117e0021-eb2d-8096-b391-fe5ffa91fe9a" class="bulleted-list"><li style="list-style-type:circle">Moreover, the leaf nodes are linked to providing ordered access to the records. The leaf nodes, therefore form the first level of the index, with the internal nodes forming the other levels of a multilevel index.<figure id="117e0021-eb2d-80f2-bd17-e834dbf98fe3" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2027.png"><img style="width:623.984375px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2027.png"/></a></figure></li></ul></li></ul></div></details><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">Failover</summary><div class="indented"><p id="117e0021-eb2d-804d-838d-d01f1084e1a8" class="">When a leader node fails:</p><ul id="117e0021-eb2d-8098-af62-f03ffbd87e56" class="bulleted-list"><li style="list-style-type:disc">One of the follower nodes needs to be promoted to the leader.</li></ul><ul id="117e0021-eb2d-80d4-a72c-fa3ab83cb620" class="bulleted-list"><li style="list-style-type:disc">Client node(s) must be reconfigured to send the write request to the new leader.</li></ul><ul id="117e0021-eb2d-80c8-a44d-f1212d54713d" class="bulleted-list"><li style="list-style-type:disc">Other followers need to be reconfigured to consume data from the new leader.</li></ul><p id="117e0021-eb2d-80f3-b857-c1f27fc01382" class="">For failover to be triggered, <strong><span style="border-bottom:0.05em solid">a prerequisite is that the leader&#x27;s failures should be tracked</span></strong>, which can be done <strong><span style="border-bottom:0.05em solid">by sending some health-status pings to the nodes from time to time</span></strong>, and use the response time to determine the failure.</p><h2 id="117e0021-eb2d-809c-8f55-ccfa874e01ed" class="">Complications of Failover</h2><p id="117e0021-eb2d-80f2-b9f3-e90cf28ccfad" class="">Failover can lead to some tricky issues:</p><ul id="117e0021-eb2d-80c1-a8d3-fae7fd139b96" class="bulleted-list"><li style="list-style-type:disc">Failover leads to <strong><span style="border-bottom:0.05em solid">lost updates in the case of asynchronous replication</span></strong> when the leader goes down.</li></ul><ul id="117e0021-eb2d-80b6-a295-c919c2a2f304" class="bulleted-list"><li style="list-style-type:disc">How to detect if the leader has gone down? Deciding the threshold for when to mark the leader as unavailable can be challenging. Sometimes it can happen that the traffic on the system is high, and that’s why it is taking longer to respond. In such scenarios, if we bring down the leader, the system would be even more stressed.</li></ul><ul id="117e0021-eb2d-8054-9b8a-cb7d3b6de256" class="bulleted-list"><li style="list-style-type:disc">The problem of having more than one leader.</li></ul><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="117e0021-eb2d-8018-b51e-c59ba84fdc3f"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="117e0021-eb2d-8071-9a68-e37ebb025a8c" class="">It is important to ensure that once a failover is triggered, <strong><span style="border-bottom:0.05em solid">the old leader is aware of their changed role whenever it comes back up</span></strong>. <strong><span style="border-bottom:0.05em solid">It should pick up its new role as a follower, should stop accepting the write requests, and be configured to listen to the new leader.</span></strong></p></div></figure></div></details><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">Replication</summary><div class="indented"><p id="117e0021-eb2d-8019-bc15-ee5970435458" class="">Replication is done to achieve one or more of the following goals:</p><ul id="117e0021-eb2d-8087-8e32-f5df7fad7dd3" class="bulleted-list"><li style="list-style-type:disc">To <strong><span style="border-bottom:0.05em solid">avoid a single point of failure</span></strong> and <strong><span style="border-bottom:0.05em solid">increase availability when machines go down</span></strong>.</li></ul><ul id="117e0021-eb2d-80a7-ba3f-dcc06b39c045" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">To better serve the global users by organizing copies by distinct geological locations</span></strong> in order to serve users from copies that are close by.</li></ul><ul id="117e0021-eb2d-80c7-8ff5-dd4b275b18c8" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">To increase throughput. With more machines, more requests can be served.</span></strong></li></ul><h3 id="117e0021-eb2d-8097-9d25-da5bbc3d78d0" class="">Some key terms</h3><ul id="117e0021-eb2d-804e-9dff-ee8308ed1cc2" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Replica</span></strong> → Copy of data</li></ul><ul id="117e0021-eb2d-8004-960f-ebbf4c05e6c6" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Leader</span></strong> → Machine that handles write requests to the data store.</li></ul><ul id="117e0021-eb2d-8018-992a-f5a71b939a41" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Followers</span></strong> → Machines that are replicas of the leader node and cater to read requests.</li></ul><h2 id="117e0021-eb2d-80e6-8b3d-d4e1664180ce" class="">Synchronous vs Asynchronous Replication</h2><p id="117e0021-eb2d-8045-b4d3-eef2bdb50281" class=""><strong><span style="border-bottom:0.05em solid">Synchronous Replications →</span></strong></p><ul id="117e0021-eb2d-800d-a1f3-c7b6870e51e6" class="bulleted-list"><li style="list-style-type:disc">When a <strong><span style="border-bottom:0.05em solid">write request to a replica is marked as acknowledged</span></strong>, only then is it called synchronous replication. </li></ul><ul id="117e0021-eb2d-800a-9ee1-e8317c8bc5d3" class="bulleted-list"><li style="list-style-type:disc">This means that the <strong><span style="border-bottom:0.05em solid">leader waits for an acknowledgment</span></strong> from all of the followers.</li></ul><ul id="117e0021-eb2d-800d-9af6-e86945d93a52" class="bulleted-list"><li style="list-style-type:disc">Synchronous replication <strong><span style="border-bottom:0.05em solid">ensures that the information is replicated before moving on</span></strong>. This can be nice when it is vital that nothing is missed. </li></ul><ul id="117e0021-eb2d-805a-92a9-d9e8bfd4ddf6" class="bulleted-list"><li style="list-style-type:disc">The downside is that <strong><span style="border-bottom:0.05em solid">it slows down the stream of information being passed</span></strong>.</li></ul><p id="117e0021-eb2d-8043-ad70-cd346f308795" class=""><strong><span style="border-bottom:0.05em solid">Asynchronous Replication →</span></strong></p><ul id="117e0021-eb2d-80f8-916d-fa62411d6c4d" class="bulleted-list"><li style="list-style-type:disc">When the <strong><span style="border-bottom:0.05em solid">leader doesn’t wait for the acknowledgment from the followers before marking the client’s write requests as successful</span></strong>, it is called asynchronous replication. </li></ul><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="117e0021-eb2d-8080-a52e-db0559750c8d"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="117e0021-eb2d-805d-ae85-cf1dbbc605f5" class=""><strong><span style="border-bottom:0.05em solid">Sync replication ensures guaranteed delivery to all the followers, while async replication is less time-consuming for the client.</span></strong></p></div></figure><p id="117e0021-eb2d-803a-8e15-ed3fa2394e93" class=""><strong><span style="border-bottom:0.05em solid">Semi- synchronous approach →</span></strong></p><ul id="117e0021-eb2d-8083-a312-dbd851a32780" class="bulleted-list"><li style="list-style-type:disc">Where only one follower is synchronously updated and the rest are asynchronous. </li></ul><ul id="117e0021-eb2d-804f-92be-f6e5f12b6b2e" class="bulleted-list"><li style="list-style-type:disc">When the former crashes, one of the latter is made a synchronous follower. This ensures that the up-to-date copy is at least available in two nodes and the client is also not kept waiting for long.</li></ul><h2 id="117e0021-eb2d-80af-a45e-e1ebb67ac876" class="">Most common types of Replication Systems</h2><h3 id="117e0021-eb2d-80ad-9392-f5c92b0505a7" class="">Single Leader</h3><ul id="117e0021-eb2d-8067-974b-f1e5253cc27b" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Primary-standby or Active-passive replication →</span></strong><ul id="117e0021-eb2d-80b6-aec4-d8e8868b15c0" class="bulleted-list"><li style="list-style-type:circle">In system design, <strong><span style="border-bottom:0.05em solid">a single machine acts as a leader, and all write requests (or updates to the data store) go through that machin</span></strong>e. All the other machines are used to cater to the read requests.</li></ul><ul id="117e0021-eb2d-8050-b942-c8655fb6bd19" class="bulleted-list"><li style="list-style-type:circle">The leader also needs to pass down the information about all the writes to the follower nodes to keep them up to date. </li></ul><ul id="117e0021-eb2d-80a6-90ab-d32bda31f7ef" class="bulleted-list"><li style="list-style-type:circle">In case <strong><span style="border-bottom:0.05em solid">the leader goes down, one of the follower nodes (mostly with the most up-to-date data) is promoted to be the leader. This is called failover</span></strong>.</li></ul><figure id="117e0021-eb2d-8060-abb9-fe34407607ee" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2028.png"><img style="width:651.984375px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2028.png"/></a></figure></li></ul><h3 id="117e0021-eb2d-8060-8f95-ea7649265fd4" class="">Multi-leader</h3><ul id="117e0021-eb2d-8077-bea1-e3eb52b9627c" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">More than one machine can take the write requests. </span></strong></li></ul><ul id="117e0021-eb2d-8085-baae-d8f9358090e8" class="bulleted-list"><li style="list-style-type:disc">This makes the system more reliable in case a leader goes down. </li></ul><ul id="117e0021-eb2d-804d-9213-dda04c4acb16" class="bulleted-list"><li style="list-style-type:disc">This also means that <strong><span style="border-bottom:0.05em solid">every machine (including leaders) needs to catch up with the writes that happen over other machines</span></strong>.<figure id="117e0021-eb2d-8015-8c95-f7b69fce30c4" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2029.png"><img style="width:652px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2029.png"/></a></figure></li></ul><h3 id="117e0021-eb2d-8088-a041-c9301f0dfb5b" class="">Leaderless Replication</h3><ul id="117e0021-eb2d-8006-94cc-d3db13e3a917" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">All machines can cater to write and read requests. </span></strong></li></ul><ul id="117e0021-eb2d-80a2-9711-c414ed93b56a" class="bulleted-list"><li style="list-style-type:disc">In some cases, <strong><span style="border-bottom:0.05em solid">the client directly writes to all the machines, and requests are read from all the machines based on quorum</span></strong>. </li></ul><ul id="117e0021-eb2d-801f-8e56-c0e4a3bbde79" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Quorum refers to the minimum number of acknowledgements (for writes) and consistent data values (for reads) for the action to be valid. </span></strong></li></ul><ul id="117e0021-eb2d-8097-afd1-c6b118ef711f" class="bulleted-list"><li style="list-style-type:disc">In other cases, the client request reaches the coordinator that broadcasts the request to all the node.</li></ul><details open=""><summary style="font-weight:600;font-size:1.5em;line-height:1.3;margin:0">Database Replication</summary><div class="indented"><blockquote id="117e0021-eb2d-80a5-b327-e0d24e4b96b8" class=""><em>This section expands on Single Leader type of replication in terms of database</em></blockquote><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="117e0021-eb2d-8015-ba20-cf2342b4acd4"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="117e0021-eb2d-8047-9a2e-eb4db5c72a03" class=""><strong><span style="border-bottom:0.05em solid">Database replication can be used in many database management systems with a primary-standby relationship between the original (leader) and the copies (follower).</span></strong></p></div></figure><ul id="117e0021-eb2d-80b6-82d6-f0475d5b2441" class="bulleted-list"><li style="list-style-type:disc">Leader database only supports WRITE operations.</li></ul><ul id="117e0021-eb2d-806d-a4db-d25d8e0a3013" class="bulleted-list"><li style="list-style-type:disc">Follower database gets copies of the data from the leader and only supports READ operations.</li></ul><ul id="117e0021-eb2d-809c-912a-c19601836998" class="bulleted-list"><li style="list-style-type:disc">All the data-modifying command like INSERT, DELETE, or UPDATE must be sent to the leader database.</li></ul><ul id="117e0021-eb2d-8078-8ba8-d3c11e090110" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Most applications require a much higher ratio of reads to writes; the number of followers is larger than that of the leaders</span></strong>. </li></ul><figure id="117e0021-eb2d-80d1-9ff5-d83215712a68" class="image" style="text-align:center"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2030.png"><img style="width:480px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2030.png"/></a></figure><ul id="117e0021-eb2d-8015-a868-fe1b4ed701da" class="bulleted-list"><li style="list-style-type:disc"><strong>What will happen if only one follower DB is available and it goes offline ?</strong><ul id="117e0021-eb2d-8044-b97b-de91523c0b4d" class="bulleted-list"><li style="list-style-type:circle">All read operations will be directed to the master DB <em>temporarily</em>.</li></ul><ul id="117e0021-eb2d-8066-a6be-eefdda7d2bd4" class="bulleted-list"><li style="list-style-type:circle">As soon as the issue is found, a new follower DB will replace the old one.</li></ul><ul id="117e0021-eb2d-8083-9aea-d0e0f76c8c3f" class="bulleted-list"><li style="list-style-type:circle">In case multiple follower DBs are available, read operations are redirected to other healthy slave databases.</li></ul></li></ul><ul id="117e0021-eb2d-8051-ae0e-c68237f9567e" class="bulleted-list"><li style="list-style-type:disc"><strong>What will happen if leader DB goes offline ?</strong><ul id="117e0021-eb2d-8089-a56b-ee12b6010ccd" class="bulleted-list"><li style="list-style-type:circle">Follower DB will be promoted as a new leader.</li></ul><ul id="117e0021-eb2d-80d3-b843-e542cbb9cb60" class="bulleted-list"><li style="list-style-type:circle">All database operations will be temporarily executed on the new leader DB.</li></ul><ul id="117e0021-eb2d-80be-9bbb-cb94593b304c" class="bulleted-list"><li style="list-style-type:circle">A new follower DB will replace the old one for data replication immediately.</li></ul></li></ul><ul id="117e0021-eb2d-8026-ac93-d48d82c420c7" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Advantages</span></strong> →<ul id="117e0021-eb2d-8095-ac54-d00be3710e87" class="bulleted-list"><li style="list-style-type:circle">Better performance → allows more queries to be processed in parallel.</li></ul><ul id="117e0021-eb2d-803d-b421-d9a51ca3d0b5" class="bulleted-list"><li style="list-style-type:circle">Reliability → No need to worry about data loss as data is replicated across multiple locations.</li></ul><ul id="117e0021-eb2d-8058-aa76-fceebf7ced31" class="bulleted-list"><li style="list-style-type:circle">High availability → Application remains in operation even if a database is offline as you can access data stored in another DB server.</li></ul></li></ul><h3 id="117e0021-eb2d-8085-959f-fb85508c4d15" class="">System design with Database replication</h3><figure id="117e0021-eb2d-80d2-88b4-ff885a0d78b3" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2031.png"><img style="width:651.984375px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2031.png"/></a></figure><ul id="117e0021-eb2d-800d-a0df-d2ed3a6887c1" class="bulleted-list"><li style="list-style-type:disc">User gets the IP address of load balancer from DNS.</li></ul><ul id="117e0021-eb2d-80d4-887a-ed745ec06f3e" class="bulleted-list"><li style="list-style-type:disc">User connects the load balancer with this IP address.</li></ul><ul id="117e0021-eb2d-802f-a24b-ffcf77924f06" class="bulleted-list"><li style="list-style-type:disc">HTTP request is routed to either Server 1 or Server 2.</li></ul><ul id="117e0021-eb2d-8013-b46d-c5e144dc4598" class="bulleted-list"><li style="list-style-type:disc">A web server reads user data from a follower DB.</li></ul><ul id="117e0021-eb2d-808d-8a58-c4c3c231d8cb" class="bulleted-list"><li style="list-style-type:disc">A web server routes any data-modifying operations to the Leader FB.</li></ul></div></details></div></details><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">Consistent Hashing</summary><div class="indented"><h3 id="117e0021-eb2d-809e-8be2-ca0c97d7b178" class=""><strong>Problem statement:</strong></h3><p id="117e0021-eb2d-804c-9ae2-c3de9a0d68a0" class="">You want to add cache server to reduce the load on the database and serve the data faster. Given a set of nodes forming a cluster of cache servers, how do you identify where is the data for a particular key?</p><h2 id="117e0021-eb2d-809a-aa01-d02bf3064c77" class="">Brute Force:</h2><p id="117e0021-eb2d-8008-add8-f2805fc67f4b" class="">Let’s say the data that you want to cache is not very big and can easily fit into one machine. You start with a single cache server. <strong><span style="border-bottom:0.05em solid">Simple option is to use a hash table which maps a given key to a value. To retrieve any key, the requests will be directed to the same cache server</span></strong>.</p><figure id="117e0021-eb2d-8058-a296-fd7ff50e69b4" class="image"><a href="https://miro.medium.com/v2/resize:fit:532/1*ys8rk-td2kAFpD2wjtzNtQ.jpeg"><img style="width:354px" src="https://miro.medium.com/v2/resize:fit:532/1*ys8rk-td2kAFpD2wjtzNtQ.jpeg"/></a></figure><h2 id="117e0021-eb2d-805d-ab70-f393b4afc4a9" class="">Scale up:</h2><p id="117e0021-eb2d-804e-8077-dde2f64f3939" class="">Your application has started to get traction and you realise that it’s not possible to hold the cache in a single machine and you would like to add more cache servers. You would now need to split the hash table onto multiple servers.</p><figure id="117e0021-eb2d-8074-b604-e47c3c1550df" class="image"><a href="https://miro.medium.com/v2/resize:fit:551/1*JvdhB6RqQEgK5scRr70fzw.jpeg"><img style="width:354px" src="https://miro.medium.com/v2/resize:fit:551/1*JvdhB6RqQEgK5scRr70fzw.jpeg"/></a></figure><p id="117e0021-eb2d-8085-9213-ff13e8a097ac" class=""><em><strong>But.. How do you know which cache server holds the data for a given key ?</strong></em></p><p id="117e0021-eb2d-8015-b16e-e3cd151d8a3c" class="">A simple solution would be <strong><span style="border-bottom:0.05em solid">to query all the cache servers for the given key</span></strong>. The cache server holding the data would return the value of the key and others would return empty. This solution has two <strong><span style="border-bottom:0.05em solid">major drawbacks</span></strong> →</p><ul id="117e0021-eb2d-8056-a720-e58f0c84b559" class="bulleted-list"><li style="list-style-type:disc">All the cache servers will be queried for each request. In this case the load will not be distributed among the servers.</li></ul><ul id="117e0021-eb2d-8078-a81e-c61605cc663e" class="bulleted-list"><li style="list-style-type:disc">Latency in one of the server(which holds the data for a subset of users) will affect all the users.</li></ul><h3 id="117e0021-eb2d-80aa-8369-d5e3ffb222c7" class="">Improved Solution : Hashing →</h3><p id="117e0021-eb2d-80c8-9fa8-d4b8dc5566a7" class="">An improved solution would be <strong><span style="border-bottom:0.05em solid">to identify the node on which the data resides for the particular key</span></strong>. You can take the hash of the key and modulo the number of servers <code>hash(key) % (no of servers)</code>to distribute the keys. This approach is called the <strong><span style="border-bottom:0.05em solid">Hash Partitioning</span></strong> algorithm.</p><p id="117e0021-eb2d-800c-a860-fca6bcb5bf8a" class="">For the sake of simplicity, let’s assume we have 4 key value pairs. Each key represents the name of the user and the value represents the age.</p><figure id="117e0021-eb2d-80e6-9f66-dd394d16ba83" class="image" style="text-align:center"><a href="https://miro.medium.com/v2/resize:fit:141/1*3PtTVTJ2CXt8XdnBl1OYaw.jpeg"><img style="width:141px" src="https://miro.medium.com/v2/resize:fit:141/1*3PtTVTJ2CXt8XdnBl1OYaw.jpeg"/></a></figure><p id="117e0021-eb2d-80fa-8d39-e1da568fbd20" class="">The figure given below explains how the keys will be distributed if we had three cache servers.</p><figure id="117e0021-eb2d-8017-8ce7-df6975a948e3" class="image"><a href="https://miro.medium.com/v2/resize:fit:581/1*71iBopPq90eaE736VrUErw.jpeg"><img style="width:354px" src="https://miro.medium.com/v2/resize:fit:581/1*71iBopPq90eaE736VrUErw.jpeg"/></a></figure><p id="117e0021-eb2d-80dc-a013-f998f641df29" class=""><strong><span style="border-bottom:0.05em solid">To retrieve a key, you can hash the key and mod the number of servers to determine which server holds the key</span></strong>. This is a better solution than the previous approach where you need to query all the nodes to get the value for a given key.</p><p id="117e0021-eb2d-80c6-ab00-f64259a6e802" class="">All goes well until you might need to add cache servers or if any of the existing cache servers crashes or becomes unavailable.</p><h3 id="117e0021-eb2d-80a3-a2d0-c81ce969edea" class=""><strong>What happens when a node crashes?</strong> </h3><ul id="117e0021-eb2d-804d-a9d5-d596ac8d4336" class="bulleted-list"><li style="list-style-type:disc">Say server ‘C’ crashes. The keys that were mapped to server C now needs to be distributed to the remaining servers. </li></ul><ul id="117e0021-eb2d-809a-ae6e-caec96184b5b" class="bulleted-list"><li style="list-style-type:disc"><em>What happens to the keys that were mapped to servers ‘A’ and ‘B’?</em> They will also be remapped. Why? Remember the routing algorithm? <span style="border-bottom:0.05em solid">We take the hash of the key and mod the number of servers. Now the number of servers has changed from 3 to 2</span>.</li></ul><ul id="117e0021-eb2d-8054-91c3-f6542e7da1a2" class="bulleted-list"><li style="list-style-type:disc">Request to retrieve a key say ‘<strong>Smith</strong>’ will be redirected to the server ‘B’ where as the data for it originally resided on server ‘A’. This will lead to a cache miss and the data needs to be fetched again from the database.</li></ul><figure id="117e0021-eb2d-80d6-a1d4-d0e769e52b83" class="image"><a href="https://miro.medium.com/v2/resize:fit:700/1*olUiIHhMkqqki4vP7wA-Rg.jpeg"><img style="width:680px" src="https://miro.medium.com/v2/resize:fit:700/1*olUiIHhMkqqki4vP7wA-Rg.jpeg"/></a></figure><ul id="117e0021-eb2d-803c-a74a-f8ca21b008bf" class="bulleted-list"><li style="list-style-type:disc">Similarly for all the keys, <strong><span style="border-bottom:0.05em solid">there will be frequent cache misses and many users whose data has already been cached will start to see problems</span></strong>. </li></ul><ul id="117e0021-eb2d-80ae-b943-fef5ac16613d" class="bulleted-list"><li style="list-style-type:disc">The original data needs to be sourced from the database again. This will increase the load on the database. </li></ul><ul id="117e0021-eb2d-8042-a414-d8a02c4cbb6d" class="bulleted-list"><li style="list-style-type:disc">In distributed systems where node failures are common, the process of building the cache every time a failure occurs will lead to a degraded performance of the application. The same concept applies when you add a cache server.</li></ul><blockquote id="117e0021-eb2d-80f4-802e-dd8c69cabb45" class=""><em><strong>We need a hashing solution which is independent of the number of servers and at the same time should have minimal impact during scaling up/down horizontally (adding or reducing number of nodes/ server).</strong></em></blockquote><h2 id="117e0021-eb2d-8045-b5f8-d386e8be49cc" class=""><strong>Consistent Hashing</strong></h2><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="117e0021-eb2d-80fe-992f-fdd85176f7fb"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="117e0021-eb2d-8077-9c98-e9a9bd5cef56" class=""><strong><span style="border-bottom:0.05em solid">Consistent Hashing is a distributed hashing algorithm that is independent of the number of servers. It maps the servers and the keys to a hash ring. There are infinite number of points on the ring where the keys can be mapped now.</span></strong></p></div></figure><ul id="117e0021-eb2d-808d-bb23-d7e52b1aded9" class="bulleted-list"><li style="list-style-type:disc">The servers can be mapped to random locations in the ring or a hash function can be used to find the location of the server on the ring. </li></ul><ul id="117e0021-eb2d-80f5-95e5-cd1194f1fe8c" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">The ring is assumed to be ordered</span></strong>. </li></ul><ul id="117e0021-eb2d-8000-9c46-d20024af5cb3" class="bulleted-list"><li style="list-style-type:disc">As you traverse clockwise along the ring, the hash location increases.</li></ul><figure id="117e0021-eb2d-8028-8ae6-fa21a457c2ed" class="image" style="text-align:center"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2032.png"><img style="width:354px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2032.png"/></a></figure><ul id="117e0021-eb2d-8048-9584-f523e09f4352" class="bulleted-list"><li style="list-style-type:disc">Similarly, you map all the keys to a point in the ring using the same hash function that was used to map the servers.</li></ul><h3 id="117e0021-eb2d-8023-8d41-d8c0f6dee220" class=""><strong>How do you decide which server the key belongs to? </strong></h3><ul id="117e0021-eb2d-803e-b8a7-faa556bc0cee" class="bulleted-list"><li style="list-style-type:disc">First, map the key to the hash ring. Start from the location of the key and traverse <strong><span style="border-bottom:0.05em solid">clockwise</span></strong>. Assign the key to the server that comes first in clock wise traversal.</li></ul><figure id="117e0021-eb2d-80df-922b-d347519ef87e" class="image" style="text-align:center"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2033.png"><img style="width:354px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2033.png"/></a></figure><h3 id="117e0021-eb2d-8087-8969-f3430b64f11c" class=""><strong>What happens when you add new cache servers?</strong> </h3><p id="117e0021-eb2d-8025-a062-cf5a5110f284" class="">Let’s say we add one server ‘D’ and it gets mapped in between the servers ‘A’ and ‘B’ in the ring. <span style="border-bottom:0.05em solid">Only the keys which fall in between the servers ‘A’ and ‘D’ will be remapped to server ‘D’ and all the remaining keys will be untouched</span>. This is the beauty of Consistent Hashing. </p><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="117e0021-eb2d-802f-8844-ed70610564aa"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="117e0021-eb2d-805c-8c06-fad1ef8331e3" class=""><strong><span style="border-bottom:0.05em solid">Only a part of the keys needs to be remapped as compared to all the keys in the Hash Partitioning algorithm.</span></strong></p></div></figure><figure id="117e0021-eb2d-8050-b3ea-da914e9c7607" class="image" style="text-align:center"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2034.png"><img style="width:354px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2034.png"/></a></figure><h3 id="117e0021-eb2d-80b4-8b46-fcb8ac85d397" class=""><strong>What happens when a node crashes or becomes unavailable? </strong></h3><p id="117e0021-eb2d-8022-afeb-e5deeab6951a" class="">The below figure shows the case when server ‘B’ has crashed. <strong><span style="border-bottom:0.05em solid">The keys which were earlier mapped to server ‘B’ will be rehashed to server ‘C’ i.e. the next server in clockwise direction and the remaining keys will be untouched</span></strong>.</p><figure id="117e0021-eb2d-805a-af6b-fad07e568af4" class="image" style="text-align:center"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2035.png"><img style="width:354px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2035.png"/></a></figure><p id="117e0021-eb2d-80ba-9f21-f7eb40ac1113" class="">Voila! Your hashing logic has improved with Consistent Hashing and now addition/removal of nodes have lesser impact as compared to the Hash Partitioning algorithm.</p><p id="117e0021-eb2d-80fa-a9c0-ea6ec3eacb1f" class="">But the above solution works well as long as we assume that the data is distributed uniformly. You realise that,</p><blockquote id="117e0021-eb2d-8033-9b75-c115fe08522c" class=""><em>Practically, data is not distributed uniformly , rather it’s randomly distributed.</em></blockquote><h3 id="117e0021-eb2d-80af-aa4d-e61c9bbfdec8" class=""><strong>What are the issues that can be caused by random distribution of data?</strong> </h3><p id="117e0021-eb2d-8052-bad9-ca6815f22ed1" class="">This might lead to <strong><span style="border-bottom:0.05em solid">non-uniform distribution of data among the cache servers.</span></strong> In the below figure, you can observe that most of the keys gets mapped to server ‘B’ and if the access pattern of these keys are more frequent than the others, the server ‘B’ will see more requests while the other servers ‘A’<strong> </strong>and ‘C’ will remain idle or under-utilised. This leads to what is called in distributed systems as <em><strong><span style="border-bottom:0.05em solid">hotspots</span></strong></em><em><strong>.</strong></em></p><figure id="117e0021-eb2d-8095-bccf-d8d1eb9aa55a" class="image" style="text-align:center"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2036.png"><img style="width:354px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2036.png"/></a></figure><h3 id="117e0021-eb2d-8000-a487-f4bd3570b076" class=""><strong>How to avoid hotspots?</strong></h3><p id="117e0021-eb2d-8077-b059-ffb356362f0b" class="">Instead of mapping a server to one position in the ring, <strong><span style="border-bottom:0.05em solid">we can map a single server to multiple positions on the hash ring</span></strong>. We add <em><strong><span style="border-bottom:0.05em solid">virtual replicas</span></strong></em><em> </em>of the actual servers in the ring. The keys will be distributed more uniformly across the cache servers now.</p><figure id="117e0021-eb2d-8084-a7c4-f0d60b8c1f95" class="image" style="text-align:center"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2037.png"><img style="width:354px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2037.png"/></a></figure><h2 id="117e0021-eb2d-80c9-98c6-f403e5e02db6" class=""><strong>Conclusion</strong></h2><ul id="117e0021-eb2d-80d7-8f71-d3a0261b57ec" class="bulleted-list"><li style="list-style-type:disc">In distributed systems, as you scale up/down horizontally, building the cache each time is computationally expensive. </li></ul><ul id="117e0021-eb2d-80f4-9107-d1799aacb479" class="bulleted-list"><li style="list-style-type:disc">Consistent Hashing <strong>minimizes the impact by remapping only a certain number of keys rather than all the keys </strong>as compared to the Hash Partitioning algorithm.</li></ul><ul id="117e0021-eb2d-8046-8673-dde2cd2838b3" class="bulleted-list"><li style="list-style-type:disc">Moreover it is essential to distribute the load evenly among all the cache servers. </li></ul><ul id="117e0021-eb2d-8059-b623-f411ca936dc6" class="bulleted-list"><li style="list-style-type:disc">Consistent Hashing solves this <strong><span style="border-bottom:0.05em solid">by adding virtual replicas of the original servers to the hash ring</span></strong>.</li></ul></div></details><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">Logging, Metric, Automation</summary><div class="indented"><h3 id="118e0021-eb2d-8006-9063-c57c90d2c303" class="">Logging: </h3><ul id="118e0021-eb2d-80a3-8a00-db56add2eba1" class="bulleted-list"><li style="list-style-type:disc">Monitoring error logs is important because it helps to identify errors and problems in the system. </li></ul><ul id="118e0021-eb2d-803c-a66c-f6bc52ebe99c" class="bulleted-list"><li style="list-style-type:disc">You can monitor error logs at per server level or use tools to aggregate them to a centralized service for easy search and viewing.</li></ul><h3 id="118e0021-eb2d-80af-99a5-e5df72639646" class="">Metrics: </h3><p id="118e0021-eb2d-807d-9aaa-fb8baadf70ba" class="">Collecting different types of metrics help us to gain business insights and understand the health status of the system. Some of the following metrics are useful:<div class="indented"><ul id="118e0021-eb2d-80b0-93d4-ee6cbad0d435" class="bulleted-list"><li style="list-style-type:disc">Host level metrics → CPU, Memory, disk I/O, etc.</li></ul><ul id="118e0021-eb2d-80bd-a738-c113b4d1cf20" class="bulleted-list"><li style="list-style-type:disc">Aggregated level metrics → for example, the performance of the entire database tier, cache tier, etc.</li></ul><ul id="118e0021-eb2d-8011-b750-e45b2d4aaa5b" class="bulleted-list"><li style="list-style-type:disc">Key business metrics → daily active users, retention, revenue, etc.</li></ul></div></p><h3 id="118e0021-eb2d-80b5-9061-ff00dee5a208" class="">Automation: </h3><ul id="118e0021-eb2d-800e-8677-c2af33a3b26b" class="bulleted-list"><li style="list-style-type:disc">When a system gets big and complex, we need to build or leverage automation<br/>tools to improve productivity. <br/></li></ul><ul id="118e0021-eb2d-8072-9e89-c3a855bd4c60" class="bulleted-list"><li style="list-style-type:disc">Continuous integration is a good practice, in which each code check-in is verified through automation, allowing teams to detect problems early. </li></ul><ul id="118e0021-eb2d-8093-9e5d-f674d86d721e" class="bulleted-list"><li style="list-style-type:disc">Besides, automating your build, test, deploy process, etc. could improve developer productivity significantly.</li></ul><h2 id="118e0021-eb2d-8050-b75a-d9bbd09d5ea4" class="">Design with Logging, Monitoring and Automation Tools</h2><figure id="118e0021-eb2d-8073-a2e6-f96691121a6e" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2038.png"><img style="width:679.984375px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2038.png"/></a></figure></div></details><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">Back-Of-The-Envelope Estimation</summary><div class="indented"><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="118e0021-eb2d-808b-b028-fe5564663aeb"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><p id="118e0021-eb2d-806d-a3f9-f56d2f1e439b" class="">Back-of-the-envelope calculations are estimates you create using a combination of thought experiments and common performance numbers to get a good feel for which designs will meet your requirements.</p></div></figure><h2 id="118e0021-eb2d-8053-a119-e46d3713f2f1" class="">Power of Two</h2><ul id="118e0021-eb2d-80f6-8fc5-ed46a7bc9953" class="bulleted-list"><li style="list-style-type:disc">To obtain correct calculations, it is critical to know the data volume unit using the power of 2. </li></ul><ul id="118e0021-eb2d-8047-821f-ec6528f8f7dd" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">A byte is a sequence of 8 bits. </span></strong></li></ul><ul id="118e0021-eb2d-809c-83a8-e31e4b2f206b" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">An ASCII character uses one byte of memory (8 bits).</span></strong><figure id="118e0021-eb2d-80e4-bdc2-f20e4e1681f5" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/1da7962e-c429-400b-8b13-b2219e3ba1d6.png"><img style="width:590.7692307692307px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/1da7962e-c429-400b-8b13-b2219e3ba1d6.png"/></a></figure></li></ul><h2 id="118e0021-eb2d-8070-8349-d685159fc5ea" class="">Latency numbers every programmers should know</h2><figure id="118e0021-eb2d-80ee-87a2-d76bc6465903" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2039.png"><img style="width:679.984375px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2039.png"/></a></figure><p id="118e0021-eb2d-8097-b786-d2c45c3aa6d3" class="">By analyzing the numbers, we get the following conclusions:</p><ul id="118e0021-eb2d-8088-a690-c23a99af54ea" class="bulleted-list"><li style="list-style-type:disc">Memory is fast but the disk is slow.</li></ul><ul id="118e0021-eb2d-80a6-b4cc-de18bc92e647" class="bulleted-list"><li style="list-style-type:disc">Avoid disk seek if possible.</li></ul><ul id="118e0021-eb2d-8092-8178-d26cfe457ff9" class="bulleted-list"><li style="list-style-type:disc">Simple compression algorithms are fast.</li></ul><ul id="118e0021-eb2d-80b5-9c74-fd80f2236599" class="bulleted-list"><li style="list-style-type:disc">Compress data before sending it over the internet if possible.</li></ul><ul id="118e0021-eb2d-80e6-a07f-f1e88aec0f9d" class="bulleted-list"><li style="list-style-type:disc">Data centres are usually in different regions, and it takes time to send data between them.</li></ul><h2 id="118e0021-eb2d-8024-a0a9-dee3457d0188" class="">Availability numbers</h2><figure class="block-color-gray_background callout" style="white-space:pre-wrap;display:flex" id="118e0021-eb2d-80ad-a9e5-db70eb7b4c7c"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><ul id="118e0021-eb2d-8024-afea-e3189b0da3a9" class="bulleted-list"><li style="list-style-type:disc">High availability is <strong><span style="border-bottom:0.05em solid">the ability of a system to be continuously operational for a desirably long period of time</span></strong>. </li></ul><ul id="118e0021-eb2d-8032-8678-fcb667b14b38" class="bulleted-list"><li style="list-style-type:disc">High availability is measured as a percentage, with 100% means a service that has 0 downtime. </li></ul></div></figure><ul id="118e0021-eb2d-80ee-ac62-fb100bcea63f" class="bulleted-list"><li style="list-style-type:disc">Most services fall between 99% and 100%. </li></ul><ul id="118e0021-eb2d-8034-bf76-f7b950202e1d" class="bulleted-list"><li style="list-style-type:disc">A service level agreement (SLA) is a commonly used term for service providers. This is an agreement between you (the service provider) and your customer, and this agreement formally defines the level of uptime your service will deliver. </li></ul><ul id="118e0021-eb2d-80bc-8de5-f710966e1965" class="bulleted-list"><li style="list-style-type:disc">Cloud providers Amazon [4], Google [5] and Microsoft [6] set their SLAs at 99.9% or above. </li></ul><ul id="118e0021-eb2d-80b3-b7bd-e19f7e2390b6" class="bulleted-list"><li style="list-style-type:disc"><strong><span style="border-bottom:0.05em solid">Uptime is traditionally measured in nines. The more the nines, the better. </span></strong></li></ul><ul id="118e0021-eb2d-80d8-82ae-e092baaaf8ee" class="bulleted-list"><li style="list-style-type:disc">As shown in below table, the number of nines correlate to the expected system downtime.</li></ul><figure id="118e0021-eb2d-8048-b2ca-c9eeeecd9b03" class="image"><a href="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2040.png"><img style="width:679.984375px" src="System%20Design%20Core%20Concepts%20110e0021eb2d80948c5bfde80305dae6/image%2040.png"/></a></figure></div></details><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">Tips</summary><div class="indented"><h2 id="118e0021-eb2d-804e-ae7d-d88148761bf2" class="">Summary of how we scale</h2><ul id="118e0021-eb2d-80ad-917e-f9b2005a869c" class="bulleted-list"><li style="list-style-type:disc">Keep web tier stateless</li></ul><ul id="118e0021-eb2d-8090-9c65-f38c51e352cb" class="bulleted-list"><li style="list-style-type:disc">Build redundancy at every tier</li></ul><ul id="118e0021-eb2d-80a8-83e4-da99771626cc" class="bulleted-list"><li style="list-style-type:disc">Cache data as much as you can</li></ul><ul id="118e0021-eb2d-80d1-8723-d3796b7aec25" class="bulleted-list"><li style="list-style-type:disc">Support multiple data centres</li></ul><ul id="118e0021-eb2d-80d1-870f-c78547740c07" class="bulleted-list"><li style="list-style-type:disc">Host static assets in CDN</li></ul><ul id="118e0021-eb2d-80db-b753-f52e2dae8c7a" class="bulleted-list"><li style="list-style-type:disc">Scale your data tier by sharding</li></ul><ul id="118e0021-eb2d-8012-9e06-f887b9fda3f8" class="bulleted-list"><li style="list-style-type:disc">Split tiers into individual services</li></ul><ul id="118e0021-eb2d-8090-ab5c-d858b9f84702" class="bulleted-list"><li style="list-style-type:disc">Monitor your system and use automation tools</li></ul><h2 id="118e0021-eb2d-80f5-9b88-d980940fba15" class="">Back-Of-The-Envelope Tips</h2><ul id="118e0021-eb2d-8064-8be2-d9be3aa4eef7" class="bulleted-list"><li style="list-style-type:disc"><strong>Rounding and Approximation → </strong><ul id="118e0021-eb2d-8001-8311-c3b04b5376a5" class="bulleted-list"><li style="list-style-type:circle">It is difficult to perform complicated math operations during the interview. For example, what is the result of “99987 / 9.1”? There is no need to spend valuable time to solve complicated math problems. Precision is not expected. Use round numbers and approximation to your advantage. The division question can be simplified as follows: “100,000 / 10”.</li></ul></li></ul><ul id="118e0021-eb2d-80ec-a05a-d67becb27752" class="bulleted-list"><li style="list-style-type:disc"><strong>Write down your assumptions →</strong><ul id="118e0021-eb2d-807c-9463-d3a260107e01" class="bulleted-list"><li style="list-style-type:circle">It is a good idea to write down your assumptions to be referenced later.</li></ul></li></ul><ul id="118e0021-eb2d-80b2-bd45-c1ce3e4c76fa" class="bulleted-list"><li style="list-style-type:disc"><strong>Label your units →</strong><ul id="118e0021-eb2d-8099-ab14-f6d2b8bee237" class="bulleted-list"><li style="list-style-type:circle">When you write down “5”, does it mean 5 KB or 5 MB? You might confuse yourself with this. Write down the units because “5 MB” helps to remove ambiguity.</li></ul></li></ul><ul id="118e0021-eb2d-807b-be39-ecc877b0411c" class="bulleted-list"><li style="list-style-type:disc"><strong>Commonly asked back-of-the-envelope estimations →</strong><ul id="118e0021-eb2d-8000-b618-cc8c1e98a011" class="bulleted-list"><li style="list-style-type:circle">QPS (Query Per Second), peak QPS, storage, cache, number of servers, etc.</li></ul></li></ul></div></details><details open=""><summary style="font-weight:600;font-size:1.875em;line-height:1.3;margin:0">LMR</summary><div class="indented"><ul id="187e0021-eb2d-80ab-ba25-f554da80e005" class="bulleted-list"><li style="list-style-type:disc">Use Web Socket (with TCP) for Instant Messaging</li></ul><ul id="187e0021-eb2d-8087-91ef-d65815f89dc2" class="bulleted-list"><li style="list-style-type:disc">Use Web RTC (with UDP) for live streaming and Video Calling</li></ul><ul id="187e0021-eb2d-802d-a669-e05aa72efb27" class="bulleted-list"><li style="list-style-type:disc">Use RPC API Framework for Chat Functionality, to perform complex calculations, take picture with a remote device’s camera, use ML algorithm, restart server remotely, transfer money from one account to another on a remote banking system.</li></ul><ul id="187e0021-eb2d-802b-bcae-d2dbfcb5163b" class="bulleted-list"><li style="list-style-type:disc">Use GraphQL for Customer-Facing web and mobile applications</li></ul><ul id="187e0021-eb2d-8004-8f3b-ef9d30166ccd" class="bulleted-list"><li style="list-style-type:disc">Use REST API to perform data exchange between client and server →  CRUD operations on data objects.</li></ul><ul id="187e0021-eb2d-802d-8cae-ffaf11e2b892" class="bulleted-list"><li style="list-style-type:disc">Use SQL DB for system needing Strong ACID requirements / Strong Consistency</li></ul><ul id="187e0021-eb2d-8088-a8d4-f767e73cd832" class="bulleted-list"><li style="list-style-type:disc">SQL DBs are faster for reading.</li></ul><ul id="187e0021-eb2d-8062-9ebf-f530a47264da" class="bulleted-list"><li style="list-style-type:disc">NoSQL DBs have faster writes (NSFW).</li></ul><ul id="187e0021-eb2d-80fa-9593-e1c95a43d5db" class="bulleted-list"><li style="list-style-type:disc">SQL has Strong Consistency (because fields are locked while updating them, meaning any requests for that locked fields has to wait), and therefore higher latency.</li></ul><ul id="187e0021-eb2d-80aa-9d1f-d1ab35a98de7" class="bulleted-list"><li style="list-style-type:disc">SQL does not work well for mixed schema data.</li></ul><ul id="187e0021-eb2d-804f-bd18-f186bd8b79ad" class="bulleted-list"><li style="list-style-type:disc">Use NoSQL when →<ul id="187e0021-eb2d-80e3-8bab-e84411bece23" class="bulleted-list"><li style="list-style-type:circle">Latency is priority and needs super low latency</li></ul><ul id="187e0021-eb2d-80f0-b8fe-dc01c29a2b71" class="bulleted-list"><li style="list-style-type:circle">Data is unstructured or data is not relational.</li></ul><ul id="187e0021-eb2d-807f-9012-d5ebc5be5faf" class="bulleted-list"><li style="list-style-type:circle">You only need to serialize and deserialize data (JSON, XML)</li></ul><ul id="187e0021-eb2d-8069-a034-ef36bf454119" class="bulleted-list"><li style="list-style-type:circle">Need to store massive amount of data.</li></ul></li></ul><ul id="187e0021-eb2d-8065-9ca4-d97abc17bafe" class="bulleted-list"><li style="list-style-type:disc">Use NoSQL Columnar DB for read-heavy operations like analytics</li></ul><ul id="188e0021-eb2d-8070-9354-f172c809db31" class="bulleted-list"><li style="list-style-type:disc">Throughput → Total amount of work such as data processed or requests, the system can complete in a given time frame. RPS (Request/Second), OPS (Operation/Sec), TPS (Transaction/sec)<ul id="188e0021-eb2d-8019-aecf-feee58e47e71" class="bulleted-list"><li style="list-style-type:circle"><strong>High-throughput</strong> →  the system can handle a <strong>very large number</strong> of these requests or data processing operations quickly and efficiently, typically at scale</li></ul></li></ul><ul id="189e0021-eb2d-80af-9acb-efb51d22977a" class="bulleted-list"><li style="list-style-type:disc">When to use API Gateway vs Load Balancer ?<ul id="189e0021-eb2d-809a-ab0a-f380822d5fb7" class="bulleted-list"><li style="list-style-type:circle">Use a load balancer when you primarily need to distribute traffic across multiple servers to enhance performance and reliability, </li></ul><ul id="189e0021-eb2d-804a-a068-e3ef923759e8" class="bulleted-list"><li style="list-style-type:circle">Use an API gateway is when you need a single entry point to manage API requests, including authentication, rate limiting, and protocol translation, especially in a microservices architecture where you have multiple backend services to access through a unified interface</li></ul></li></ul><ul id="189e0021-eb2d-802c-a37c-d26b5fad2f57" class="bulleted-list"><li style="list-style-type:disc">Load Balancer <ul id="189e0021-eb2d-80fc-85a6-f36addb252ae" class="bulleted-list"><li style="list-style-type:circle">Round Robin</li></ul><ul id="189e0021-eb2d-80c7-82d0-fbc38e6b545c" class="bulleted-list"><li style="list-style-type:circle">Least connection / response time</li></ul><ul id="189e0021-eb2d-8026-988e-e5d4e0343c50" class="bulleted-list"><li style="list-style-type:circle">Hashing</li></ul></li></ul><ul id="189e0021-eb2d-80ea-8e85-cff9dcb9563a" class="bulleted-list"><li style="list-style-type:disc">Caching → used for read-heavy (read frequently) and light-write (modified infrequently) system<ul id="189e0021-eb2d-802c-b2da-e52d5f34fe52" class="bulleted-list"><li style="list-style-type:circle">Read-through cache</li></ul><ul id="189e0021-eb2d-80c2-9bdf-d83794dc7b8e" class="bulleted-list"><li style="list-style-type:circle">Write-through and Write-back patterns</li></ul><ul id="189e0021-eb2d-808c-b7f3-d7b00a22dc40" class="bulleted-list"><li style="list-style-type:circle">Using cache on the client side</li></ul><ul id="189e0021-eb2d-8000-96c2-e0434a56e62a" class="bulleted-list"><li style="list-style-type:circle">Cache Invalidation → LRU Algorithm (Least Recently Used)</li></ul><ul id="189e0021-eb2d-8027-a3f8-ee85741dc078" class="bulleted-list"><li style="list-style-type:circle">The 80/20 rule: <strong><span style="border-bottom:0.05em solid">You want to store 80% of read requests in 20% of storage (or memory). Generally, these are the most popular requests. OR For most systems 20% of the data accounts for 80% of the reads.</span></strong></li></ul></li></ul></div></details><p id="187e0021-eb2d-8018-a4c9-cab7e1ed0e7c" class="">
</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>